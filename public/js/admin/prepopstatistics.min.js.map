{"version":3,"sources":["prepopstatistics.js"],"names":["$","document","ready","prePopStatisticsReport","the_url","baseURL","html","table","body","downloadReportButton","groupBy","val","DataTable","destroy","empty","addClass","ajax","type","url","data","group_by","date_from","date_to","predefined_date","affiliate_id","s1","s2","s3","s4","s5","sib_s1","prop","sib_s2","sib_s3","sib_s4","success","console","log","records","length","params","downloadURL","report_title","attr","removeClass","each","x","row","createdAt","revenue_tracker_id","created_at","sib_s5","prepop_percentage","prepop_count","total_clicks","not_prepop_percentage","no_prepop_count","error_percentage","prepop_with_errors_count","trow","toFixed","append","order","lengthMenu","draw","select2","theme","datepicker","format","clearBtn","autoclose","todayHighlight","dataTable","click","e","preventDefault","change","lastValue1","on","this","trigger","removeAttr"],"mappings":"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","file":"prepopstatistics.min.js","sourcesContent":["$(document).ready(function()\r\n{\r\n    $('#affiliate_id').select2({\r\n        theme: 'bootstrap'\r\n    });\r\n\r\n    $('.input-group.date').datepicker({\r\n        format: \"yyyy-mm-dd\",\r\n        clearBtn: true,\r\n        autoclose: true,\r\n        todayHighlight: true\r\n    });\r\n\r\n    var baseURL = $('#baseUrl');\r\n\r\n    var prepopStatisticsURL = baseURL.html()+'/admin/prepopReportStatistics';\r\n\r\n    // var prepopDataTable = $('#prepop-table').DataTable({\r\n    //     'processing': true,\r\n    //     'serverSide': true,\r\n    //     'searching': false,\r\n    //     'order': [[ 0, \"asc\" ]], //disable the initial ordering\r\n    //     'ajax':{\r\n    //         url: prepopStatisticsURL,\r\n    //         type: 'POST',  // method  , by default get\r\n    //         'data': function(d)\r\n    //         {\r\n    //             d.group_by = $('#group_by').val();\r\n    //             d.date_from = $('#date_from').val();\r\n    //             d.date_to = $('#date_to').val();\r\n    //             d.predefined_date = $('#predefined_date').val();\r\n    //             d.affiliate_id = $('#affiliate_id').val();\r\n    //             d.s1 = $('#s1').val();\r\n    //             d.s2 = $('#s2').val();\r\n    //             d.s3 = $('#s3').val();\r\n    //             d.s4 = $('#s4').val();\r\n    //             d.s5 = $('#s5').val();\r\n    //             d.sib_s1 = $('#sib_s1').prop('checked');\r\n    //             d.sib_s2 = $('#sib_s2').prop('checked');\r\n    //             d.sib_s3 = $('#sib_s3').prop('checked');\r\n    //             d.sib_s4 = $('#sib_s4').prop('checked');\r\n    //         },\r\n    //         error: function()\r\n    //         {\r\n    //             // error handling\r\n    //         },\r\n    //         'dataSrc': function(json)\r\n    //         {\r\n    //             var dataCount = json.data.length;\r\n\r\n    //             var downloadReportButton = $('#download_report');\r\n\r\n    //             //if dataCount is greater than 0 meaning there's data to be downloaded\r\n    //             if(dataCount>0)\r\n    //             {\r\n    //                 //$('#download_report').show();\r\n    //                 //var downloadReport = $('#download_report');\r\n    //                 //downloadReport.css('display','inline-block');\r\n    //                 //add additional inform in download url\r\n    //                 //var originalURL = downloadReport.attr('href');\r\n    //                 //originalURL = originalURL+'?grouping='+json.grouping+'&date_range='+json.date_range;\r\n    //                 //var downloadURL = $('#baseUrl').html()+'/downloadPrepopStatisticsReport?grouping='+json.grouping+'&date_range='+json.date_range;\r\n\r\n    //                 var s1 = $('#s1').val(),\r\n    //                     s2 = $('#s2').val(),\r\n    //                     s3 = $('#s3').val(),\r\n    //                     s4 = $('#s4').val(),\r\n    //                     s5 = $('#s5').val();\r\n\r\n    //                 downloadReportButton.removeClass('disabled');\r\n\r\n    //                 var downloadURL = $('#baseUrl').html()+'/downloadPrepopStatisticsReport?group_by='+json.group_by+'&date_from='+json.date_from+'&date_to='+json.date_to+'&predefined_date='+json.predefined_date+'&affiliate_id='+json.affiliate_id+'&report_title='+json.report_title;\r\n    //                     downloadURL += '&s1=' + s1 + '&s2=' + s2 + '&s3=' + s3 + '&s4=' + s4 + '&s5=' + s5 + '&sib_s1=' + $('#sib_s1').prop('checked') + '&sib_s2=' + $('#sib_s2').prop('checked') + '&sib_s3=' + $('#sib_s3').prop('checked') + '&sib_s4=' + $('#sib_s4').prop('checked');\r\n    //                 downloadReportButton.attr('href', downloadURL);\r\n\r\n    //                 // downloadReportButton.show();\r\n    //                 downloadReportButton.css('display', 'inline-block');\r\n    //             }\r\n    //             else\r\n    //             {\r\n    //                 downloadReportButton.hide();\r\n    //                 downloadReportButton.addClass('disabled');\r\n    //             }\r\n\r\n    //             return json.data;\r\n    //         }\r\n    //     },\r\n    //     'columns':[\r\n    //         {'data': 'date','width': '10%'},\r\n    //         {'data':'affiliate_id'},\r\n    //         {'data':'revenue_tracker_id'},\r\n    //         {'data':'s1', 'width' : '10%'},\r\n    //         {'data':'s2'},\r\n    //         {'data':'s3'},\r\n    //         {'data':'s4'},\r\n    //         {'data':'s5'},\r\n    //         {'data':'total_clicks'},\r\n    //         {'data':'prepopped'},\r\n    //         {'data':'not_prepopped'},\r\n    //         {'data':'prepopped_with_errors',},\r\n    //         {'data':'percentage_prepopped'},\r\n    //         {'data':'percentage_unprepopped'},\r\n    //         {'data':'percentage_prepopped_with_errors'},\r\n    //         {'data':'profit_margin'}\r\n    //     ],\r\n    //     //'initComplete': rowInitComplete,\r\n    //     lengthMenu: [[25,50,100,-1],[25,50,100,'ALL']]\r\n    // });\r\n\r\n    // $('#generate_report').click(function()\r\n    // {\r\n    //     //prepopDataTable.order([[ 0, \"asc\" ]]);\r\n    //     prepopDataTable.ajax.reload();\r\n    // });\r\n\r\n    function prePopStatisticsReport() {\r\n        the_url = baseURL.html() + '/admin/getprepopReportStats';\r\n\r\n        var table = $('#prepop-table'),\r\n            body = $('#prepop-table tbody');\r\n\r\n        var downloadReportButton = $('#download_report');\r\n        var groupBy = $('#group_by').val();\r\n\r\n        table.DataTable().destroy();\r\n        body.empty();\r\n\r\n        downloadReportButton.addClass('disabled');\r\n\r\n        $.ajax({\r\n            type: 'POST',\r\n            url: the_url,\r\n            data: {\r\n                group_by : $('#group_by').val(),\r\n                date_from : $('#date_from').val(),\r\n                date_to : $('#date_to').val(),\r\n                predefined_date : $('#predefined_date').val(),\r\n                affiliate_id : $('#affiliate_id').val(),\r\n                s1 : $('#s1').val(),\r\n                s2 : $('#s2').val(),\r\n                s3 : $('#s3').val(),\r\n                s4 : $('#s4').val(),\r\n                s5 : $('#s5').val(),\r\n                sib_s1 : $('#sib_s1').prop('checked'),\r\n                sib_s2 : $('#sib_s2').prop('checked'),\r\n                sib_s3 : $('#sib_s3').prop('checked'),\r\n                sib_s4 : $('#sib_s4').prop('checked'),\r\n            },\r\n            success: function(data){\r\n                console.log(data);\r\n                console.log(data.records.length)\r\n\r\n                if(data.records.length > 0)\r\n                {\r\n                    var params = data.params;\r\n\r\n                    var s1 = $('#s1').val(),\r\n                        s2 = $('#s2').val(),\r\n                        s3 = $('#s3').val(),\r\n                        s4 = $('#s4').val(),\r\n                        s5 = $('#s5').val();\r\n\r\n                    var downloadURL = $('#baseUrl').html()+'/downloadPrepopStatisticsReport?group_by='+$('#group_by').val()+'&date_from='+$('#date_from').val()+'&date_to='+$('#date_to').val()+'&predefined_date='+$('#predefined_date').val()+'&affiliate_id='+$('#affiliate_id').val()+'&report_title='+data.report_title;\r\n                        downloadURL += '&s1=' + s1 + '&s2=' + s2 + '&s3=' + s3 + '&s4=' + s4 + '&s5=' + s5 + '&sib_s1=' + $('#sib_s1').prop('checked') + '&sib_s2=' + $('#sib_s2').prop('checked') + '&sib_s3=' + $('#sib_s3').prop('checked') + '&sib_s4=' + $('#sib_s4').prop('checked');\r\n                    downloadReportButton.attr('href', downloadURL);\r\n                    downloadReportButton.removeClass('disabled');\r\n                }\r\n\r\n                $.each(data.records, function(x, row){\r\n\r\n                    var createdAt = '', affiliate_id = '', revenue_tracker_id = '', s1 = '', s2 = '', s3 = '', s4 = '', s5 = '';\r\n                    if(groupBy == 'affiliate_id'){\r\n                        createdAt = row.created_at;\r\n                        affiliate_id = row.affiliate_id;\r\n                    }else if(groupBy == 'revenue_tracker_id') {\r\n                        createdAt = row.created_at;\r\n                        revenue_tracker_id = row.revenue_tracker_id\r\n                    }else{\r\n                        createdAt = row.created_at;\r\n                        affiliate_id = row.affiliate_id;\r\n                        revenue_tracker_id = row.revenue_tracker_id\r\n                        s1 = row.s1 === null ? '' : row.s1;\r\n                        s2 = row.s2 === null ? '' : row.s2;\r\n                        s3 = row.s3 === null ? '' : row.s3;\r\n                        s4 = row.s4 === null ? '' : row.s4;\r\n                        s5 = row.s5 === null ? '' : row.s5;\r\n                    }\r\n\r\n                    s1 = params.sib_s1 == 'true' ? s1 : '';\r\n                    s2 = params.sib_s2 == 'true' ? s2 : '';\r\n                    s3 = params.sib_s3 == 'true' ? s3 : '';\r\n                    s4 = params.sib_s4 == 'true' ? s4 : '';\r\n                    s5 = params.sib_s5 == 'true' ? s5 : '';\r\n\r\n                    var prepop_percentage = (row.prepop_count / row.total_clicks) * 100,\r\n                    not_prepop_percentage = (row.no_prepop_count / row.total_clicks) * 100,\r\n                    error_percentage = (row.prepop_with_errors_count / row.total_clicks) * 100;\r\n                    var trow = '<tr><td>'+createdAt+'</td><td>'+affiliate_id+'</td><td>'+revenue_tracker_id+'</td><td>'+s1+'</td>';\r\n                        trow += '<td>'+s2+'</td><td>'+s3+'</td><td>'+s4+'</td><td>'+s5+'</td><td>'+row.total_clicks+'</td>';\r\n                        trow += '<td>'+row.prepop_count+'</td><td>'+row.no_prepop_count+'</td><td>'+row.prepop_with_errors_count+'</td>';\r\n                        trow += '<td>'+prepop_percentage.toFixed(2)+'%</td><td>'+not_prepop_percentage.toFixed(2)+'%</td><td>'+error_percentage.toFixed(2)+'%</td></tr>';\r\n                    \r\n                    body.append(trow);\r\n                });\r\n\r\n                table.DataTable({\r\n                    \"order\": [[ 1, \"asc\" ]],\r\n                    // language: {\r\n                    //     searchPlaceholder: \"Affiliate / Revenue Tracker\"\r\n                    // },\r\n                    lengthMenu: [[25, 50, 100, -1],[25, 50, 100, 'All']]\r\n                }).draw();\r\n            }\r\n        });\r\n    }\r\n\r\n    $('#prepop-table').dataTable();\r\n    prePopStatisticsReport();\r\n\r\n    $('#generate_report').click(function(e){\r\n\r\n        e.preventDefault();\r\n        prePopStatisticsReport()\r\n\r\n    });\r\n\r\n    $('#predefined_date').change(function()\r\n    {\r\n        //clear the date range\r\n        $('#date_from').val('');\r\n        $('#date_to').val('');\r\n    });\r\n\r\n    var lastValue1 = '';\r\n    $('.date-picker').on('propertychange change paste input',function()\r\n    {\r\n        if ($(this).val() != lastValue1) {\r\n            lastValue1 = $(this).val();\r\n            $('#predefined_date').val('');\r\n        }\r\n    });\r\n\r\n    $('#clear').click(function()\r\n    {\r\n        $('#date_from').val('');\r\n        $('#date_to').val('');\r\n        $('#affiliate_id').val('').trigger('change');\r\n        $('#predefined_date').val('yesterday').trigger('change');\r\n        $('#group_by').val('created_at').trigger('change');\r\n\r\n        //clear the results as well\r\n        // prepopDataTable.ajax.reload();\r\n    });\r\n\r\n    $('#group_by').change(function()\r\n    {\r\n        if($(this).val() != 'created_at') {\r\n            $('.sibs').prop('checked', true).attr('disabled', true);\r\n        }else {\r\n            $('.sibs').removeAttr('disabled');\r\n        }\r\n    });\r\n});"]}