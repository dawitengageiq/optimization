var inactiveAdvertisers=[],inactiveCategories=[],eiqFrameID=$("#eiq_iframe_id").val(),currentCampaign,campaignContentsExt=[];$(document).ready(function(){function e(e,a){for(var t=0;t<a.length;t++)if(a[t].value===e.value)return!0;return!1}function a(e,a,t,i){var l="",n='style="display: none"';return i&&(l="selected",n=""),'<tr class="postFieldTr"><th>'+e+'</th><td><select id="field['+e+']" name="field['+e+']" class="fieldSelect form-control this_field" data-value="'+t+'" required><option value="">Select Fields name</option><option value="first_name">first_name</option><option value="last_name">last_name</option><option value="zip">zip</option><option value="city">city</option><option value="state">state</option><option value="ip">ip</option><option value="age">age</option><option value="rev_tracker">rev_tracker</option><option value="eiq_email">eiq_email</option><option value="dob">dob</option><option value="dobmonth">dobmonth</option><option value="dobday">dobday</option><option value="dobyear">dobyear</option><option value="gender">gender</option><option value="phone">phone</option><option value="address">address</option><option value="address1">address1</option><option value="datetime">datetime</option><option value="q1">q1</option><option value="q2">q2</option><option value="q3">q3</option><option value="q4">q4</option><option value="q5">q5</option><option value="q6">q6</option><option value="q7">q7</option><option value="q8">q8</option><option value="q9">q9</option><option value="q10">q10</option><option value="q11">q11</option><option value="q12">q12</option><option value="q13">q13</option><option value="q14">q14</option><option value="q15">q15</option><option value="q16">q16</option><option value="q17">q17</option><option value="q18">q18</option><option value="q19">q19</option><option value="q20">q20</option><option value="q21">q21</option><option value="q22">q22</option><option value="q23">q23</option><option value="q24">q24</option><option value="q25">q25</option><option value="q26">q26</option><option value="q27">q27</option><option value="q28">q28</option><option value="q29">q29</option><option value="q30">q30</option><option value="comments">comments</option><option value="comment2">comment2</option><option value="xxTrustedFormCertUrl">xxTrustedFormCertUrl</option><option value="fixed_data" '+l+'>Fixed Data</option></select><span id="fieldInput-'+t+'" class="fieldInput" '+n+'><input  type="text" name="fixed['+e+']" id="fixed['+e+']" placeholder="Enter Fix Value" class="form-control this_field" value="'+a+'"/></span></td></tr>'}function t(e){var a=$("#formFieldsTable tbody"),t=T[e],i=t.type,l=t.value,n=t.name;t.value.indexOf('"')<0&&$('select[name="value_select"] option[value="'+t.value+'"]').length>0&&(l=$('select[name="value_select"] option[value="'+t.value+'"]').html()),t.standard?(remove="disabled",sort="",sortable='class="sortDisabled"'):(sort='<span class="sortFieldHandle glyphicon glyphicon-resize-vertical"></span>',remove="",sortable=""),""!=l?"article"==i?(prev_val=l,prev_val=prev_val.replace(/<a\b[^>]*>(.*?)<\/a>/i,""),prev_val=prev_val.replace(/<\/?[^>]+(>|$)/g,""),prev_val=prev_val.substr(0,150),l.length>150&&(prev_val+="..."),field_value="<small><em>"+prev_val+"</em></small>"):(def_val=l,"dropdown"!=i&&"checkbox"!=i&&"radio"!=i||(def_val_indx=t.options.values.indexOf(t.value),t.value!=t.options.displays[def_val_indx]&&(def_val+=" - "+t.options.displays[def_val_indx])),def_val=def_val.replace(/<a\b[^>]*>(.*?)<\/a>/i,""),def_val_prev=def_val.substr(0,74),def_val.length>74&&(def_val_prev+="..."),field_value='<span class="label label-primary">'+def_val_prev+"</span>"):field_value="","dropdown"!=i&&"checkbox"!=i&&"radio"!=i||void 0!=typeof t.options&&(fieldCounter=0,$.each(t.options.values,function(e,a){if(""!=a){if(!(fieldCounter<=3))return field_value+=' <span class="label label-info">...</span>',!1;a!=t.value&&(a==t.options.displays[e]?opt_val=a:opt_val=a+" - "+t.options.displays[e],opt_val=opt_val.replace(/<a\b[^>]*>(.*?)<\/a>/i,""),opt_val_prev=opt_val.substr(0,74),opt_val.length>74&&(opt_val_prev+="..."),field_value+=' <span class="label label-info">'+opt_val_prev+"</span>",fieldCounter++)}}));var o=n;""!=t.label&&(o+="<br><small><em>"+t.label.substr(0,74),t.label.length>74&&(o+="..."),o+="</em></small>"),field_content="<tr "+sortable+' data-id="'+e+'"><th>'+sort+'</th><th id="fbf-name-'+e+'">'+o+'</th><td><span id="fbf-type-'+e+'" class="label label-default">'+i+'</span></td><td id="fbf-value-'+e+'">'+field_value+'</td><td><button type="button" class="removeFieldBtn btn btn-default pull-right" style="margin-left: 5px" data-id="'+e+'" '+remove+'><span class="glyphicon glyphicon-trash"></span></button><button type="button" class="viewFieldModalBtn btn btn-default pull-right" data-id="'+e+'"><span class="glyphicon glyphicon-pencil"></span></button></td></tr>',a.append(field_content)}function i(e,a,t,i){var l=$("#fieldValueTable tbody"),n="",o="",r=$("#fieldValueTable tbody tr").length;t&&(n="checked"),i&&(o="checked");var d='<tr><th><span class="sortValueHandle glyphicon glyphicon-resize-vertical"></span></th><th><input name="default_value" type="radio" value="'+r+'" '+n+'></th><th><input name="field_value[]" value="'+e+'" type="text" class="form-control" required></th><td><textarea name="field_display[]" class="form-control cmpFB_item" rows="2" required>'+a+'</textarea></td><th><input name="accepted[]" type="checkbox" value="'+r+'" '+o+'></th><td><button class="removeRowFielValue btn btn-default pull-right"><span class="glyphicon glyphicon-remove"></span></button></td></tr>';l.append(d)}function l(){var e=$("#campAffMgmtSubmitBtn"),a=$("#searchCmpAffMgmt").val(),t=$("#allCAMTblcampaigns-chkbx").prop("checked"),i=$("#allCAMcampaigns-chkbx").prop("checked"),l=$('[name="cam_campaign[]"]:checked').length,n=$(".camAddAff-div #lead_cap_type").val(),o=Math.floor(Number($(".camAddAff-div #lead_cap_value").val())),r=$("#cam_op_chkbx").val(),d=0;1==r&&n>0&&!(o>0)&&d++,null===a&&d++,t||i||0!=l||d++,0==d?e.show():e.hide()}function n(e,a,t,i,l){var n=$("#jsonFieldValueTable tbody"),o="",r="",d=$("#jsonFieldValueTable tbody tr").length;i&&(o="checked"),l&&(r="checked");var s='<tr><th><span class="sortValueHandle glyphicon glyphicon-resize-vertical"></span></th><th><input name="default_value" type="radio" value="'+d+'" '+o+'></th><th valign="middle"><input name="field_value[]" value="'+e+'" type="text" class="form-control" required></th><td><div class="row"><div class="col-md-12"><img src="'+t+'"></div><div class="col-md-12 form_div" style=""><label>Image URL:</label><input class="form-control this_field" name="field_img_value[]" type="text" value="'+t+'"></div><div class="col-md-12 form_div mt-1" style=""><label>Description</label><textarea name="field_display[]" class="form-control cmpFB_item" rows="2" required>'+a+'</textarea></div></div></td><th><input name="accepted[]" type="checkbox" value="'+d+'" '+r+'></th><td><button class="removeRowFielValue btn btn-default pull-right"><span class="glyphicon glyphicon-remove"></span></button></td></tr>';n.append(s)}function o(e){var a=$("#jsonFormFieldsTable tbody"),t=W[e],i=t.type,l=t.value,n=t.name;t.value.indexOf('"')<0&&$('select[name="value_select"] option[value="'+t.value+'"]').length>0&&(l=$('select[name="value_select"] option[value="'+t.value+'"]').html()),"true"==t.standard?(remove="disabled",sort="",sortable='class="sortDisabled"'):(sort='<span class="sortJsonFieldHandle glyphicon glyphicon-resize-vertical"></span>',remove="",sortable=""),""!=l?"article"==i?(prev_val=l,prev_val=prev_val.replace(/<a\b[^>]*>(.*?)<\/a>/i,""),prev_val=prev_val.replace(/<\/?[^>]+(>|$)/g,""),prev_val=prev_val.substr(0,150),l.length>150&&(prev_val+="..."),field_value="<small><em>"+prev_val+"</em></small>"):(def_val=l,"dropdown"!=i&&"checkbox"!=i&&"radio"!=i||(def_val_indx=t.options.values.indexOf(t.value),t.value!=t.options.displays[def_val_indx]&&(def_val+=" - "+t.options.displays[def_val_indx])),def_val=def_val.replace(/<a\b[^>]*>(.*?)<\/a>/i,""),def_val_prev=def_val.substr(0,74),def_val.length>74&&(def_val_prev+="..."),field_value='<span class="label label-primary">'+def_val_prev+"</span>"):field_value="","dropdown"!=i&&"checkbox"!=i&&"radio"!=i||void 0!=typeof t.options&&(fieldCounter=0,$.each(t.options.values,function(e,a){if(""!=a){if(!(fieldCounter<=3))return field_value+=' <span class="label label-info">...</span>',!1;a!=t.value&&(a==t.options.displays[e]?opt_val=a:opt_val=a+" - "+t.options.displays[e],opt_val=opt_val.replace(/<a\b[^>]*>(.*?)<\/a>/i,""),opt_val_prev=opt_val.substr(0,74),opt_val.length>74&&(opt_val_prev+="..."),field_value+=' <span class="label label-info">'+opt_val_prev+"</span>",fieldCounter++)}}));var o=n;""!=t.label&&(o+="<br><small><em>"+t.label.substr(0,74),t.label.length>74&&(o+="..."),o+="</em></small>"),field_content="<tr "+sortable+' data-id="'+e+'"><th>'+sort+'</th><th id="jfbf-name-'+e+'">'+o+'</th><td><span id="jfbf-type-'+e+'" class="label label-default">'+i+'</span></td><td id="jfbf-value-'+e+'">'+field_value+'</td><td><button type="button" class="removeJsonFieldBtn btn btn-default pull-right" style="margin-left: 5px" data-id="'+e+'" '+remove+'><span class="glyphicon glyphicon-trash"></span></button><button type="button" class="viewJsonFieldModalBtn btn btn-default pull-right" data-id="'+e+'"><span class="glyphicon glyphicon-pencil"></span></button></td></tr>',a.append(field_content)}function r(e){$("#loa-modal #linkout_url").val(""),$(".loa-rows").remove();var a=!0;try{var t=new URL(e);$("#loa-modal #linkout_url").val(t.origin);var i=new URLSearchParams(t.search);i.forEach(function(e,a){d(a,e)})}catch(l){a=!1}return a}function d(e,a){var t=$("#loa-table tbody"),i='<tr class="loa-rows"><td><input class="form-control this_field" required="true" name="loa_key[]" type="text" value="'+e+'"></td><td><input class="form-control this_field" required="true" name="loa_value[]" type="text" value="'+a+'"></td><td class="text-center"><button id="loa-deleteMe" class="btn btn-default" type="button"><span class="glyphicon glyphicon-trash"></span></button></td></tr>';t.append(i)}$('[data-toggle="tooltip"]').tooltip(),$(".alert").on("click",".close",function(){$(this).closest(".alert").fadeOut(),$(this).closest(".internal-error-wrapper").hide()}),$(".advertiser-select-add").select2({theme:"bootstrap",dropdownParent:$("#addCmpFormModal")}),$(".advertiser-select-edit").select2({theme:"bootstrap",dropdownParent:$("#editCampaignAdvertiserDiv")});var s=$("#baseUrl").html()+"/campaigns",c=$("#campaign-table"),p=c.data("advertiser"),m=c.data("affiliate"),u={};void 0!=p?u={awesome_advertiser_id:p}:void 0!=m&&(u={awesome_affiliate_id:m});var f=0,v=c.DataTable({processing:!0,serverSide:!0,columns:[null,null,null,null,null,null,null,null,null,null,null,{orderable:!1}],order:[],ajax:{url:s,type:"post",data:function(e){e.json_content_filter=$("#jsonContentFilter").val(),e.awesome_advertiser_id=void 0!=p?p:"",e.awesome_affiliate_id=void 0!=m?m:"",e.show_inactive=f},error:function(e){console.log(e)}},lengthMenu:[[25,50,100,1e3,2e3,3e3],[25,50,100,1e3,2e3,3e3]],sDom:'lf<"addToolbar">rtip'}),h='<label>New Design Filter: <select class="form-control" id="jsonContentFilter" name="json_content"><option value="" selected="selected">Show ALL</option><option value="true">w/ ND</option><option value="false">w/o ND</option></select></label>';h+='<label id="show_inactive_campaigns"><input type="checkbox" name="show_inactive_campaigns">Show Inactive Campaigns<a href="#" data-container="body" data-toggle="tooltip" data-placement="bottom" title="By default, all INACTIVE campaigns are hidden and will not be shown in the Campaign Table List. You can show them by simply checking the box of this option and automatically, all INACTIVE campaigns will be displayed accordingly."><i class="fa fa-question-circle"></i></a></label>',$("div.addToolbar").html(h),$("#show_inactive_campaigns a").click(function(e){e.preventDefault()}),$("#show_inactive_campaigns a").tooltip(),$(document).on("change",'#show_inactive_campaigns [name="show_inactive_campaigns"]',function(){f=$(this).prop("checked")?1:0,v.ajax.reload()}),$(document).on("change","#jsonContentFilter",function(){console.log("Reload"),v.ajax.reload()}),$("#campaign-table tbody").on("click","tr",function(){$(this).hasClass("selected")?$(this).removeClass("selected"):(v.$("tr.selected").removeClass("selected"),$(this).addClass("selected"))});var _='<select class="form-control full_width_form_field">';_+='<option value=""></option>',_+='<option value="0">Unlimited</option>',_+='<option value="1">Daily</option>',_+='<option value="2">Weekly</option>',_+='<option value="3">Monthly</option>',_+="</select>",$(".this_isa_popover").popover(),$(".date-wrapper input").datetimepicker({format:"YYYY-MM-DD"}),$(".time-wrapper input").datetimepicker({format:"LT"}),$(".img_type").change(function(){var e=$(this).closest(".image_wrapper");"add"==e.data("type")&&(e.find(".imgPreview").hide(),e.find(".imgPreview img").attr("src",""),e.find("#image").val(""));var a=$(this).val();console.log(a),2==a?e.find("#image").attr("type","text"):e.find("#image").attr("type","file")}),$(".campaign_img").change(function(){var e=$(this),a=$(this).closest(".image_wrapper"),t=a.find('input[name="img_type"]:checked').val();e.removeClass("error_field error"),""!=$(this).val()?($(".imgPreview").show(),1==t?imgPreview($(this),$(".imgPreview img")):$(".imgPreview img").on("load",function(){console.log("image loaded correctly")}).on("error",function(){""!=e.val()&&(console.log(e.val()),e.addClass("error_field error").val(""),console.log("error loading image"))}).attr("src",$(this).val())):($(".campaign_img").removeClass("error_field error"),$(".imgPreview").hide(),$(".imgPreview img").attr("src",""))}),$(".leadCapType").on("change",function(){var e=$(this),a="",t="";"add"==e.data("form")?(a=$("#leadCapVal_add"),t=$("#leadCapType_add")):(a=$("#leadCapVal_edit"),t=$("#leadCapType_edit")),0==e.val()?(t.removeClass("col-md-6").addClass("col-md-12"),a.find("input").removeAttr("required"),a.hide()):(t.removeClass("col-md-12").addClass("col-md-6"),a.find("input").attr("required","true"),a.show())}),$(".campaignType").on("change",function(){var e=$(this),a="",t="";"add"==e.data("form")?(a=$("#linkoutOfferID_add"),t=$("#olrProgramID_add")):(a=$("#linkoutOfferID_edit"),t=$("#olrProgramID_edit")),5==e.val()||6==e.val()?(a.find("input").attr("required","true"),a.show()):(a.find("input").removeAttr("required"),a.hide()),5!=e.val()&&4!=e.val()&&6!=e.val()?(t.find("input").attr("required","true"),t.show()):(t.find("input").removeAttr("required"),t.hide())}),$("#addCmpBtn").click(function(){var e=$("#addCmpFormModal"),a=$("#baseUrl").html()+"/add_campaign";e.find(".form_with_file").attr("action",a),e.find(".form_with_file").attr("data-process","add_campaign"),e.find(".modal-title").html("Add Campaign"),e.find("#this_id").val(""),e.find("#default_payout").val(0).attr("disabled",!0),e.find("#default_received").val(0).attr("disabled",!0),$(".this_modal_submit").removeAttr("disabled"),e.modal("show")});var g=CodeMirror.fromTextArea(document.getElementById("cmpCnt-stack-content"),{theme:"default",lineNumbers:!0,matchBrackets:!0,mode:"application/x-httpd-php",indentUnit:4,indentWithTabs:!0,readOnly:!0}),b=$("#campaignPayoutsHistory-table").DataTable({processing:!0,serverSide:!0,autoWidth:!1,searching:!1,bSort:!1,deferLoading:0,ajax:{url:$("#baseUrl").html()+"/get_campaign_payout_history",type:"post",data:function(e){e.campaign=$(".this_campaign").val()},dataSrc:function(e){return e.data},error:function(e){console.log(e)}},lengthMenu:[[25,50,100,1e3,2e3,3e3],[25,50,100,1e3,2e3,3e3]]});$(document).on("click",".editCampaign",function(){$(this).closest("tr").addClass("selected");var a=$(".editCampaign");a.find("span").removeClass().addClass("glyphicon glyphicon-pencil"),a.attr("disabled","true");var t=$(this);t.find("span").removeClass().addClass("fa fa-spin fa-spinner");var i=$("#editCmpFormModal"),l=$(this).data("id");currentCampaign=l,i.find(".this_campaign").val(l);var n="#cmp-"+l+"-";$("#modal-campaign-title").html(l+" - "+$(n+"name").html()),"undefined"!=typeof $(n+"img").data("img")&&""!=$(n+"img").data("img")||(i.find(".imgPreview").show(),i.find(".imgPreview img").attr("src",$(n+"img img").attr("src")));var o=$("#leadCapVal_edit"),r=$(n+"lct").data("type");0==r?(o.find("input").removeAttr("required"),o.hide()):(o.find("input").attr("required","true"),o.show(),$("#leadCapType_edit").removeClass("col-md-12").addClass("col-md-6"));var d=$(n+"adv").data("adv"),s=i.find("#advertiser");if(""!==d){var c=$("#baseUrl").val()+"/advertisers/"+d+"/status";$.ajax({type:"POST",url:c,success:function(a){if(!a.active){var t=$("#advertiser option[value='"+a.advertiser_id+"']").length>0;t||(s.append($("<option>",{value:a.advertiser_id,text:a.name})),s.val(d).trigger("change"),s.prop("disabled",!1),console.log(a.advertiser_id+" was added!"));var i={value:a.advertiser_id,text:a.name};e(i,inactiveAdvertisers)||inactiveAdvertisers.push(i)}}})}var p=!0;Number($(n+"crtDiff").val())<=30&&"1"!=$("#allowed_force_edit").val()&&(p=!1);var m=$(n+"type").data("type");i.find("#date-created-container").html($(n+"created").val()),i.find("#name").val($(n+"name").html()),i.find("#priority").val($(n+"prio").html()),i.find("#campaign_type").val(m).trigger("change"),s.val(d).trigger("change"),i.find("#lead_type").val(r),i.find("#lead_value").val($(n+"lcv").html()),i.find("#default_payout").val($(n+"dpyt").val()),i.find("#default_received").val($(n+"drcv").html()),i.find("#description").val($(n+"desc").val()),i.find("#notes").val($(n+"notes").html()),i.find('input[name="status"][value="'+$(n+"stat").data("status")+'"]').prop("checked",!0),i.find("#linkout_offer_id").val($(n+"lnkOutOffer").val()),i.find("#program_id").val($(n+"prgId").val()),i.find("#rate").val($(n+"rate").html()),i.find("#publisher_name").val($(n+"pubN").val()),i.find("#advertiser_email").val($(n+"advEmail").val()),i.find('input[name="is_external"][value="'+$(n+"pubE").val()+'"]').prop("checked",!0),p||(i.find("#default_payout").attr("disabled",!0),i.find("#default_received").attr("disabled",!0));var u=$(n+"ctgry").val(),f=i.find("#category");f.val(u).trigger("change");var v=$("#baseUrl").val()+"/categories/"+u+"/status";$.ajax({type:"POST",url:v,success:function(a){if(!a.active){var t=$("#category option[value='"+a.category_id+"']").length>0;t||(f.append($("<option>",{value:a.category_id,text:a.name})),f.val(u).trigger("change"));var i={value:a.category_id,text:a.name};e(i,inactiveCategories)||inactiveCategories.push(i)}}}),$(".this_campaign").val(l);var h=$("#campaign-filter-table").DataTable();h.rows().remove().draw();var _=$("#campaign-filter-group-table").DataTable();_.rows().remove().draw();var y=$("#campaign-affiliate-table").DataTable();y.rows().remove().draw();var C=$("#campaign-payout-table").DataTable();C.rows().remove().draw();var k=$("#baseUrl").html()+"/get_campaign_info";$.ajax({type:"POST",data:{id:l},url:k,success:function(e){var a=e.filter_group_list,n=$(".filterGroupList");if(n.find("option").remove(),null!=a){var o=0;$.each(a,function(e,a){n.append('<option value="'+a+'">'+e+"</option>"),o++}),n.attr("size",o)}var r=e.filter_groups;_.rows().remove().draw(),r.length>0?($.each(r,function(e,a){var t=a.id,i=a.name,l=a.description,n=a.status,o="Inactive";0!=n&&(o="Active");var r='<span id="cfg-'+t+'-name">'+i+"</span>",d='<span id="cfg-'+t+'-desc">'+l+"</span>",s='<span id="cfg-'+t+'-stat" data-status="'+n+'">'+o+"</span>",c='<button id="cfg-'+t+'-view-button" class="btn btn-default viewCampaignFilterGroup" type="button" data-id="'+t+'"><span class="glyphicon glyphicon-eye-open"></span></button>';c+='<button id="cfg-'+t+'-edit-button" class="btn btn-default editCampaignFilterGroup" type="button" data-id="'+t+'"><span class="glyphicon glyphicon-pencil"></span></button>',c+='<button id="cfg-'+t+'-delete-button" class="btn btn-default deleteCampaignFilterGroup" type="button" data-id="'+t+'"><span class="glyphicon glyphicon-trash"></span></button>';var p=[r,d,s,c];_.row.add(p).draw().node()}),$("#addCmpFilter").removeAttr("disabled")):$("#addCmpFilter").attr("disabled",!0),$("#addCmpFilter").click(function(){$(".filterGroupList").prop("selectedIndex",0)});var d=e.affiliates,s=!1;""!=eiqFrameID&&eiqFrameID>0&&eiqFrameID==l&&(s=!0),y.rows().remove().draw(),void 0!=d.affiliated&&$.each(d.affiliated,function(e,a){var t=a.id,i='<input name="select_affiliate[]" class="selectCampaignAffiliate" value="'+t+'" data-name="'+a.affiliate_name+'" type="checkbox"> ',l='<span id="ca-'+t+'-type" data-id="'+a.cap_type+'">'+a.cap_type_name+"</span>",n='<span id="ca-'+t+'-value">'+a.cap_value+"</span>",o='<button id="ca-'+t+'-edit-button" class="btn btn-default editCampaignAffiliate" type="button" data-id="'+t+'"><span class="glyphicon glyphicon-pencil"></span></button>';if(s){var r="ok",d="success";0==a.status&&(r="remove",d="danger"),o+=' <button id="ca-'+a.affiliate_id+'-status-button" class="btn btn-'+d+' eiqFrameStatus" type="button" data-id="'+a.affiliate_id+'" data-status="'+a.status+'"><span class="glyphicon glyphicon-'+r+'-circle"></span></button>',o+=' <button id="ca-'+a.affiliate_id+'-iframe-button" class="btn btn-default eiqFrameTraffic" type="button" data-id="'+a.affiliate_id+'">Iframe Traffic</button>'}else o+=' <button id="ca-'+t+'-delete-button" class="btn btn-default deleteCampaignAffiliate" type="button" data-id="'+t+'"><span class="glyphicon glyphicon-trash"></span></button>';var c=[i,a.affiliate_name,l,n,o],p=y.row.add(c).draw().node();$(p)});var c=e.payouts;$('select[name="payout[]"] option').remove();var p=$('select[name="payout[]"]');$.each(c.available,function(e,a){p.append('<option value="'+e+'">'+a+"</option>")});var m=$('select[name="payout[]"] option').length;m<=10&&$('select[name="payout[]"]').attr("size",m),C.rows().remove().draw(),void 0!=c.affiliate&&$.each(c.affiliate,function(e,a){var t=a.id,i=a.affiliate_name,l='<input name="select_payout[]" class="selectCampaignPayout" value="'+t+'" data-name="'+i+'" type="checkbox">',n='<span id="cp-'+t+'-receivable">'+a.received+"</span>",o='<span id="cp-'+t+'-payable">'+a.payout+"</span>",r='<button id="cp-'+t+'-edit-button" class="btn btn-default editCampaignPayout" type="button" data-id="'+t+'"><span class="glyphicon glyphicon-pencil"></span></button>';r+='<button id="cp-'+t+'-delete-button" class="btn btn-default deleteCampaignPayout" type="button" data-id="'+t+'"><span class="glyphicon glyphicon-trash"></span></button>';var d=[l,i,n,o,r],s=C.row.add(d).draw().node();$(s)});var u=e.config;$("#cmpCfg-url").html(u.post_url),$("#cmpCfg-url-txt input").val(u.post_url),$("#cmpCfg-hdr").text(u.post_header).html(),$("#cmpCfg-hdr-txt textarea").val(u.post_header),$("#cmpCfg-dta").text(u.post_data).html(),$("#cmpCfg-dta-txt textarea").val(u.post_data),$("#cmpCfg-dta-fv").text(u.post_data_fixed_value).html(),$("#cmpCfg-dta-fv-txt textarea").val(u.post_data_fixed_value),$("#cmpCfg-map").text(u.post_data_map).html(),$("#cmpCfg-map-txt textarea").val(u.post_data_map),$("#cmpCfg-mtd").html(u.post_method),$("#cmpCfg-mtd-txt select").val(u.post_method),$("#cmpCfg-scs").text(u.post_success).html(),$("#cmpCfg-scs-txt input").val(u.post_success),$("#cmpCfg-purl").text(u.ping_url).html(),$("#cmpCfg-purl-txt input").val(u.ping_url),$("#cmpCfg-pscs").text(u.ping_success).html(),$("#cmpCfg-pscs-txt input").val(u.ping_success);var f="off",v="NO";ftp_protocol="",1==u.ftp_sent&&(f="on",v="YES"),null!==u.ftp_protocol&&(ftp_protocol=$('#cmpCfg-ftpp-txt select option[value="'+u.ftp_protocol+'"]').html()),$("#cmpCfg-ftps").html(v),$("#if_ftp_sent").bootstrapToggle(f),$("#cmpCfg-ftpp").html(ftp_protocol),$("#cmpCfg-ftpp-txt select").val(u.ftp_protocol),$("#cmpCfg-ftpu").html(u.ftp_username),$("#cmpCfg-ftpu-txt input").val(u.ftp_username),$("#cmpCfg-ftppw").html(u.ftp_password),$("#cmpCfg-ftppw-txt input").val(u.ftp_password),$("#cmpCfg-ftph").html(u.ftp_host),$("#cmpCfg-ftph-txt input").val(u.ftp_host),$("#cmpCfg-ftppt").html(u.ftp_port),$("#cmpCfg-ftppt-txt input").val(u.ftp_port),$("#cmpCfg-ftpto").html(u.ftp_timeout),$("#cmpCfg-ftpto-txt input").val(u.ftp_timeout),$("#cmpCfg-ftpdirectory").html(u.ftp_directory),$("#cmpCfg-ftpdirectory-txt input").val(u.ftp_directory),$("#cmpCfg-email").html(1==u.email_sent?"YES":"No"),$("#if_email_sent").bootstrapToggle(1==u.email_sent?"on":"off"),$("#cmpCfg-emailTo-txt input").val(u.email_to),$("#cmpCfg-emailTo").html(u.email_to),$("#cmpCfg-emailTitle-txt input").val(u.email_title),$("#cmpCfg-emailTitle").html(u.email_title),$("#cmpCfg-emailBody-txt textarea").val(u.email_body),$("#cmpCfg-emailBody").html(u.email_body),$("#campaign_config_interface_form").find(".this_campaign").val(l),content_data=e.content,null==content_data["long"]?long_content="":long_content=content_data["long"],$("#cmpCnt-long-actual").val(long_content),$("#cmpCnt-long-content").val(long_content),null==content_data.stack?stack_content="":stack_content=content_data.stack,$("#cmpCnt-stack-actual").val(stack_content),$("#cmpCnt-stack-content").val(stack_content),g.getDoc().setValue(stack_content),null==content_data.high_paying?high_paying_content="":high_paying_content=content_data.high_paying,$("#cmpCnt-hp-actual").val(high_paying_content),$("#cmpCnt-hp-content").val(high_paying_content);var h="off";1==content_data.stack_lock&&(h="on"),$("#stack_form_lock").bootstrapToggle(h),null==e.posting_instruction?posting_instruction="":posting_instruction=e.posting_instruction,$("#cmp-posting-instruction").val(posting_instruction),$("#cmp-posting-instruction-actual").val(posting_instruction),null==e.sample_code?sample_code="":sample_code=e.sample_code,$("#cmp-sample-code").val(sample_code),$("#cmp-sample-code-actual").val(sample_code),i.modal("show"),t.find("span").removeClass().addClass("glyphicon glyphicon-pencil"),$(".editCampaign").removeAttr("disabled")},error:function(e,a,t){console.log(e+" "+a+" "+t),setTimeout(function(){window.location.href=""},5e3)}}),b.ajax.reload()}),$("#addCmpFormModal").on("hide.bs.modal",function(e){var a=$(this).find(".form_with_file");$(".this_modal_submit").html("Save"),$(".imgPreview").hide(),$(".imgPreview img").attr("src",""),a.find(".this_field").each(function(){"radio"==$(this).attr("type")?$('input[name="'+$(this).attr("name")+'"][value="0"]').prop("checked",!0):$(this).val("")}),a.find("#default_payout").removeAttr("disabled"),a.find("#default_received").removeAttr("disabled"),$(".advertiser-select-add").trigger("change"),$("#leadCapType_add").removeClass("col-md-6").addClass("col-md-12"),$("#leadCapVal_add").hide(),$("#linkoutOfferID_add").hide(),a.find(".this_modal_submit").html("Save"),a.find(".error").each(function(){$(this).removeClass("error"),$(this).removeClass("error_field"),$(this).removeClass("error_label")}),$(".campaign_img").removeClass("error error_field")}),$("#editCmpFormModal").on("hide.bs.modal",function(e){var a=$(this).find(".form_with_file");$(".this_modal_submit").html("Save"),$(".imgPreview").hide(),$(".imgPreview img").attr("src",""),a.find(".this_field").each(function(){"img_type"==$(this).attr("name")?$('input[name="img_type"][value="1"]').prop("checked",!0):"radio"==$(this).attr("type")?$('input[name="'+$(this).attr("name")+'"][value="0"]').prop("checked",!0):$(this).val("")}),a.find("#default_payout").removeAttr("disabled"),a.find("#default_received").removeAttr("disabled"),a.find(".error").each(function(){$(this).removeClass("error"),$(this).removeClass("error_field"),$(this).removeClass("error_label")}),$("#leadCapType_edit").removeClass("col-md-6").addClass("col-md-12"),$("#leadCapVal_edit").hide(),$("#leadCapVal_edit").find("#lead_value").removeAttr("required"),$("#linkoutOfferID_edit").hide(),$("#linkoutOfferID_edit").find("#linkout_offer_id").removeAttr("required"),$(a).find(".this_error_wrapper .this_errors").hide(),$(a).find(".this_error_wrapper .this_errors ul").remove(),a.find(".this_modal_submit").html("Save"),$("#editAffilatesBtn").attr("disabled",!0),$("#deleteAffiliatesBtn").attr("disabled",!0),O=null,$(".campaign_img").removeClass("error error_field"),"hide"==$("#editCampaignLongContent").data("config")&&$("#editCampaignLongContent").click(),"hide"==$("#editCampaignStackContent").data("config")&&$("#editCampaignStackContent").click(),"hide"==$("#editCampaignHighPayingContent").data("config")&&$("#editCampaignHighPayingContent").click(),"hide"==$("#addCmpFilter").data("collapse")&&$("#addCmpFilter").click(),$("#addCampAff").hasClass("collapsed")||$("#addCampAff").click(),$("#addPytAff").hasClass("collapsed")||(console.log("NO COLLAPSE"),$("#addPytAff").click()),"hide"==$("#editCmpConfig").data("config")&&$("#editCmpConfig").click(),$(".selectAllCampaignAffiliate").prop("checked",!1),$("#campaignAffiliateForm").collapse("hide"),$(".capPytSelectAllAff").prop("checked",!1),$("#campaignPayoutForm").collapse("hide"),M=null,$(".cmpCfg-form input").val(""),$(".cmpCfg-form select").val(""),$(".cmpCfg-dsply").html(""),$("#if_ftp_sent").bootstrapToggle("off"),$("#if_email_sent").bootstrapToggle("off"),$("#campaignFilterInfo").collapse("hide"),$("#campaignFilterForm").collapse("hide"),$("#campaignFilterGroupForm").collapse("hide"),"hide"==$("#editPostingInstruction").data("config")&&$("#editPostingInstruction").click(),$("#stack_content_tab .this_error_wrapper").hide(),$("#stack_content_tab .this_error_wrapper .this_errors ul").remove(),g.getDoc().setValue(""),setTimeout(function(){g.refresh()},100);for(var t=0;t<inactiveCategories.length;t++){var i=inactiveCategories[t];$("#category option[value='"+i.value+"']").remove()}inactiveCategories=[];for(var t=0;t<inactiveAdvertisers.length;t++){var l=inactiveAdvertisers[t];$("#advertiser option[value='"+l.value+"']").remove()}inactiveAdvertisers=[],$("#affiliateWebsiteDiv").is(":visible")&&(console.log("visible"),$("#backToCampaignAffiliateBtn").trigger("click")),console.log("edit modal closed and removed all inactive items!"),$('[href="#info_tab"]').trigger("click")}),$(document).on("shown.bs.tab",'a[data-toggle="tab"][href="#stack_content_tab"]',function(){this.refresh()}.bind(g)),$(document).on("click",".deleteCampaign",function(){var e=$(this),a=$(this).data("id"),t=confirm("Are you sure you want to delete this campaign?");if(t===!0){var i=$("#baseUrl").html()+"/delete_campaign";$.ajax({type:"POST",url:i,data:{id:a},success:function(a){console.log(a);var t=$("#campaign-table").DataTable();t.row(e.parents("tr")).remove().draw(),a&&$.each(a,function(e,a){t.cell($("#cmp-"+a+"-prio").parent("td")).data('<span id="cmp-'+a+'prio">'+e+"</span>").draw()}),$("#priority option:last").remove()}})}}),$("#campaignAffiliateForm").on("hide.bs.collapse",function(){var e=$("#addCampAff");e.html('<span class="glyphicon glyphicon-plus"></span>'),$("#addCmpAffiliateBtn").addClass("disabled"),$('select[name="affiliates[]"] option').prop("selected",!1)}),$("#campaignAffiliateForm").on("show.bs.collapse",function(){var e=$("#addCampAff");e.html('<span class="glyphicon glyphicon-remove"></span>')}),$(".closeAffiliateCollapse").on("click",function(){$("#campaignAffiliateForm").collapse("hide")}),$('select[name="affiliates[]"]').change(function(){var e=$('select[name="affiliates[]"] option:selected');e.length>0?$("#addCmpAffiliateBtn").removeClass("disabled"):$("#addCmpAffiliateBtn").addClass("disabled")}),$(".selectAllCampaignAffiliate").on("change",function(e){$(".selectAllCampaignAffiliate").prop("checked",$(this).prop("checked")),$(".selectCampaignAffiliate").prop("checked",$(this).prop("checked")),$(".selectCampaignAffiliate:checked").length>0?($("#editAffilatesBtn").removeAttr("disabled"),currentCampaign!=eiqFrameID&&$("#deleteAffiliatesBtn").removeAttr("disabled")):($("#editAffilatesBtn").attr("disabled",!0),$("#deleteAffiliatesBtn").attr("disabled",!0))}),$(document).on("change",".selectCampaignAffiliate",function(e){var a=0==$('input[name="select_affiliate[]"]:not(:checked)').length;0==a?$(".selectAllCampaignAffiliate").prop("checked",!1):$(".selectAllCampaignAffiliate").prop("checked",!0),
$(".selectCampaignAffiliate:checked").length>0?($("#editAffilatesBtn").removeAttr("disabled"),currentCampaign!=eiqFrameID&&$("#deleteAffiliatesBtn").removeAttr("disabled")):($("#editAffilatesBtn").attr("disabled",!0),$("#deleteAffiliatesBtn").attr("disabled",!0))}),$("#editCampaignAffiliateForm").on("show.bs.collapse",function(){var e=$("#editAffilatesBtn");e.html('<span class="glyphicon glyphicon-remove"></span>'),$(".editCampaignAffiliate").addClass("disabled");var a=$('input[name="select_affiliate[]"]:checked');if(1==a.length)var t="<strong>You are about to edit the affiliate:</strong><br> ";else var t="<strong>You are about to edit the following affiliates:</strong><br> ";$("#selectedAffiliateDiv").html(""),a.each(function(){t+=$(this).data("name")+", ",$("#selectedAffiliateDiv").append('<input name="selected_affiliate[]" type="hidden" value="'+$(this).val()+'"/>')}),$(".selectCampaignAffiliate").attr("disabled",!0),$(".selectAllCampaignAffiliate").attr("disabled",!0),t=t.substring(0,t.length-2),t+=".",$(".listOfCampaignAffiliatesEdit").removeClass("hidden"),$(".listOfCampaignAffiliatesEdit .panel-body").html(t).show();var i=$('input[name="select_affiliate[]"]:checked').val(),l=$("#ca-"+i+"-type").data("id"),n=$("#ca-"+i+"-value").html();$("#edit_lead_cap_type").val(l),$("#edit_lead_cap_value").val(n)}),$("#editCampaignAffiliateForm").on("hide.bs.collapse",function(){var e=$("#editAffilatesBtn");e.html('<span class="glyphicon glyphicon-pencil"></span>'),$(".editCampaignAffiliate").removeClass("disabled"),$(".listOfCampaignAffiliatesEdit").addClass("hidden"),$("#selectedAffiliateDiv").html(""),$(".selectCampaignAffiliate").removeAttr("disabled"),$(".selectAllCampaignAffiliate").removeAttr("disabled")}),$(document).on("click",".closeEditAffiliateCollapse",function(e){$("#editCampaignAffiliateForm").collapse("hide")}),$(document).on("click",".editCampaignAffiliate",function(e){e.preventDefault();var a=$(this).data("id");$(".selectCampaignAffiliate").prop("checked",!1),$('.selectCampaignAffiliate[value="'+a+'"]').trigger("click"),$(".editCampaignAffiliate").addClass("disabled"),$("#editCampaignAffiliateForm").collapse("show")}),$("#addPvtAff").click(function(){var e,a=$('select[name="affiliates[]"] option:selected'),t=$("#addPvtAff");if(a.length>0){e=1==a.length?"new affiliate":"following affiliates";var i=confirm("Are you sure you want to add the "+e+" ?");if(i===!0){t.addClass("disabled");var l=$("#baseUrl").html()+"/add_affiliate_for_campaign";$.ajax({type:"POST",data:{id:$("#editCmpFormModal").find("#this_id.this_campaign").val(),affiliate:$('select[name="affiliates[]"]').val()},url:l,success:function(e){var t=0,i=$("#campaign-affiliate-table").DataTable();$.each(a,function(){var a=($(this).val(),$(this).html()),l=e[t];$(this).remove();var n='<span id="ca-'+l+'-type" data-id="0">Unlimited</span>';n+='<span id="ca-'+l+'-type-select" class="hidden"><span>';var o='<span id="ca-'+l+'-value">0</span>';o+='<span id="ca-'+l+'-value-input" class="hidden">',o+='<input type="text" class="form-control full_width_form_field"/>',o+="</span>";var r='<button id="ca-'+l+'-edit-button" class="btn btn-default editCampaignAffiliate" type="button" data-id="'+l+'"><span class="glyphicon glyphicon-pencil"></span></button>';r+='<button id="ca-'+l+'-update-button" class="btn btn-primary updateCampaignAffiliate hidden" type="button" data-id="'+l+'"><span class="glyphicon glyphicon-floppy-disk"></span></button>',r+='<button id="ca-'+l+'-cancel-button" class="btn btn-default cancelCampaignAffiliate hidden" type="button" data-id="'+l+'"><span class="glyphicon glyphicon-circle-arrow-left"></span></button>',r+='<button id="ca-'+l+'-delete-button" class="btn btn-default deleteCampaignAffiliate" type="button" data-id="'+l+'"><span class="glyphicon glyphicon-trash"></span></button>';var d=[l,a,n,o,r],s=i.row.add(d).draw().node();$(s);leadType_select=$("#ca-"+l+"-type-select").html(_),leadType_select.find("select").addClass("full_width_form_field").val(0).removeClass("this_field").removeClass("hidden").removeAttr("required").removeAttr("name").removeAttr("id"),t++}),$("#campaignAffiliateForm").collapse("hide");var l=$('select[name="affiliates[]"] option').length;l<=10&&$('select[name="affiliates[]"]').attr("size",l)}})}}}),$(document).on("click",".deleteCampaignAffiliate",function(e){e.preventDefault();var a=$(this),t=$(this).data("id");$('input[name="select_affiliate[]"]').prop("checked",!1),$('input[name="select_affiliate[]"][value="'+t+'"]').prop("checked",!0),console.log($('input[name="select_affiliate[]"]').serialize()),$('input[name="select_affiliate[]"][value="'+t+'"]').parents("tr").css("background-color","#ebccd1");var i=confirm("Are you sure you want to delete this Affiliate?");if(i===!0){var l=$("#baseUrl").html()+"/delete_campaign_affiliate";$.ajax({type:"POST",url:l,data:$('input[name="select_affiliate[]"]').serialize(),success:function(e){var t=$("#campaign-affiliate-table").DataTable();t.row(a.parents("tr")).remove().draw(),$('select[name="affiliates[]"] option').remove();var i=$('select[name="affiliates[]"]');$.each(e,function(e,a){i.append('<option value="'+e+'">'+a+"</option>")});var l=$('select[name="affiliates[]"] option').length;l<=10&&$('select[name="affiliates[]"]').attr("size",l)}})}else $('input[name="select_affiliate[]"][value="'+t+'"]').parents("tr").css("background-color","")}),$(document).on("click","#deleteAffiliatesBtn",function(){var e=$('input[name="select_affiliate[]"]:checked');e.each(function(){var e=$(this).val();$('input[name="select_affiliate[]"][value="'+e+'"]').parents("tr").css("background-color","#ebccd1")});var a=confirm("Are you sure you want to delete the ff. campaign affiliates?");if(a===!0){var t=$("#baseUrl").html()+"/delete_campaign_affiliate";$.ajax({type:"POST",url:t,data:e.serialize(),success:function(a){var t=$("#campaign-affiliate-table").DataTable();e.each(function(){var e=$(this).val();t.row($('input[name="select_affiliate[]"][value="'+e+'"]').parents("tr")).remove().draw()}),$('select[name="affiliates[]"] option').remove();var i=$('select[name="affiliates[]"]');$.each(a,function(e,a){i.append('<option value="'+e+'">'+a+"</option>")});var l=$('select[name="affiliates[]"] option').length;l<=10&&$('select[name="affiliates[]"]').attr("size",l),$(".selectAllCampaignAffiliate").prop("checked",!1),$(".selectAllCampaignAffiliate").trigger("change")}})}else e.each(function(){var e=$(this).val();$('input[name="select_affiliate[]"][value="'+e+'"]').parents("tr").css("background-color","")})}),$(document).on("click",".deleteCampaignPayout",function(e){e.preventDefault();var a=$(this),t=$(this).data("id");$('input[name="select_payout[]"]').prop("checked",!1),$('input[name="select_payout[]"][value="'+t+'"]').prop("checked",!0),$('input[name="select_payout[]"][value="'+t+'"]').parents("tr").css("background-color","#ebccd1");var i=confirm("Are you sure you want to delete this campaign payout?");if(i===!0){var l=$("#baseUrl").html()+"/delete_campaign_payout";$.ajax({type:"POST",url:l,data:$('input[name="select_payout[]"]').serialize(),success:function(e){var t=$("#campaign-payout-table").DataTable();t.row(a.parents("tr")).remove().draw(),$("#editPytAff").attr("disabled",!0),$("#deletePytAff").attr("disabled",!0)}})}else $('input[name="select_payout[]"][value="'+t+'"]').parents("tr").css("background-color","")}),$(".filter_value_type").on("change",function(){var e=$(this).val(),a=$("#val-1-text-wrapper"),t=$("#val-1-select-wrapper"),i=$("#val-1-input-wrapper"),l=$("#val-1-date-wrapper"),n=$("#val-1-array-wrapper"),o=$("#val-1-time-wrapper"),r=$("#val-2-input-wrapper"),d=$("#val-2-date-wrapper"),s=$("#val-2-time-wrapper"),c=$("#filter_value_02_wrapper"),p=$('label[for="filter_value_01"]'),m=$('label[for="filter_value_02"]');i.find("input").val(""),t.find("select").val(""),l.find("input").val(""),o.find("input").val(""),r.find("input").val(""),d.find("input").val(""),n.find("textarea").val(""),s.find("input").val(""),a.find("input").removeAttr("required"),i.find("input").removeAttr("required"),t.find("select").removeAttr("required"),l.find("input").removeAttr("required"),o.find("input").removeAttr("required"),r.find("input").removeAttr("required"),d.find("input").removeAttr("required"),n.find("textarea").removeAttr("required"),s.find("input").removeAttr("required"),6==e?(a.addClass("hidden"),t.addClass("hidden"),i.addClass("hidden"),n.addClass("hidden"),l.addClass("hidden"),o.removeClass("hidden"),o.find("input").attr("required",!0),r.addClass("hidden"),d.addClass("hidden"),s.removeClass("hidden"),s.find("input").attr("required",!0),c.removeClass("hidden"),p.html("Minimum Time"),m.html("Maximum Time")):5==e?(t.addClass("hidden"),l.addClass("hidden"),i.addClass("hidden"),a.addClass("hidden"),o.addClass("hidden"),n.removeClass("hidden"),n.find("textarea").attr("required",!0),c.addClass("hidden"),p.html("Array")):4==e?(a.addClass("hidden"),t.addClass("hidden"),l.addClass("hidden"),n.addClass("hidden"),o.addClass("hidden"),i.removeClass("hidden"),i.find("input").attr("required",!0),d.addClass("hidden"),s.addClass("hidden"),r.removeClass("hidden"),r.find("input").attr("required",!0),c.removeClass("hidden"),p.html("Minimum Number"),m.html("Maximum Number")):3==e?(a.addClass("hidden"),t.addClass("hidden"),i.addClass("hidden"),n.addClass("hidden"),o.addClass("hidden"),l.removeClass("hidden"),l.find("input").attr("required",!0),r.addClass("hidden"),s.addClass("hidden"),d.removeClass("hidden"),d.find("input").attr("required",!0),c.removeClass("hidden"),p.html("Minimum Date"),m.html("Maximum Date")):2==e?(a.addClass("hidden"),i.addClass("hidden"),l.addClass("hidden"),n.addClass("hidden"),o.addClass("hidden"),t.removeClass("hidden"),t.find("select").attr("required",!0),c.addClass("hidden"),p.html("Value")):(t.addClass("hidden"),l.addClass("hidden"),i.addClass("hidden"),n.addClass("hidden"),o.addClass("hidden"),a.removeClass("hidden"),a.find("input").attr("required",!0),c.addClass("hidden"),p.html("Value"))}),$(".closeFilterCollapse").click(function(){$("#campaignFilterForm").collapse("hide");var e=$("#addCmpFilter");e.html('<span class="glyphicon glyphicon-plus"></span>'),e.attr("data-collapse","show"),e.data("collapse","show")}),$(document).on("click",".editCampaignFilter",function(){var e=$("#campaignFilterForm"),a=$("#baseUrl").html()+"/edit_campaign_filter";e.find(".this_form").attr("action",a),e.find(".this_form").data("process","edit_campaign_filter"),e.find(".this_form").attr("data-process","edit_campaign_filter"),e.find(".this_form").data("confirmation","Are you sure you want to edit this filter?"),e.find(".this_form").attr("data-confirmation","Are you sure you want to edit this filter?"),$("#for_filter_type").html("Edit Filter");var t=$(this),i=t.data("id"),l=t.data("vtype"),n=t.data("value01"),o=t.data("value02"),r=$("#addCmpFilter"),d=$("#campaignFilterForm");switch(r.html('<span class="glyphicon glyphicon-remove"></span>'),r.attr("data-collapse","hide"),r.data("collapse","hide"),d.collapse("show"),d.find("#this_id").val(i),d.find("#filter_type").val(t.data("ftype")),d.find('input[name="value_type"][value="'+l+'"]').prop("checked",!0),$('input[name="value_type"]:checked').trigger("change"),parseInt(l)){case 1:d.find('input[name="filter_value_01_text"]').val(n);break;case 2:d.find('select[name="filter_value_01_select"]').val(n);break;case 3:d.find('input[name="filter_value_01_date"]').val(n),d.find('input[name="filter_value_02_date"]').val(o);break;case 4:d.find('input[name="filter_value_01_input"]').val(n),d.find('input[name="filter_value_02_input"]').val(o);break;case 5:d.find('textarea[name="filter_value_01_array"]').val(n);break;case 6:d.find('input[name="filter_value_01_time"]').val(n),d.find('input[name="filter_value_02_time"]').val(o)}$("#filter_type").focus()}),$("#campaignFilterForm").on("hidden.bs.collapse",function(e){var a=$(this).find(".this_form");a.find(".this_field").each(function(){$(this).is(":radio")&&($('input[name="value_type"][value="1"]').prop("checked",!0),$('input[name="value_type"]:checked').trigger("change"))}),a.find("#filter_type").val(""),a.find("#filter_value_01_text").val(""),a.find("#filter_value_01_select").val(""),a.find("#filter_value_01_date").val(""),a.find("#filter_value_02_date").val(""),a.find("#filter_value_01_input").val(""),a.find("#filter_value_02_input").val(""),a.find(".error").each(function(){$(this).removeClass("error"),$(this).removeClass("error_field"),$(this).removeClass("error_label")}),a.find(".this_error_wrapper").hide(),$('label[for="for_filter_type"]').html("Add Filter")}),$(".capPytSelectAllAff").on("change",function(e){$(".capPytSelectAllAff").prop("checked",$(this).prop("checked")),$(".selectCampaignPayout").prop("checked",$(this).prop("checked")),$(".selectCampaignPayout:checked").length>0?($("#editPytAff").removeAttr("disabled"),$("#deletePytAff").removeAttr("disabled")):($("#editPytAff").attr("disabled",!0),$("#deletePytAff").attr("disabled",!0))}),$("#campaignPayoutForm").on("show.bs.collapse",function(){var e=$("#addPytAff");e.html('<span class="glyphicon glyphicon-remove"></span>'),$("#editCampaignPayoutForm").collapse("hide"),$('label[for="payout_title"]').html("Add Affiliate Payout")}),$("#campaignPayoutForm").on("hide.bs.collapse",function(){$("#payout_receivable").val(""),$("#payout_payable").val("");var e=$("#addPytAff");e.html('<span class="glyphicon glyphicon-plus"></span>')}),$(".closePayoutCollapse").click(function(){$("#campaignPayoutForm").collapse("hide")}),$(document).on("change",".selectCampaignPayout",function(e){var a=0==$('input[name="select_payout[]"]:not(:checked)').length;0==a?$(".capPytSelectAllAff").prop("checked",!1):$(".capPytSelectAllAff").prop("checked",!0),$("#editCampaignPayoutForm").collapse("hide"),$(".selectCampaignPayout:checked").length>0?($("#editPytAff").removeAttr("disabled"),$("#deletePytAff").removeAttr("disabled")):($("#editPytAff").attr("disabled",!0),$("#deletePytAff").attr("disabled",!0))}),$("#editCampaignPayoutForm").on("show.bs.collapse",function(){var e=$("#editPytAff");e.html('<span class="glyphicon glyphicon-remove"></span>'),$("#campaignPayoutForm").collapse("hide"),$('label[for="payout_title"]').html("Edit Affiliate Payout");var a=$('input[name="select_payout[]"]:checked');if(1==a.length)var t="<strong>You are about to edit the affiliate:</strong><br> ";else var t="<strong>You are about to edit the following affiliates:</strong><br> ";$("#selectedPayoutDiv").html(""),a.each(function(){t+=$(this).data("name")+", ",$("#selectedPayoutDiv").append('<input name="selected_payout[]" type="hidden" value="'+$(this).val()+'"/>')}),t=t.substring(0,t.length-2),t+=".",$(".listOfCampaignAffiliates").removeClass("hidden"),$(".listOfCampaignAffiliates .panel-body").html(t).show();var i=$('input[name="select_payout[]"]:checked').val(),l=$("#cp-"+i+"-receivable").html(),n=$("#cp-"+i+"-payable").html();$("#edit_payout_receivable").val(l),$("#edit_payout_payable").val(n),$(".selectCampaignPayout").attr("disabled",!0),$(".capPytSelectAllAff").attr("disabled",!0),$(".editCampaignPayout").attr("disabled",!0)}),$("#editCampaignPayoutForm").on("hide.bs.collapse",function(){var e=$("#editPytAff");e.html('<span class="glyphicon glyphicon-pencil"></span>'),$('label[for="payout_title"]').html("Add Affiliate Payout"),$(".editCampaignPayout").removeClass("disabled"),$(".listOfCampaignAffiliates").addClass("hidden"),$(".selectCampaignPayout").removeAttr("disabled"),$(".capPytSelectAllAff").removeAttr("disabled"),$(".editCampaignPayout").removeAttr("disabled"),$("#selectedPayoutDiv").html("")}),$(".closeEditPayoutCollapse").click(function(){$("#editCampaignPayoutForm").collapse("hide")}),$(document).on("click",".editCampaignPayout",function(e){$(".editCampaignPayout").addClass("disabled"),$("#editCampaignPayoutForm").collapse("hide");var a=$(this).data("id");$(".selectCampaignPayout").prop("checked",!1),$('.selectCampaignPayout[value="'+a+'"]').trigger("click"),$("#editCampaignPayoutForm").collapse("show")}),$(document).on("click","#deletePytAff",function(){var e=$('input[name="select_payout[]"]:checked');e.each(function(){var e=$(this).val();$('input[name="select_payout[]"][value="'+e+'"]').parents("tr").css("background-color","#ebccd1")});var a=confirm("Are you sure you want to delete the ff. campaign payouts?");if(a===!0){var t=$("#baseUrl").html()+"/delete_campaign_payout";$.ajax({type:"POST",url:t,data:e.serialize(),success:function(a){var t=$("#campaign-payout-table").DataTable();e.each(function(){var e=$(this).val();t.row($('input[name="select_payout[]"][value="'+e+'"]').parents("tr")).remove().draw(),$("#editPytAff").attr("disabled",!0),$("#deletePytAff").attr("disabled",!0)})}})}else e.each(function(){var e=$(this).val();$('input[name="select_payout[]"][value="'+e+'"]').parents("tr").css("background-color","")})}),$(document).on("click","#editCmpConfig",function(){var e=$(this),a=$(this).data("config");"show"==a?(e.html('<span class="glyphicon glyphicon-remove"></span>'),e.attr("data-config","hide").data("config","hide"),$("#campConfigDiv").removeClass("hidden"),$(".cmpCfg-form").removeClass("hidden"),$(".cmpCfg-dsply").addClass("hidden")):(e.html('<span class="glyphicon glyphicon-pencil"></span>'),e.attr("data-config","show").data("config","show"),$("#campConfigDiv").addClass("hidden"),$(".cmpCfg-form").addClass("hidden"),$(".cmpCfg-dsply").removeClass("hidden"))}),$(".cancelCmpConfigEdit").click(function(){var e=$("#editCmpConfig");e.html('<span class="glyphicon glyphicon-pencil"></span>'),e.attr("data-config","show").data("config","show"),$("#campConfigDiv").addClass("hidden"),$(".cmpCfg-form").addClass("hidden"),$(".cmpCfg-dsply").removeClass("hidden")}),$("body").on("hidden.bs.modal","#cmpConfigAutomationModal",function(e){var a=$(this).find("form");a.find(".this_field").val(""),$(".postFieldTr").remove(),$("#cmpConfigAutomationTable").hide(),$("#cmpConfigAutomationSubmit").removeClass("disabled")}),$(document).on("click","#cmpConfigAutomationBtn",function(){var e=$("#cmpCfg-url-txt input").val(),t=$("#cmpCfg-hdr-txt textarea").val(),i=$("#cmpCfg-dta-txt textarea").val(),l=$("#cmpCfg-dta-fv-txt textarea").val(),n=$("#cmpCfg-map-txt textarea").val(),o=$("#cmpCfg-mtd-txt select").val(),r=$("#cmpCfg-scs-txt input").val(),d=$("#campaign_config_interface_form"),s=$("#this_id.this_campaign").val();if(d.find(".this_campaign").val(s),""!=e||""!=t||""!=i||""!=l||""!=n||null!=o||""!=r){$("#cmpConfigAutomationTable").show(),$("#cmpConfigAutomationSubmit").removeClass("disabled"),d.find("#post_url").val(e),d.find("#post_header").val(t),d.find("#post_data_map").val(n),d.find("#post_method").val(o),d.find("#post_success").val(r);var c=e+"?",p=0;if(""!=l&&l.includes("{")&&l.includes("}")){var m=jQuery.parseJSON(l),u=0;$.each(m,function(e,t){c+=e+"="+t+"&";var i=a(e,t,p,!0);$("#cmpConfigAutomationTable tbody #postDataMapDiv").before(i),u++,p++})}if(""!=i&&i.includes("{")&&i.includes("}")){var f=jQuery.parseJSON(i);$.each(f,function(e,t){c+=t+"="+e+"&";var i=a(t,"",p,!1);$("#cmpConfigAutomationTable tbody #postDataMapDiv").before(i),$('select[name="field['+t+']"] option[value="'+e+'"]').length>0?$('select[name="field['+t+']"]').val(e):$('select[name="field['+t+']"]').prepend('<option value="'+e+'" selected>'+e+"</option>"),p++})}"&"==c.substring(c.length-1)&&(c=c.substring(0,c.length-1)),d.find("#posting_url").val(c)}else $("#cmpConfigAutomationSubmit").addClass("disabled");$("#cmpConfigAutomationModal").modal("show")}),$(document).on("click","#cmpConfigAutomationGenerate",function(){var e=$("#campaign_config_interface_form"),t=e.find("#posting_url").val();if($(".postFieldTr").remove(),""!=t.length){for(var i,l=t.substring(0,t.indexOf("?")),n=t.substring(t.indexOf("?")+1).split("&"),o=[],r=n.length-1;r>=0;r--){var i=n[r].split("="),d=i[0];o.push(i[0]);var s=a(d,"",r,!1);$("#cmpConfigAutomationTable tbody #postHeaderDiv").after(s)}e.find("#post_url").val(l),$("#cmpConfigAutomationTable").show(),$("#cmpConfigAutomationSubmit").removeClass("disabled")}else alert("Please enter a posting url!")});$(document).on("change",".fieldSelect",function(){var e=$(this).data("value"),a=$(this).val();"fixed_data"==a?($("#fieldInput-"+e+".fieldInput").show(),$("#fieldInput-"+e+".fieldInput").find("input").attr("required",!0)):($("#fieldInput-"+e+".fieldInput").hide(),$("#fieldInput-"+e+".fieldInput").find("input").removeAttr("required"));var t=$.map($(".fieldSelect"),function(e){if(""!=e.value&&"fixed_data"!=e.value)return e.value});console.log(t),$(".fieldSelect").each(function(){var e=$(this).val();console.log(e),$(this).find("option").each(function(){e!=$(this).val()&&t.indexOf($(this).val())>=0?$(this).addClass("hidden"):$(this).removeClass("hidden")})})}),$(document).on("submit",".noSendForm",function(e){e.preventDefault()}),$(document).on("click","#editCampaignLongContent",function(){var e=$(this),a=$(this).data("config");"show"==a?(e.html('<span class="glyphicon glyphicon-remove"></span>'),e.attr("data-config","hide").data("config","hide"),$(".cmpLngCnt-form-wrapper").removeClass("hidden"),$("#cmpCnt-long-content").removeAttr("disabled")):(e.html('<span class="glyphicon glyphicon-pencil"></span>'),e.attr("data-config","show").data("config","show"),$(".cmpLngCnt-form-wrapper").addClass("hidden"),$("#cmpCnt-long-content").attr("disabled",!0),$("#cmpCnt-long-content").val($("#cmpCnt-long-actual").val()))}),$(".cancelCampaignLongContentEdit").click(function(){var e=$("#editCampaignLongContent");e.html('<span class="glyphicon glyphicon-pencil"></span>'),e.attr("data-config","show").data("config","show"),$(".cmpLngCnt-form-wrapper").addClass("hidden"),$("#cmpCnt-long-content").attr("disabled",!0),$("#cmpCnt-long-content").val($("#cmpCnt-long-actual").val())}),$(document).on("click","#editCampaignStackContent",function(){var e=$(this),a=$(this).data("config");"show"==a?(e.html('<span class="glyphicon glyphicon-remove"></span>'),e.attr("data-config","hide").data("config","hide"),$(".cmpStkCnt-form-wrapper").removeClass("hidden"),$("#cmpCnt-stack-content").removeAttr("disabled"),g.setOption("readOnly",!1)):(e.html('<span class="glyphicon glyphicon-pencil"></span>'),e.attr("data-config","show").data("config","show"),$(".cmpStkCnt-form-wrapper").addClass("hidden"),$("#cmpCnt-stack-content").attr("disabled",!0),$("#cmpCnt-stack-content").val($("#cmpCnt-stack-actual").val()),g.getDoc().setValue($("#cmpCnt-stack-actual").val()),setTimeout(function(){g.refresh(),g.setOption("readOnly",!0)},100)),$("#stack_content_tab .this_error_wrapper").hide(),$("#stack_content_tab .this_error_wrapper .this_errors ul").remove()}),$(".cancelCampaignStackContentEdit").click(function(){var e=$("#editCampaignStackContent");e.html('<span class="glyphicon glyphicon-pencil"></span>'),e.attr("data-config","show").data("config","show"),$(".cmpStkCnt-form-wrapper").addClass("hidden"),$("#cmpCnt-stack-content").attr("disabled",!0),$("#cmpCnt-stack-content").val($("#cmpCnt-stack-actual").val()),g.getDoc().setValue($("#cmpCnt-stack-actual").val()),setTimeout(function(){g.refresh(),g.setOption("readOnly",!0)},100),$("#stack_content_tab .this_error_wrapper").hide(),$("#stack_content_tab .this_error_wrapper .this_errors ul").remove()}),$(document).on("click","#editCampaignHighPayingContent",function(){var e=$(this),a=$(this).data("config");"show"==a?(e.html('<span class="glyphicon glyphicon-remove"></span>'),e.attr("data-config","hide").data("config","hide"),$(".cmpHPCnt-form-wrapper").removeClass("hidden"),$("#cmpCnt-hp-content").removeAttr("disabled")):(e.html('<span class="glyphicon glyphicon-pencil"></span>'),e.attr("data-config","show").data("config","show"),$(".cmpHPCnt-form-wrapper").addClass("hidden"),$("#cmpCnt-hp-content").attr("disabled",!0),$("#cmpCnt-hp-content").val($("#cmpCnt-hp-actual").val()))}),$(".cancelCampaignHighPayingContentEdit").click(function(){var e=$("#editCampaignHighPayingContent");e.html('<span class="glyphicon glyphicon-pencil"></span>'),e.attr("data-config","show").data("config","show"),$(".cmpHPCnt-form-wrapper").addClass("hidden"),$("#cmpCnt-hp-content").attr("disabled",!0),$("#cmpCnt-hp-content").val($("#cmpCnt-hp-actual").val())}),$(document).on("click",".prvCampaignContent",function(e){e.preventDefault();var a=$(this).data("type"),t=$(this).attr("href"),i=$("<form>",{action:t,target:"_blank",method:"POST"}).append($("<input>",{name:"content",value:$("#cmpCnt-content").val(),type:"hidden"})).append($("<input>",{name:"_token",value:$('meta[name="_token"]').attr("content"),type:"hidden"})).append($("<input>",{name:"type",value:a,type:"hidden"}));i.submit()}),$(document).on("click",".prvCmpCnt",function(e){e.preventDefault();var a=$("#this_campaign").val(),t=$(this).attr("href")+a,i=window.open(t,"_blank");i.focus()});var y=[];$("#campaign_sortable").sortable({update:function(e,a){y=$(this).sortable("serialize"),$(".saveSortedCampaignsBtn").show()},change:function(e,a){$(a.item).addClass("selected")}});$(document).on("click","#sortCmpBtn",function(e){e.preventDefault();var a=$(this);a.find("span").removeClass().addClass("fa fa-spin fa-spinner"),$("#sortByPriorityBtn").addClass("active"),$("#sortByRevenueBtn").removeClass("active");var t=$("#baseUrl").html()+"/get_campaigns_for_sort";$("#campaign_sortable tr").remove(),$.ajax({type:"POST",url:t,success:function(e){a.find("span").removeClass().addClass("glyphicon glyphicon-sort-by-attributes"),$("#current_sorting").html(),$.each(e,function(e,a){$("#campaign-priority-sort").append('<tr id="cmpprt-'+a.id+'"><td>'+a.priority+"</td><td>"+a.name+"</td><td>"+a.campaign_type+"</td><td>"+a.status+"</td></tr>"),$("#current_sorting").append('<input type="hidden" name="old_prio[]" value="'+a.id+'">')}),$("#sortCmpModal").modal("show")}})}),$(document).on("click","#sortByPriorityBtn",function(e){e.preventDefault();var a=$(this);a.find("span").removeClass().addClass("fa fa-spin fa-spinner");var t=$("#baseUrl").html()+"/get_campaigns_for_sort";$("#campaign_sortable tr").remove(),$.ajax({type:"POST",url:t,success:function(e){$("#sortByRevenueBtn").removeClass("active"),a.addClass("active"),a.find("span").removeClass().addClass("glyphicon glyphicon-sort-by-attributes"),$("#current_sorting").html(),$.each(e,function(e,a){$("#campaign-priority-sort").append('<tr id="cmpprt-'+a.id+'"><td>'+a.priority+"</td><td>"+a.name+"</td><td>"+a.campaign_type+"</td><td>"+a.status+"</td></tr>"),$("#current_sorting").append('<input type="hidden" name="old_prio[]" value="'+a.id+'">')}),y=$("#campaign_sortable").sortable("serialize"),$(".saveSortedCampaignsBtn").show()}})}),$(document).on("click","#sortByRevenueBtn",function(e){e.preventDefault();var a=$(this);a.find("span").removeClass().addClass("fa fa-spin fa-spinner");var t=$("#baseUrl").html()+"/get_campaigns_by_revenue_for_sort";$("#campaign_sortable tr").remove(),$.ajax({type:"POST",url:t,success:function(e){$("#sortByPriorityBtn").removeClass("active"),a.addClass("active"),a.find("span").removeClass().addClass("glyphicon glyphicon-sort-by-attributes"),$("#current_sorting").html(),$.each(e,function(e,a){$("#campaign-priority-sort").append('<tr id="cmpprt-'+a.id+'"><td>'+a.priority+"</td><td>"+a.name+"</td><td>"+a.campaign_type+"</td><td>"+a.status+"</td></tr>"),$("#current_sorting").append('<input type="hidden" name="old_prio[]" value="'+a.id+'">')}),y=$("#campaign_sortable").sortable("serialize"),$(".saveSortedCampaignsBtn").show()}})}),$(document).on("click",".saveSortedCampaignsBtn",function(e){e.preventDefault();var a=$(".saveSortedCampaignsBtn");a.html('<span class="fa fa-spin fa-spinner"></span>');var t=$("#baseUrl").html()+"/update_campaigns_priority";$.ajax({type:"POST",url:t,data:{campaigns:y,current_sort:$('input[name="old_prio[]"]').serialize()},success:function(e){$("#campaign_sortable tr").remove(),$("#current_sorting").empty(),$.each(e,function(e,a){$("#campaign-priority-sort").append('<tr id="cmpprt-'+a.id+'"><td>'+a.priority+"</td><td>"+a.name+"</td><td>"+a.campaign_type+"</td><td>"+a.status+"</td></tr>"),$("#current_sorting").append('<input type="hidden" name="old_prio[]" value="'+a.id+'">')}),a.html("Update"),a.hide(),$("#campaign_sortable tr").removeClass("selected"),v.ajax.reload()}})}),$("#addCmpFilter").click(function(){var e=$("#campaignFilterForm"),a=$("#baseUrl").html()+"/add_campaign_filter";e.find(".this_form").attr("action",a),e.find(".this_form").data("process","add_campaign_filter"),e.find(".this_form").attr("data-process","add_campaign_filter"),e.find(".this_form").data("confirmation",""),e.find(".this_form").attr("data-confirmation",""),$("#for_filter_type").html("Add Filter"),$('label[for="filter_group"]').html("Add to Filter Group"),$(".edit-filter-filter-group-help-block").addClass("hidden"),e.find("#this_id").val("")}),$("#campaignFilterForm").on("hide.bs.collapse",function(e){var a=$(this).find(".this_form");a.find(".this_field").each(function(){$(this).is(":radio")&&($('input[name="value_type"][value="1"]').prop("checked",!0),$('input[name="value_type"]:checked').trigger("change"))}),a.find("#filter_type").val(""),a.find("#filter_value_01_text").val(""),a.find("#filter_value_01_select").val(""),a.find("#filter_value_01_date").val(""),a.find("#filter_value_02_date").val(""),a.find("#filter_value_01_input").val(""),a.find("#filter_value_02_input").val(""),a.find(".filterGroupList").val(""),a.find(".error").each(function(){$(this).removeClass("error"),$(this).removeClass("error_field"),$(this).removeClass("error_label")}),a.find(".this_error_wrapper").hide(),$('label[for="for_filter_type"]').html("Add Filter");var t=$("#addCmpFilter");t.html('<span class="glyphicon glyphicon-plus"></span> Filter')}),$("#campaignFilterForm").on("show.bs.collapse",function(e){$("#campaignFilterGroupForm").collapse("hide");var a=$("#addCmpFilter");a.html('<span class="glyphicon glyphicon-remove"></span> Filter')}),$(".closeFilterCollapse").click(function(){$("#campaignFilterForm").collapse("hide")}),$(".filter_value_type").on("change",function(){var e=$(this).val(),a=$("#val-1-text-wrapper"),t=$("#val-1-select-wrapper"),i=$("#val-1-input-wrapper"),l=$("#val-1-date-wrapper"),n=$("#val-1-array-wrapper"),o=$("#val-1-time-wrapper"),r=$("#val-2-input-wrapper"),d=$("#val-2-date-wrapper"),s=$("#val-2-time-wrapper"),c=$("#filter_value_02_wrapper"),p=$('label[for="filter_value_01"]'),m=$('label[for="filter_value_02"]');i.find("input").val(""),t.find("select").val(""),l.find("input").val(""),o.find("input").val(""),r.find("input").val(""),d.find("input").val(""),n.find("textarea").val(""),s.find("input").val(""),a.find("input").removeAttr("required"),i.find("input").removeAttr("required"),t.find("select").removeAttr("required"),l.find("input").removeAttr("required"),o.find("input").removeAttr("required"),r.find("input").removeAttr("required"),d.find("input").removeAttr("required"),n.find("textarea").removeAttr("required"),s.find("input").removeAttr("required"),6==e?(a.addClass("hidden"),t.addClass("hidden"),i.addClass("hidden"),n.addClass("hidden"),l.addClass("hidden"),o.removeClass("hidden"),o.find("input").attr("required",!0),r.addClass("hidden"),d.addClass("hidden"),s.removeClass("hidden"),s.find("input").attr("required",!0),c.removeClass("hidden"),p.html("Minimum Time"),m.html("Maximum Time")):5==e?(t.addClass("hidden"),l.addClass("hidden"),i.addClass("hidden"),a.addClass("hidden"),o.addClass("hidden"),n.removeClass("hidden"),n.find("textarea").attr("required",!0),c.addClass("hidden"),p.html("Array")):4==e?(a.addClass("hidden"),t.addClass("hidden"),l.addClass("hidden"),n.addClass("hidden"),o.addClass("hidden"),i.removeClass("hidden"),i.find("input").attr("required",!0),d.addClass("hidden"),s.addClass("hidden"),r.removeClass("hidden"),r.find("input").attr("required",!0),c.removeClass("hidden"),p.html("Minimum Number"),m.html("Maximum Number")):3==e?(a.addClass("hidden"),t.addClass("hidden"),i.addClass("hidden"),n.addClass("hidden"),o.addClass("hidden"),l.removeClass("hidden"),l.find("input").attr("required",!0),r.addClass("hidden"),s.addClass("hidden"),
d.removeClass("hidden"),d.find("input").attr("required",!0),c.removeClass("hidden"),p.html("Minimum Date"),m.html("Maximum Date")):2==e?(a.addClass("hidden"),i.addClass("hidden"),l.addClass("hidden"),n.addClass("hidden"),o.addClass("hidden"),t.removeClass("hidden"),t.find("select").attr("required",!0),c.addClass("hidden"),p.html("Value")):(t.addClass("hidden"),l.addClass("hidden"),i.addClass("hidden"),n.addClass("hidden"),o.addClass("hidden"),a.removeClass("hidden"),a.find("input").attr("required",!0),c.addClass("hidden"),p.html("Value"))}),$(document).on("click",".editCampaignFilter",function(){var e=$("#campaignFilterForm"),a=$("#baseUrl").html()+"/edit_campaign_filter";e.find(".this_form").attr("action",a),e.find(".this_form").data("process","edit_campaign_filter"),e.find(".this_form").attr("data-process","edit_campaign_filter"),e.find(".this_form").data("confirmation","Are you sure you want to edit this filter?"),e.find(".this_form").attr("data-confirmation","Are you sure you want to edit this filter?"),$("#for_filter_type").html("Edit Filter");var t=$(this),i=t.data("id"),l=t.data("vtype"),n=t.data("value01"),o=t.data("value02"),r=t.data("group"),d=($("#addCmpFilter"),$("#campaignFilterForm"));switch(d.find("#this_id").val(i),d.find("#filter_type").val(t.data("ftype")),d.find('input[name="value_type"][value="'+l+'"]').prop("checked",!0),$('input[name="value_type"]:checked').trigger("change"),parseInt(l)){case 1:d.find('input[name="filter_value_01_text"]').val(n);break;case 2:d.find('select[name="filter_value_01_select"]').val(n);break;case 3:d.find('input[name="filter_value_01_date"]').val(n),d.find('input[name="filter_value_02_date"]').val(o);break;case 4:d.find('input[name="filter_value_01_input"]').val(n),d.find('input[name="filter_value_02_input"]').val(o);break;case 5:d.find('textarea[name="filter_value_01_array"]').val(n);break;case 6:d.find('input[name="filter_value_01_time"]').val(n),d.find('input[name="filter_value_02_time"]').val(o)}$('label[for="filter_group"]').html("Update Filter in Filter Group"),$(".edit-filter-filter-group-help-block").removeClass("hidden"),$(".filterGroupList").val(r),d.collapse("show")}),$(document).on("click",".deleteCampaignFilter",function(e){e.preventDefault();var a=($(this),$(this).data("id")),t=$(this).data("group"),i=confirm("Are you sure you want to delete this filter?");if(i===!0){var l=$("#baseUrl").html()+"/delete_campaign_filter";$.ajax({type:"POST",url:l,data:{id:a},success:function(e){filter_group_table=$("#cfg-"+t+"-table"),1==filter_group_table.length?($("#cfg-"+t+"-view-button").trigger("click"),$("#cfg-"+t+"-view-button").trigger("click")):$("#cfg-"+t+"-view-button").trigger("click")}})}}),$("#addCmpFilterGroup").click(function(){var e=$("#campaignFilterGroupForm"),a=$("#baseUrl").html()+"/add_campaign_filter_group";e.find(".this_form").attr("action",a),e.find(".this_form").data("process","add_campaign_filter_group"),e.find(".this_form").attr("data-process","add_campaign_filter_group"),e.find(".this_form").data("confirmation",""),e.find(".this_form").attr("data-confirmation",""),$("#for_filter_type").html("Add Filter Group"),e.find("#this_id").val("")}),$(document).on("click",".editCampaignFilterGroup",function(e){var a=$("#campaignFilterGroupForm"),t=$(this).data("id"),i="#cfg-"+t+"-",l=$("#baseUrl").html()+"/edit_campaign_filter_group";a.find(".this_form").attr("action",l),a.find(".this_form").data("process","edit_campaign_filter_group"),a.find(".this_form").attr("data-process","edit_campaign_filter_group"),a.find(".this_form").data("confirmation","Are you sure you want to edit this filter group?"),a.find(".this_form").attr("data-confirmation","Are you sure you want to edit this filter group?"),$("#for_filter_type").html("Edit Filter Group"),a.find("#this_id").val(t),$("#filter_group_name").val($(i+"name").html()),$("#filter_group_description").val($(i+"desc").html()),$('input[type="radio"][name="filter_group_status"][value="'+$(i+"stat").data("status")+'"]').prop("checked",!0),$("#campaignFilterGroupForm").collapse("show"),$("#filter_group_name").focus()}),$(document).on("click",".deleteCampaignFilterGroup",function(e){e.preventDefault();var a=$(this),t=$(this).data("id"),i=confirm("Are you sure you want to delete this filter group?");if(i===!0){var l=$("#baseUrl").html()+"/delete_campaign_filter_group";$.ajax({type:"POST",url:l,data:{id:t},success:function(e){var i=$("#campaign-filter-group-table").DataTable();i.row(a.parents("tr")).remove().draw(),$('.filterGroupList option[value="'+t+'"]').remove();var l=$(".viewCampaignFilterGroup").length;l>0?($(".filterGroupList").attr("size",l),$("#addCmpFilter").removeAttr("disabled")):$("#addCmpFilter").attr("disabled",!0)}})}}),$("#campaign-filter-group-table tbody").on("click",".viewCampaignFilterGroup",function(){var e=$(this),a=e.data("id"),t=$("#campaign-filter-group-table").DataTable(),i=$(this).closest("tr"),l=t.row(i),n=$("#baseUrl").html()+"/get_campaign_filter_group_filters",o="";l.child.isShown()?(l.child.hide(),i.removeClass("shown"),e.html('<span class="glyphicon glyphicon-eye-open"></span>')):$.ajax({type:"POST",url:n,data:{id:a},success:function(t){if(t.length>0){$(".filter-group-filters-table").DataTable();var n="cfg-"+a+"-table",r='<table id="'+n+'" cellpadding="5" cellspacing="0" border="0" class="table table-bordered filter-group-filters-table" data-id="'+a+'"><thead><tr><th>Filter</th><th>Value</th><th></th></tr></thead></table>',d=0,s=[];$.each(t,function(e,t){var i,l,n=t.id,o=t.value_type;switch(s[d]=o,o){case 1:i=t.value_text,l="";break;case 2:i=t.value_boolean,l="";break;case 3:i=t.value_min_date,l=t.value_max_date;break;case 4:i=t.value_min_integer,l=t.value_max_integer;break;case 5:i=t.value_array,l="";break;case 6:i=t.value_min_time,l=t.value_max_time;break;default:i="",l=""}var r='<span id="cf-'+n+'-filter">'+t.filter_name+"</span>",c='<span id="cf-'+n+'-value">'+t.value_value+"</span>",p='<button id="cf-'+n+'-edit-button" class="btn btn-default editCampaignFilter" type="button" data-id="'+n+'" data-group="'+a+'" data-ftype="'+t.filter_type_id+'" data-vtype="'+o+'" data-value01="'+i+'" data-value02="'+l+'"><span class="glyphicon glyphicon-pencil"></span></button>';p+='<button id="cf-'+n+'-delete-button" class="btn btn-default deleteCampaignFilter" type="button" data-id="'+n+'" data-group="'+a+'"><span class="glyphicon glyphicon-trash"></span></button>',s[d]=[r,c,p],d++}),l.child(r).show(),$("#"+n).DataTable({data:s,bFilter:!1,bInfo:!1,sDom:"rt"})}else o='<span id="cfg-'+a+'-no-table">No Filters.</span>',l.child(o).show();i.addClass("shown"),e.html('<span class="glyphicon glyphicon-remove"></span>')}})}),$("#campaignFilterGroupForm").on("hide.bs.collapse",function(){var e=$(this).find("form"),a=$("#addCmpFilterGroup");a.html('<span class="glyphicon glyphicon-plus"></span> Group'),$("#for_filter_type").html("Add Filter"),$("#filter_group_name").val(""),$("#filter_group_description").val(""),$('input[type="radio"][name="filter_group_status"][value="0"]').prop("checked",!0),e.find(".error").each(function(){$(this).removeClass("error"),$(this).removeClass("error_field"),$(this).removeClass("error_label")}),e.find(".this_error_wrapper").hide()}),$("#campaignFilterGroupForm").on("show.bs.collapse",function(){$("#campaignFilterForm").collapse("hide");var e=$("#addCmpFilterGroup");e.html('<span class="glyphicon glyphicon-remove"></span> Group')}),$(".closeFilterGroupCollapse").click(function(){$("#campaignFilterGroupForm").collapse("hide")}),$('[href="#filter_tab"]').click(function(){0==$("#campaign-filter-group-table tbody tr.shown").length&&$(".viewCampaignFilterGroup").trigger("click")}),$(document).on("click","#editPostingInstruction",function(){var e=$(this),a=$(this).data("config");"show"==a?(e.html('<span class="glyphicon glyphicon-remove"></span>'),e.attr("data-config","hide").data("config","hide"),$(".cmpPI-form-wrapper").removeClass("hidden"),$("#cmp-sample-code").removeAttr("disabled"),$("#cmp-posting-instruction").ckeditorGet().setReadOnly(!1)):(e.html('<span class="glyphicon glyphicon-pencil"></span>'),e.attr("data-config","show").data("config","show"),$(".cmpPI-form-wrapper").addClass("hidden"),$("#cmp-posting-instruction").val($("#cmp-posting-instruction-actual").val()),$("#cmp-sample-code").attr("disabled",!0),$("#cmp-sample-code").val($("#cmp-sample-code-actual").val()),$("#cmp-posting-instruction").ckeditorGet().setReadOnly())}),$(".cancelCampaignPostingInstructionEdit").click(function(){var e=$("#editPostingInstruction");e.html('<span class="glyphicon glyphicon-pencil"></span>'),e.attr("data-config","show").data("config","show"),$(".cmpPI-form-wrapper").addClass("hidden"),$("#cmp-posting-instruction").attr("disabled",!0),$("#cmp-posting-instruction").val($("#cmp-posting-instruction-actual").val()),$("#cmp-sample-code").attr("disabled",!0),$("#cmp-sample-code").val($("#cmp-sample-code-actual").val())}),$(document).on("click","#previewPostingInstruction",function(){var e=$("#cmp-posting-instruction-actual").val(),a=$("#cmp-sample-code-actual").val();$("#posting-tab.previewPostingInstruction").html(e),$(".previewSampleCode").html(a),$("#previewCampaignPostingInstructionModal").modal("show")}),$("#previewCampaignPostingInstructionModal").on("hide.bs.modal",function(e){$("#posting-tab.previewPostingInstruction").html(""),$(".previewSampleCode").html("")}),$("#sortCmpModal").on("hide.bs.modal",function(e){$(".saveSortedCampaignsBtn").hide()}),$.widget("ui.spinner",$.ui.spinner,{_buttonHtml:function(){return'<a class="ui-spinner-button ui-spinner-up ui-corner-tr ui-button ui-widget ui-state-default ui-button-text-only" tabindex="-1" role="button"><i class="fa fa-caret-up fa-sm" aria-hidden="true"></i></a><a class="ui-spinner-button ui-spinner-down ui-corner-br ui-button ui-widget ui-state-default ui-button-text-only" tabindex="-1" role="button"><i class="fa fa-caret-down fa-sm" aria-hidden="true"></i></a>'}}),$(".spinner").spinner({step:.01,numberFormat:"n",min:0,max:1});var C=0,k=!0,A=!0,w=$("#campaign-stack-creative-table").DataTable({responsive:!0,autoWidth:!1,processing:!0,serverSide:!0,order:[[0,"desc"]],columns:[null,{orderable:!1},{orderable:!1},{orderable:!1}],columnDefs:[{width:"10%",targets:0},{width:"55%",targets:1},{width:"30%",targets:2},{width:"5%",targets:3}],bFilter:!1,bLengthChange:!1,bInfo:!1,bPaginate:!1,ajax:{url:$("#baseUrl").html()+"/get_campaign_creative",type:"post",data:function(e){e.campaign_id=$("#campaign_form_builder").find(".this_campaign").val()},error:function(e){console.log(e)},dataSrc:function(e){return console.log(e),k=e.canEdit,A=e.canDelete,e.canAdd?$("#addCampCreative").show():$("#addCampCreative").hide(),e.data}},sDom:'lf<"campaign-stack-creative-table-add-toolbar">rtip',fnDrawCallback:function(e){C=$(".this_campaign").val(),$(".stackCreativeDesc").ckeditor({toolbarGroups:[{name:"clipboard",groups:["clipboard","undo"]},{name:"editing",groups:["find","selection","spellchecker","editing"]},{name:"forms",groups:["forms"]},{name:"basicstyles",groups:["basicstyles","cleanup"]},{name:"paragraph",groups:["list","indent","blocks","align","bidi","paragraph"]},{name:"links",groups:["links"]},{name:"insert",groups:["insert"]},{name:"styles",groups:["styles"]},{name:"colors",groups:["colors"]},{name:"document",groups:["mode","document","doctools"]},{name:"tools",groups:["tools"]},{name:"others",groups:["others"]},{name:"about",groups:["about"]}],removeButtons:"Save,NewPage,Preview,Print,Templates,Cut,Copy,Paste,PasteText,PasteFromWord,Redo,Undo,Find,Replace,SelectAll,Scayt,Form,Checkbox,Radio,TextField,Textarea,Select,Button,ImageButton,HiddenField,RemoveFormat,Language,BidiRtl,BidiLtr,Link,Unlink,Anchor,Image,Flash,Table,HorizontalRule,Smiley,SpecialChar,PageBreak,Iframe,ShowBlocks,About"}),$(".spinner").spinner({step:.01,numberFormat:"n",min:0,max:1,change:function(e,a){$("#"+e.currentTarget.id).parent("span.ui-spinner").removeClass("error_element"),$(this).spinner("isValid")||$("#"+e.currentTarget.id).parent("span.ui-spinner").addClass("error_element")}}),$(".spinner").spinner("disable"),0==k&&$(".editCampaignCreative").hide(),0==A&&$(".deleteCampaignCreative").hide()}});$("div.campaign-stack-creative-table-add-toolbar").html('<button id="addCampCreative" class="btn btn-default pull-right" type="button"><span class="glyphicon glyphicon-plus"></span></button>'),$(document).on("click",".editCampaignCreative",function(){var e=$(this).data("id"),a=$(this).data("type");if("edit"==a)$("#cmpCrtv-"+e+"-desc").ckeditorGet().setReadOnly(!1),$("#cmpCrtv-"+e+"-weight").spinner("enable"),$("#cmpCrtv-"+e+"-imgLinkDiv").show(),$(this).html('<span class="glyphicon glyphicon-remove"></span>'),$("#cmpCrtv-"+e+"-save-button").show(),$(this).data("type","cancel");else{$("#cmpCrtv-"+e+"-desc").ckeditorGet().setReadOnly(!0),$("#cmpCrtv-"+e+"-desc").val($("#cmpCrtv-"+e+"-desc-original").val()),$("#cke_cmpCrtv-"+e+"-desc").removeClass("error_element"),$("#cmpCrtv-"+e+"-weight").spinner("disable").val($("#cmpCrtv-"+e+"-weight-original").val()),$("#cmpCrtv-"+e+"-weight").parent("span.ui-spinner").removeClass("error_element");var t=$("#cmpCrtv-"+e+"-img-original").val();$("#cmpCrtv-"+e+"-imgLinkDiv").hide(),$("#cmpCrtv-"+e+"-img-preview").attr("src",t),$("#cmpCrtv-"+e+"-img").val(t).removeClass("error_field error error_element"),$("#cmpCrtv-"+e+"-imgGalleryAlert").remove(),$(this).html('<span class="glyphicon glyphicon-pencil"></span>'),$("#cmpCrtv-"+e+"-save-button").hide(),$(this).data("type","edit")}}),$(document).on("change",".campaignCreativeImageLink",function(){var e=$(this),a=$(this).data("id"),t=!1;e.removeClass("error_field error"),$("#cmpCrtv-"+a+"-img-preview").on("load",function(){console.log("image loaded correctly")}).on("error",function(){""!=e.val()&&(console.log(e.val()),e.addClass("error_field error").val(""),console.log("error loading image"),t=!0)}).attr("src",$(this).val());var i='<div id="cmpCrtv-'+a+'-imgGalleryAlert" class="col-md-12 alert alert-info" role="alert" style="margin-top: 10px;"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true"></span></button>It is recommended that the image comes from our very own <a href="'+$("#baseUrl").html()+'/admin/gallery" class="alert-link" target="_blank">gallery</a></div>';$(this).val().indexOf($("#baseUrl").html()+"/images/gallery/")<0&&0==$("#cmpCrtv-"+a+"-imgGalleryAlert").length?(console.log("not from gallery"),$("#cmpCrtv-"+a+"-imgLinkDiv").after(i)):console.log("from gallery")}),$(document).on("click",".saveCampaignCreative",function(){var e=$(this).data("id"),a=$("#cmpCrtv-"+e+"-weight").val(),t=$("#cmpCrtv-"+e+"-img").val(),i=$.trim(CKEDITOR.instances["cmpCrtv-"+e+"-desc"].getData()),l=$("#cmpCrtv-"+e+"-weight-original").val(),n=$("#cmpCrtv-"+e+"-desc-original").val(),o=$("#cmpCrtv-"+e+"-img-original").val();if(""==i?$("#cke_cmpCrtv-"+e+"-desc").addClass("error_element"):$("#cke_cmpCrtv-"+e+"-desc").removeClass("error_element"),""==t?$("#cmpCrtv-"+e+"-img").addClass("error_element"):$("#cmpCrtv-"+e+"-img").removeClass("error_element"),$("#cmpCrtv-"+e+"-weight").spinner("isValid")&&!$("#cmpCrtv-"+e+"-img").hasClass("error")&&""!=t&&""!=i)if(a!=l||t!=o||i!=n){var r=confirm("Are you sure you want to edit this creative?");r===!0&&$.ajax({type:"POST",url:$("#baseUrl").val()+"/edit_campaign_creative",data:{id:e,weight:a,image:t,description:i},success:function(l){console.log(l),$("#cmpCrtv-"+e+"-weight-original").val(a),$("#cmpCrtv-"+e+"-desc-original").val(i),$("#cmpCrtv-"+e+"-img-original").val(t),$("#cmpCrtv-"+e+"-edit-button").trigger("click"),alert("Campaign Creative updated!")}})}else console.log("no changes"),$("#cmpCrtv-"+e+"-edit-button").trigger("click");else console.log("NOT A CHANCE")}),$(document).on("click","#addCampCreative",function(){var e=$("#campaign_form_builder").find(".this_campaign").val();$.ajax({type:"POST",url:$("#baseUrl").val()+"/add_campaign_creative",data:{id:e},success:function(e){w.order([]),w.ajax.reload()}})}),$(document).on("click",".deleteCampaignCreative",function(){console.log("Delete");var e=$(this).data("id"),a=$(this),t=confirm("Are you sure you want to delete this creative?");t===!0&&$.ajax({type:"POST",url:$("#baseUrl").val()+"/delete_campaign_creative",data:{id:e},success:function(e){a.parents("tr").remove(),$("#campaign-stack-creative-table tbody tr").length<4?$("#addCampCreative").show():$("#addCampCreative").hide()}})}),$("#cmp-posting-instruction").ckeditor({removeButtons:"Underline,Subscript,Superscript,Scayt,RemoveFormat,About,Copy,Paste,PasteText,PasteFromWord,Cut,Anchor"});var F=0,x=$("#affiliate-website-table").DataTable({responsive:!0,autoWidth:!1,processing:!0,serverSide:!0,order:[[1,"desc"]],columns:[{orderable:!1},null,null,null,null,null,null,{orderable:!1}],ajax:{url:$("#baseUrl").html()+"/get_affiliate_website",type:"post",data:function(e){e.affiliate_id=F},error:function(e){console.log(e)},dataSrc:function(e){return e.data}}});$(document).on("click",".eiqFrameTraffic",function(){var e=$(this).data("id");$(this);x.clear().draw(),F=e,x.ajax.reload(),$("#affiliate_for_website_title").html(e),$("#website_affiliate").val(e),$("#affiliateWebsiteDiv").show(),$("#campaignAffiliateDiv").hide(),$("#campaignAffiliateForm").collapse("hide"),$("#editCampaignAffiliateForm").collapse("hide"),$(".selectCampaignAffiliate").prop("checked",!1).trigger("change"),$(".selectAllCampaignAffiliate").prop("checked",!1),$(".selectAllAffiliateWebsite").prop("checked",!1),$(".selectAffiliateWebsite").prop("checked",!1),$(".editCampaignAffiliate").attr("disabled",!0),$(".deleteCampaignAffiliate").attr("disabled",!0),$(".eiqFrameTraffic").attr("disabled",!0),$(".selectAllCampaignAffiliate").attr("disabled",!0),$(".selectCampaignAffiliate").attr("disabled",!0)}),$(document).on("click","#backToCampaignAffiliateBtn",function(){$("#affiliateWebsiteDiv").hide(),$("#campaignAffiliateDiv").show(),$("#affiliateWebsiteForm").collapse("hide"),$(".editCampaignAffiliate").removeAttr("disabled"),$(".deleteCampaignAffiliate").removeAttr("disabled"),$(".eiqFrameTraffic").removeAttr("disabled"),$(".selectAllCampaignAffiliate").removeAttr("disabled"),$(".selectCampaignAffiliate").removeAttr("disabled")}),$(document).on("click","#addAffiliateWebsite",function(){$(".selectCampaignAffiliate").prop("checked",!1).trigger("change"),$(".selectAllCampaignAffiliate").prop("checked",!1),$(".selectAllAffiliateWebsite").prop("checked",!1),$(".selectAffiliateWebsite").prop("checked",!1)}),$(document).on("click",".closeAffiliateWebsiteCollapse",function(){$("#affiliateWebsiteForm").collapse("hide")}),$(document).on("change",".selectAffiliateWebsite",function(){var e=0==$('input[name="website_id[]"]:not(:checked)').length;0==e?$(".selectAllAffiliateWebsite").prop("checked",!1):$(".selectAllAffiliateWebsite").prop("checked",!0),$('[name="website_id[]"]:checked').length>1?($("#editAffilateWebsitesBtn").removeAttr("disabled"),$("#deleteAffiliateWebsitesBtn").removeAttr("disabled")):($("#editAffilateWebsitesBtn").attr("disabled",!0),$("#deleteAffiliateWebsitesBtn").attr("disabled",!0))}),$(document).on("change",".selectAllAffiliateWebsite",function(){$('[name="website_id[]"]').prop("checked",$(this).prop("checked")),$(".selectAllAffiliateWebsite").prop("checked",$(this).prop("checked")),$('[name="website_id[]"]:checked').length>1?($("#editAffilateWebsitesBtn").removeAttr("disabled"),$("#deleteAffiliateWebsitesBtn").removeAttr("disabled")):($("#editAffilateWebsitesBtn").attr("disabled",!0),$("#deleteAffiliateWebsitesBtn").attr("disabled",!0))}),$("#affiliateWebsiteForm").on("show.bs.collapse",function(e){var a=$("#addAffiliateWebsite span");a.removeClass("glyphicon-plus").addClass("glyphicon-remove"),$(".selectAffiliateWebsite").attr("disabled",!0),$(".selectAllAffiliateWebsite").attr("disabled",!0),$(".editAffiliateWebsite").attr("disabled",!0),$(".deleteAffiliateWebsite").attr("disabled",!0),$("#affiliateWebsitePayoutForm").collapse("hide")}),$("#affiliateWebsiteForm").on("hide.bs.collapse",function(e){var a=$("#affiliate_website_form"),t=$("#addAffiliateWebsite span"),i=$("#baseUrl").html()+"/add_affiliate_website";t.removeClass("glyphicon-remove").addClass("glyphicon-plus"),a.attr("action",i),a.data("confirmation","").attr("data-confirmation",""),a.find("#website_name").val(""),a.find("#website_payout").val(""),a.find("#website_description").val(""),a.find("#website_id").val(""),a.find("#revenue_tracker_id").val(""),a.find('[name="allow_datafeed"][value="0"]').prop("check"),a.find(".error").each(function(){$(this).removeClass("error"),$(this).removeClass("error_field"),$(this).removeClass("error_label")}),a.find(".this_error_wrapper").hide(),$(".selectAffiliateWebsite").removeAttr("disabled"),$(".selectAllAffiliateWebsite").removeAttr("disabled"),$(".editAffiliateWebsite").removeAttr("disabled"),$(".deleteAffiliateWebsite").removeAttr("disabled")}),$("#affiliateWebsitePayoutForm").on("show.bs.collapse",function(e){var a=$("#editAffilateWebsitesBtn span");a.removeClass("glyphicon-pencil").addClass("glyphicon-remove"),$(".selectAffiliateWebsite").attr("disabled",!0),$(".selectAllAffiliateWebsite").attr("disabled",!0),$(".editAffiliateWebsite").attr("disabled",!0),$(".deleteAffiliateWebsite").attr("disabled",!0),$("#affiliateWebsiteForm").collapse("hide")}),$("#affiliateWebsitePayoutForm").on("hide.bs.collapse",function(e){var a=$("#affiliate_website_payout_form"),t=$("#editAffilateWebsitesBtn span");t.removeClass("glyphicon-remove").addClass("glyphicon-pencil"),a.find("#website_payout").val(""),$(".selectAffiliateWebsite").removeAttr("disabled"),$(".selectAllAffiliateWebsite").removeAttr("disabled"),$(".editAffiliateWebsite").removeAttr("disabled"),$(".deleteAffiliateWebsite").removeAttr("disabled"),$(".listOfAffiliateWebsitesEdit").addClass("hidden"),$(".putListOfWebsitesHere").html("")}),$(document).on("click",".closeAffiliateWebsitePayoutCollapse",function(){$("#affiliateWebsitePayoutForm").collapse("hide")}),$(document).on("click",".editAffiliateWebsite",function(){var e=$(this).data("id"),a=$("#affiliate_website_form"),t=$("#baseUrl").html()+"/edit_affiliate_website";$(".selectAffiliateWebsite").prop("checked",!1),$('[name="website_id[]"][value="'+e+'"]').prop("checked",!0).trigger("change"),a.attr("action",t),a.data("confirmation","Are you sure you want to edit this?").attr("data-confirmation","Are you sure you want to edit this?"),a.find("#website_name").val($("#afWeb-"+e+"-name").html()),a.find("#website_payout").val($("#afWeb-"+e+"-pay").html()),a.find("#website_description").val($("#afWeb-"+e+"-desc").html()),a.find("#website_id").val(e),a.find("#revenue_tracker_id").val($("#afWeb-"+e+"-revTracker").html()),a.find('[name="allow_datafeed"][value="'+$("#afWeb-"+e+"-pay").val()+'"]').prop("check"),$("#affiliateWebsiteForm").collapse("show")}),$(document).on("click","#editAffilateWebsitesBtn",function(){var e=$("#affiliateWebsitePayoutForm");if("true"==e.attr("aria-expanded"))e.collapse("hide");else{var a=$("#affiliate_website_form"),t=$('[name="website_id[]"]:checked'),i=t[0].value;if(1==t.length)console.log("hello"),$('.editAffiliateWebsite[data-id="'+i+'"]').trigger("click");else{var l=$("#afWeb-"+i+"-pay").html(),a=$("#affiliate_website_payout_form"),n="";a.find("#website_payout").val(l),$("#affiliateWebsitePayoutForm").collapse("show"),$("#selectedAffiliateWebsiteDiv").html(""),t.each(function(){n+=$("#afWeb-"+$(this).val()+"-name").html()+", ",$("#selectedAffiliateWebsiteDiv").append('<input name="selected_websites[]" type="hidden" value="'+$(this).val()+'"/>')}),n=n.substring(0,n.length-2),n+=".",$(".listOfAffiliateWebsitesEdit").removeClass("hidden"),$(".putListOfWebsitesHere").html(n).show()}}}),$(document).on("click",".deleteAffiliateWebsite",function(e){e.preventDefault();var a=$(this);id=$(this).data("id"),a.parents("tr").css("background-color","#ebccd1");var t=confirm("Are you sure you want to delete this website?");if(t===!0){var i=$("#baseUrl").html()+"/delete_affiliate_website/"+id;$.ajax({type:"POST",url:i,data:{id:id},success:function(e){var t=$("#affiliate-website-table").DataTable();t.row(a.parents("tr")).remove().draw()}})}else a.parents("tr").css("background-color","")}),$(document).on("click","#deleteAffiliateWebsitesBtn",function(e){e.preventDefault();$(this);ids=$('[name="website_id[]"]:checked'),websites=[],ids.parents("tr").css("background-color","#ebccd1"),ids.each(function(){websites.push($(this).val())});var a=confirm("Are you sure you want to delete these websites?");if(a===!0){var t=$("#baseUrl").html()+"/delete_multiple_affiliate_website";$.ajax({type:"POST",url:t,data:{id:websites},success:function(e){var a=$("#affiliate-website-table").DataTable();a.draw()}})}else ids.parents("tr").css("background-color","")}),$(document).on("click",".eiqFrameStatus",function(e){e.preventDefault();var a=$(this),t=$(this).data("id"),i=$(this).data("status");1==i?confirm_stat="DEACTIVATE":confirm_stat="ACTIVATE";var l=confirm("You are about to "+confirm_stat+" this affiliate from running our Iframe. Click 'OK' to confirm.");if(l===!0){var n=$("#baseUrl").html()+"/update_affiliate_website_status";$.ajax({type:"POST",url:n,data:{affiliate_id:t,status:i},success:function(e){new_status=e.new_status,update_count=e.update_count,update_count>0?(1==new_status?(curIcon="glyphicon-remove-circle",newIcon="glyphicon-ok-circle",curBtn="btn-danger",newBtn="btn-success"):(curIcon="glyphicon-ok-circle",newIcon="glyphicon-remove-circle",curBtn="btn-success",newBtn="btn-danger"),a.attr("data-status",new_status).data("status",new_status),a.removeClass(curBtn).addClass(newBtn),a.find("span").removeClass(curIcon).addClass(newIcon)):alert("Affiliate does not have any websites.")}})}}),CKEDITOR.config.readOnly=!0,CKEDITOR.config.allowedContent=!0,CKEDITOR.config.contentsCss="http://path6.paidforresearch.com/dynamic_live/css/style.css",CKEDITOR.config.contentsCss="http://path6.paidforresearch.com/dynamic_live/css/mobile.css",CKEDITOR.config.contentsCss="http://path6.paidforresearch.com/dynamic_live/css/stack.css",$.fn.modal.Constructor.prototype.enforceFocus=function(){modal_this=this,$(document).on("focusin.modal",function(e){modal_this.$element[0]===e.target||modal_this.$element.has(e.target).length||$(e.target.parentNode).hasClass("cke_dialog_ui_input_select")||$(e.target.parentNode).hasClass("cke_dialog_ui_input_text")||modal_this.$element.focus()})};var T=($("#formFieldsTable tbody").sortable({handle:".sortFieldHandle",items:"tr:not(.sortDisabled)"}),[]),q=[],j=$.parseJSON($("#standardRequiredFields").val());standard_lf_fields=$.parseJSON($("#standardLFRequiredFields").val());var P=CodeMirror.fromTextArea($("#custom_css")[0],{theme:"default",lineNumbers:!0,matchBrackets:!0,mode:"css",indentUnit:4,indentWithTabs:!0}),S=CodeMirror.fromTextArea($("#custom_js")[0],{theme:"default",lineNumbers:!0,matchBrackets:!0,mode:"text/html",indentUnit:4,indentWithTabs:!0}),B=CodeMirror.fromTextArea(document.getElementById("stack_code"),{theme:"default",lineNumbers:!0,matchBrackets:!0,mode:"application/x-httpd-php",indentUnit:4,indentWithTabs:!0,readOnly:!0});$(document).on("click",".campaignFormBuilder",function(){var e=$(this).data("id"),a=$(this).data("type"),i=$("#campaign_form_builder"),l=$("#baseUrl").html()+"/get_campaign_content";i.find("#this_campaign").val(e),$(".this_campaign").val(e),$("#form-builder-campaign").html(e+" - "+$("#cmp-"+e+"-name").html()),$("#formBuilderCampaignType").val(a),5==a||6==a?($(".formBuilderCoregElement").hide(),$(".formBuilderCoregElement").find('[name="send_lead_to"]').removeAttr("required"),$(".formBuilderLinkoutElement").show(),$(".formBuilderLinkoutElement").find('[name="redirect_link"]').attr("required",!0)):($(".formBuilderCoregElement").show(),$(".formBuilderCoregElement").find('[name="send_lead_to"]').attr("required",!0),$(".formBuilderLinkoutElement").hide(),$(".formBuilderLinkoutElement").find('[name="redirect_link"]').removeAttr("required")),$.ajax({type:"POST",data:{id:e,type:a},url:l,success:function(e){if(console.log(e),"undefined"!=typeof e.auto_lock&&1==e.auto_lock&&(autoLockAlert='<div id="autoLockAlert" class="alert alert-warning alert-dismissible" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button><strong>Warning!</strong> Content was automatically locked since it contained php codes.</div>',$("#cmpFormBuilderModal").find(".modal-body").prepend(autoLockAlert)),null!=e.content){var l=e.form;$("#formFieldsTable tbody");i.find("#stack_code").val(e.content),B.getDoc().setValue(e.content),1==e.lock&&$(".form_builder_btn").attr("disabled",!0),5==a?i.find("#redirect_link").val(l.redirect_link):"lead_reactor"==l.action||"lead_filter"==l.action?$("#formBuilderSendLeadSelect").val(l.action):($("#formBuilderSendLeadSelect").val("custom").change(),$("#formBuilderCustomUrlInput").val(l.action)),i.find("#form_id").val(l.id),i.find("#form_class").val(l["class"]),T=e.fields,$.each(e.fields,function(e,a){q.push(a.name);t(e)}),custom=e.custom,i.find("#custom_css").val(custom.css),P.getDoc().setValue(custom.css),i.find("#custom_js").val(custom.js),S.getDoc().setValue(custom.js)}else T=[],q=[],B.getDoc().setValue("");w.ajax.reload(),$("#cmpFormBuilderModal").modal("show")}})}),$(document).on("shown.bs.tab",'a[data-toggle="tab"][href="#customs_tab"]',function(){this.refresh()}.bind(P)),$(document).on("shown.bs.tab",'a[data-toggle="tab"][href="#customs_tab"]',function(){this.refresh()}.bind(S)),$(document).on("shown.bs.tab",'a[data-toggle="tab"][href="#code_tab"]',function(){this.refresh()}.bind(B)),$(document).on("click",".removeFieldBtn",function(){if(confirmation=confirm("Are you sure you want to delete this field?"),confirmation){var e=$(this).data("id");delete T[e],delete q[e],$(this).parents("tr").remove()}}),$(document).on("change","#formBuilderFieldTypeSelect",function(){var e=$(this).val();"article"==e?($(".input_field_group").hide(),$(".article_field_group").show(),$("#form_builder_field #name").removeAttr("required")):"dropdown"==e||"radio"==e||"checkbox"==e?($(".input_field_group").show(),$(".article_field_group").hide(),$("#form_builder_field #name").attr("required",!0),$(".value_group_two").show(),$(".value_group_one").hide()):($(".input_field_group").show(),$(".article_field_group").hide(),$("#form_builder_field #name").attr("required",!0),$(".value_group_two").hide(),$(".value_group_one").show())}),$(document).on("click",".viewFieldModalBtn",function(){var e=$(this).data("id"),a=T[e],t=$("#cmpFormFieldModal");t.find(".modal-title").html("Edit Field"),t.find("#label").val(a.label),t.find("#name").val(a.name),t.find("#id").val(a.id),t.find("#class").val(a["class"]),t.find("#field_id").val(e),t.find("#formBuilderFieldTypeSelect").val(a.type).trigger("change"),"hidden"==a.type||"text"==a.type||"textbox"==a.type?$('select[name="value_select"] option[value="'+a.value+'"]').length>0?($('select[name="value_select"]').val(a.value),$('input[name="value_input"]').val("")):($('select[name="value_select"]').val(""),$('input[name="value_input"]').val(a.value)):"article"==a.type?$("#article").val(a.value):$.each(a.options.values,function(e,t){var l=!1,n=!1,o=a.options.displays;a.value==t&&(l=!0),a.has_accepts&&($key=a.accepted_options.indexOf(t),$key>=0&&(n=!0)),""!=t&&i(t,o[e],l,n)}),a.standard?required=!0:(required=!1,a.hasOwnProperty("validation")&&a.validation.hasOwnProperty("required")&&(required=a.validation.required)),$('[name="validation[]"][value="required"]').prop("checked",required),a.hasOwnProperty("validation")&&("undefined"!=typeof a.validation.alphaNumeric&&$('[name="validation[]"][value="alphaNumeric"]').prop("checked",a.validation.alphaNumeric),"undefined"!=typeof a.validation.alphaSpace&&$('[name="validation[]"][value="alphaSpace"]').prop("checked",a.validation.alphaSpace),"undefined"!=typeof a.validation.date&&$('[name="validation[]"][value="date"]').prop("checked",a.validation.date),"undefined"!=typeof a.validation.digits&&$('[name="validation[]"][value="digits"]').prop("checked",a.validation.digits),
"undefined"!=typeof a.validation.email&&$('[name="validation[]"][value="email"]').prop("checked",a.validation.email),"undefined"!=typeof a.validation.equalTo&&($('[name="validation[]"][value="equalTo"]').prop("checked",!0).trigger("change"),$('input[name="equal_to_value"]').val(a.validation.equalTo)),"undefined"!=typeof a.validation.max&&($('[name="validation[]"][value="max"]').prop("checked",!0).trigger("change"),$('input[name="max_value"]').val(a.validation.max)),"undefined"!=typeof a.validation.min&&($('[name="validation[]"][value="min"]').prop("checked",!0).trigger("change"),$('input[name="min_value"]').val(a.validation.min)),"undefined"!=typeof a.validation.number&&$('[name="validation[]"][value="number"]').prop("checked",a.validation.number),"undefined"!=typeof a.validation.phoneUS&&$('[name="validation[]"][value="phoneUS"]').prop("checked",a.validation.phoneUS),"undefined"!=typeof a.validation.range&&($('[name="validation[]"][value="range"]').prop("checked",!0).trigger("change"),range=$.parseJSON(a.validation.range),$('input[name="range_min_value"]').val(range[0]),$('input[name="range_max_value"]').val(range[1])),"undefined"!=typeof a.validation.url&&$('[name="validation[]"][value="url"]').prop("checked",a.validation.url),"undefined"!=typeof a.validation.zip&&$('[name="validation[]"][value="zip"]').prop("checked",a.validation.zip),"undefined"!=typeof a.validation.zip&&$('[name="validation[]"][value="zip"]').prop("checked",a.validation.zip),"undefined"!=typeof a.validation.minWordCount&&($('[name="validation[]"][value="minWordCount"]').prop("checked",!0).trigger("change"),$('input[name="min_word_count_value"]').val(a.validation.minWordCount))),t.modal("show")}),$(document).on("click","#addFormField",function(){$("#cmpFormFieldModal").modal("show")}),$(document).on("change","#formBuilderSendLeadSelect",function(){var e=$(this).val(),a=$("#formBuilderCustomUrlInput"),i=$("#campaign_form_builder");"custom"==e?a.show():(a.hide(),""!=e&&($.each(j,function(e,a){if(q.indexOf(e)<0){var l=$("#formFieldsTable tbody tr").length,n=a;"eiq_campaign_id"==e&&(n=i.find("#this_campaign").val()),field={"class":"",id:"",label:"",name:e,standard:!0,type:"hidden",value:n},T[T.length]=field,q[q.length]=e,field_content=t(l)}}),"lead_filter"==e&&$.each(standard_lf_fields,function(e,a){if(q.indexOf(e)<0){var l=$("#formFieldsTable tbody tr").length,n=a;"program_id"==e?n=i.find("#this_campaign").val():"program_name"==e&&(n=$("#cmp-"+i.find("#this_campaign").val()+"-name").html()),field={"class":"",id:"",label:"",name:e,standard:!1,type:"hidden",value:n},T[T.length]=field,q[q.length]=e,field_content=t(l)}})))});$("#fieldValueTable tbody").sortable({handle:".sortValueHandle"});$(document).on("click",".removeRowFielValue",function(){$(this).parents("tr").remove()}),$(document).on("click",".clearFieldValueTable",function(){$("#fieldValueTable tbody").html("")}),$(document).on("click","#addFieldValueBtn",function(){i("","",!1,!1),$('#fieldValueTable tbody tr:last [name="field_value[]"]').focus()}),$(document).on("click","#addRangeValuesBtn",function(){var e=($("#fieldValueTable tbody"),$("#min_range_value").val()),a=$("#max_range_value").val();if(e>a)for(var t=e;t>=a;t--)i(t,t,!1,!1);else for(var t=e;t<=a;t++)i(t,t,!1,!1);$("#rangeValueCollapse").collapse("hide")}),$("#cmpFormBuilderModal").on("hide.bs.modal",function(e){return $(".editCampaignCreative .glyphicon-remove").length>0?(alert("Save unfinished campaign creatives before closing the form builder."),$('#cmpFormBuilderModal [href="#creatives_tab"]').trigger("click"),e.preventDefault(),e.stopImmediatePropagation(),!1):($("#form-builder-campaign").html(""),$(".form_builder_btn").removeAttr("disabled"),$("#formBuilderSendLeadSelect").val("").trigger("change"),$("#campaign_form_builder").find(".this_field").val(""),$("#formFieldsTable tbody").html(""),$("#autoLockAlert").remove(),$('#cmpFormBuilderModal [href="#form_tab"]').trigger("click"),P.getDoc().setValue(""),S.getDoc().setValue(""),B.getDoc().setValue(""),void setTimeout(function(){P.refresh(),S.refresh(),B.refresh()},100))}),$("#cmpFormFieldModal").on("hide.bs.modal",function(){$("#cmpFormFieldModal .modal-title").html("Add Field"),$("#cmpFormFieldModal .this_field").val(""),$("#formBuilderFieldTypeSelect").trigger("change"),$('[name="validation[]"]').prop("checked",!1),$('[name="validation[]"][value="required"]').prop("checked",!0),$("#fieldValueTable tbody").html(""),$('[name="equal_to_value"]').removeAttr("required"),$('[name="range_min_value"]').removeAttr("required"),$('[name="range_max_value"]').removeAttr("required"),$('[name="min_value"]').removeAttr("required"),$('[name="max_value"]').removeAttr("required"),$('[name="min_word_count_value"]').removeAttr("required"),$("#uploadValueCollapse").collapse("hide"),$(".selectAcceptedValues").prop("checked",!1)}),$("#rangeValueCollapse").on("hidden.bs.collapse",function(){$("#min_range_value").val(""),$("#max_range_value").val("")}),$("#rangeValueCollapse").on("show.bs.collapse",function(){$("#uploadValueCollapse").collapse("hide")}),$("#uploadValueCollapse").on("show.bs.collapse",function(){$("#rangeValueCollapse").collapse("hide")}),$(document).on("submit","#form_builder_field",function(e){e.preventDefault();var a=$(this),i=$("#field_id").val(),l=new Object,n=!1;if(l.name=a.find("#name").val(),l.type=$("#formBuilderFieldTypeSelect").val(),l.id=a.find("#id").val(),l["class"]=a.find("#class").val(),l.label=a.find("#label").val(),"article"==l.type)if(l.value=a.find("#article").val(),prev_val=l.value,prev_val=prev_val.replace(/<a\b[^>]*>(.*?)<\/a>/i,""),prev_val=prev_val.replace(/<\/?[^>]+(>|$)/g,""),prev_val=prev_val.substr(0,150),l.value.length>150&&(prev_val+="..."),field_value="<small><em>"+prev_val+"</em></small>",i>0||""!=i)T[i]=l,$("#fbf-name-"+i).html(""),$("#fbf-type-"+i).html(l.type),$("#fbf-value-"+i).html(field_value);else{var o=T.length;T[o]=l,q[q.length]=l.name,field_content=t(o)}else{if("dropdown"==l.type||"radio"==l.type||"checkbox"==l.type){var r=new Array,d=new Array,s=$('[name="field_value[]"]'),c=!1,p=new Array;$('[name="field_display[]"]').each(function(e,a){r.push($(s[e]).val()),d.push($(a).val())}),options={values:r,displays:d},l.options=options,$('[name="accepted[]"]').each(function(e,a){$(this).prop("checked")&&(c=!0,value=$("#fieldValueTable tbody tr:nth("+e+")").find('[name="field_value[]"]').val(),p.push(value))}),l.has_accepts=c,l.accepted_options=p,l.value="",$('[name="default_value"]:checked').length>0&&(this_index=$('[name="default_value"]:checked').val(),l.value=$("#fieldValueTable tbody tr:nth("+this_index+")").find('[name="field_value[]"]').val())}else""!=$('[name="value_select"]').val()?(l.value=$('[name="value_select"]').val(),n=!0):""!=$('[name="value_input"]').val()?l.value=$('[name="value_input"]').val():l.value="";var m={};if($('[name="validation[]"]').each(function(e,a){var t=$(this).val();"equalTo"==t?$(this).prop("checked")&&(m[t]=$('[name="equal_to_value"]').val()):"min"==t?$(this).prop("checked")&&(m[t]=$('[name="min_value"]').val()):"max"==t?$(this).prop("checked")&&(m[t]=$('[name="max_value"]').val()):"range"==t?$(this).prop("checked")&&(m[t]="["+$('[name="range_min_value"]').val()+","+$('[name="range_max_value"]').val()+"]"):"minWordCount"==t?$(this).prop("checked")&&(m[t]=$('[name="min_word_count_value"]').val()):m[t]=$(this).prop("checked")}),l.validation=m,i>0||""!=i){T[i]=l,q[i]=l.name,value_display=l.value,1==n&&(value_display=$('[name="value_select"] option[value="'+l.value+'"]').html()),""!=value_display?("dropdown"==l.type||"checkbox"==l.type||"radio"==l.type?(def_val_indx=l.options.values.indexOf(l.value),def_val=value_display,def_val!=l.options.displays[def_val_indx]&&(def_val+=" - "+l.options.displays[def_val_indx])):def_val=value_display,def_val_prev=def_val.substr(0,74),def_val.length>74&&(def_val_prev+="..."),field_value='<span class="label label-primary">'+def_val_prev+"</span>"):field_value="","dropdown"!=l.type&&"checkbox"!=l.type&&"radio"!=l.type||void 0!=typeof l.options&&(fieldCounter=0,$.each(l.options.values,function(e,a){if(""!=a){if(!(fieldCounter<=3))return field_value+=' <span class="label label-info">...</span>',!1;a!=l.value&&(a==l.options.displays[e]?opt_val=a:opt_val=a+" - "+l.options.displays[e],opt_val_prev=opt_val.substr(0,74),opt_val.length>74&&(opt_val_prev+="..."),field_value+=' <span class="label label-info">'+opt_val_prev+"</span>",fieldCounter++)}}));var u=l.name;""!=l.label&&(u+="<br><small><em>"+l.label.substr(0,74),l.label.length>74&&(u+="..."),u+="</em></small>"),$("#fbf-name-"+i).html(u),$("#fbf-type-"+i).html(l.type),$("#fbf-value-"+i).html(field_value)}else{var o=T.length;T[o]=l,q[q.length]=l.name,field_content=t(o)}}$("#cmpFormFieldModal").modal("hide")}),$(document).on("change",'[name="validation[]"]',function(){var e=$(this).val(),a=$(this).prop("checked");"equalTo"==e?a?$('[name="equal_to_value"]').attr("required",!0):$('[name="equal_to_value"]').removeAttr("required"):"range"==e?a?($('[name="range_min_value"]').attr("required",!0),$('[name="range_max_value"]').attr("required",!0)):($('[name="range_min_value"]').removeAttr("required"),$('[name="range_max_value"]').removeAttr("required")):"min"==e?a?$('[name="min_value"]').attr("required",!0):$('[name="min_value"]').removeAttr("required"):"max"==e?a?$('[name="max_value"]').attr("required",!0):$('[name="max_value"]').removeAttr("required"):"minWordCount"==e&&(a?$('[name="min_word_count_value"]').attr("required",!0):$('[name="min_word_count_value"]').removeAttr("required"))}),$(document).on("submit","#campaign_form_builder",function(e){e.preventDefault();var a=$("#campaign_form_builder"),t=[],i=$("#cmpConfigAutomationSubmit");return $(".editCampaignCreative .glyphicon-remove").length>0?(alert("Campaign Form Builder NOT SAVED YET. Save unfinished campaign creatives first."),void $('[href="#creatives_tab"]').trigger("click")):(confirmation=confirm("Are you sure you want to update this campaign content?"),void(confirmation&&($("#formFieldsTable tbody tr").each(function(e,a){t.push(T[$(this).data("id")])}),i.attr("disabled","true"),i.html('<i class="fa fa-spin fa-spinner"></i>'),$.ajax({type:"POST",data:{id:a.find(".this_campaign").val(),type:$("#formBuilderCampaignType").val(),"form[url]":$("#formBuilderSendLeadSelect").val(),"form[custom_url]":a.find('[name="custom_url"]').val(),"form[id]":a.find('[name="form_id"]').val(),"form[class]":a.find('[name="form_class"]').val(),fields:t,"custom[css]":a.find('[name="custom_css"]').val(),"custom[js]":a.find('[name="custom_js"]').val(),"form[linkout_url]":a.find('[name="redirect_link"]').val()},url:$("#baseUrl").html()+"/campaign_form_builder",success:function(e){a.find("#stack_code").val(e.stack),B.getDoc().setValue(e.stack),a.find("#form_id").val(e.form_id),a.find("#custom_js").val(e.js),S.getDoc().setValue(e.js),i.html("Save"),i.removeAttr("disabled"),alert("Campaign Form Builder Modification Saved!")}}))))}),$("#stack_form_lock").change(function(){$(this).prop("checked")?($(this).val(1),confirm_stat="DISABLED",stack_lock=1):($(this).val(0),confirm_stat="ENABLED",stack_lock=0),$("#editCampaignStackContent").is(":visible")&&$.ajax({type:"POST",data:{id:$("#editCmpFormModal").find("#this_id").val(),lock:stack_lock},url:$("#baseUrl").html()+"/update_campaign_stack_lock",success:function(e){alert("This campaign is now "+confirm_stat+" from being updated through the content form builder"),console.log(e)}})}),$(".selectAcceptedValues").change(function(){$('[name="accepted[]"').prop("checked",$(this).prop("checked"))}),$("#fieldValueTable").on("change",'[name="accepted[]"]',function(){var e=!1;$("#fieldValueTable").find('[name="accepted[]"]:checked').length==$("#fieldValueTable").find('[name="accepted[]"]').length&&(e=!0),$(".selectAcceptedValues").prop("checked",e)}),$(".clearDefaultValRadio").click(function(){$('[name="default_value"').prop("checked",!1)}),$(document).on("click","#uploadFileValuesBtn",function(){var e=$("#upload_file_value").val(),a=$('[for="upload_file_value"]');if(a.removeClass("error_label"),""!=e){var t=$("#upload_file_value").prop("files")[0],l=new FormData;l.append("file",t),$.ajax({url:$("#baseUrl").html()+"/campaign_upload_field_options",dataType:"text",cache:!1,contentType:!1,processData:!1,data:l,type:"post",success:function(e){options=$.parseJSON(e),displays=options.displays,$.each(options.values,function(e,a){i(a,displays[e],!1,!1)}),$("#uploadValueCollapse").collapse("hide")}})}else a.addClass("error_label")}),$("#uploadValueCollapse").on("hide.bs.collapse",function(){$("#upload_file_value").val(""),$('[for="upload_file_value"]').removeClass("error_label")}),$(document).on("change",'[name="value_select"]',function(e){$('[name="value_input"]').val("")}),$(document).on("change",'[name="value_input"]',function(e){$('[name="value_select"]').val("")});var D=($("#searchCmpAffMgmt").select2({dropdownParent:$("#affCampMgmtModal"),theme:"bootstrap",language:{inputTooShort:function(e){return"Please enter the id or name of the affiliate. (Enter 1 or more characters)"}},ajax:{url:$("#baseUrl").html()+"/search/select/activeAffiliates",dataType:"json",type:"POST",data:function(e){var a={term:e.term};return a},processResults:function(e){return{results:$.map(e.items,function(e){return{text:e.name,id:e.id}})}}}}),$("#cmpAffMgmt-table").on("page.dt",function(){$("#allCAMcampaigns-chkbx").prop("checked",!1).trigger("change"),$("#allCAMTblcampaigns-chkbx").prop("checked",!1).trigger("change")}).DataTable({processing:!0,serverSide:!0,columns:[{orderable:!1},null,null,null,null,null],order:[[1,"asc"]],ajax:{url:$("#baseUrl").html()+"/campaigns/datatable/affiliate_managament",type:"post",data:function(e){e.operation=$("#cam_op_chkbx").val(),e.affiliate=$("#searchCmpAffMgmt").val()},dataSrc:function(e){return e.data}},createdRow:function(e,a,t){"Default"!=a[5]&&""!=a[5]&&$(e).addClass("cam_active_row")}}));$("#cam_op_chkbx").bootstrapToggle("off"),$("#affCampMgmtModal").on("change","#allCAMcampaigns-chkbx",function(e){$(this).prop("checked")?($('[name="cam_campaign[]"]').prop("checked",!1).attr("disabled",!0),$("#allCAMTblcampaigns-chkbx").prop("checked",!1).attr("disabled",!0)):($('[name="cam_campaign[]"]').prop("checked",!1).removeAttr("disabled"),$("#allCAMTblcampaigns-chkbx").prop("checked",!1).removeAttr("disabled")),$(".cam_cmp_type").prop("checked",!1),l()}),$("#affCampMgmtModal").on("change","#allCAMTblcampaigns-chkbx",function(e){$('[name="cam_campaign[]"]').prop("checked",$(this).prop("checked")),$(".cam_cmp_type").prop("checked",$(this).prop("checked")),$(this).prop("checked")?$("#allCAMcampaigns-chkbx").prop("checked",!1).attr("disabled",!0):$("#allCAMcampaigns-chkbx").prop("checked",!1).removeAttr("disabled"),l()}),$("#cmpAffMgmt-table").on("change",'[name="cam_campaign[]"]',function(){$('[name="cam_campaign_type['+$(this).val()+']"]').prop("checked",$(this).prop("checked"));var e=!1;$("#cmpAffMgmt-table").find('[name="cam_campaign[]"]:checked').length==$("#cmpAffMgmt-table").find('[name="cam_campaign[]"]').length&&(e=!0),$("#allCAMTblcampaigns-chkbx").prop("checked",e),l()}),$(".camAddAff-div").on("change",'[name="lead_cap_type"]',function(e){var a=$(".camAddAff-div").find('[name="lead_cap_value"]');$(this).val()>0?a.removeAttr("disabled"):a.attr("disabled",!0),a.val(""),l()}),$(".camAddAff-div").on("change",'[name="lead_cap_value"]',function(e){l()}),$(document).on("click","#affiliateCampaignMgmtBtn",function(){$("#affCampMgmtModal").modal("show"),l()}),$("#affCampMgmtModal").on("change","#cam_op_chkbx",function(e){$(this).prop("checked")?($(this).val(1),$(".camAddAff-div").show()):($(this).val(0),$(".camAddAff-div").hide(),$(".camAddAff-div").find('[name="lead_cap_type"]').val(0).trigger("change")),null!=$("#searchCmpAffMgmt").val()&&D.ajax.reload(),l()}),$("#affCampMgmtModal").on("hidden.bs.modal",function(e){$("#searchCmpAffMgmt").val(null).trigger("change"),$("#cam_op_chkbx").bootstrapToggle("off"),$(".camAddAff-div").hide(),$(".camAddAff-div").find('[name="lead_cap_type"]').val(0).trigger("change"),D.ajax.reload()}),$("#affCampMgmtModal").on("change","#searchCmpAffMgmt",function(e){D.ajax.reload(),l()});var O=null;$('[href="#affiliate_tab"]').click(function(){if(null==O){var e=$("#addCampAff");e.find("span").removeClass().addClass("fa fa-spin fa-spinner"),e.attr("disabled",!0),$.ajax({type:"POST",url:$("#baseUrl").html()+"/get_available_affiliates_for_campaign",data:{id:$(".this_campaign").val()},success:function(a){O=a,$('select[name="affiliates[]"] option').remove();var t=$('select[name="affiliates[]"]');$.each(O,function(e,a){t.append('<option value="'+e+'">'+a+"</option>")});var i=$('select[name="affiliates[]"] option').length;i<=10?$('select[name="affiliates[]"]').attr("size",i):$('select[name="affiliates[]"]').attr("size",10),e.find("span").removeClass().addClass("glyphicon glyphicon-plus"),e.removeAttr("disabled")}})}});var M=null;$('[href="#payout_tab"]').click(function(){if(null==M){var e=$("#addPytAff");e.find("span").removeClass().addClass("fa fa-spin fa-spinner"),e.attr("disabled",!0),$.ajax({type:"POST",url:$("#baseUrl").html()+"/get_available_affiliates_for_campaign_payout",data:{id:$(".this_campaign").val()},success:function(a){M=a,$('select[name="payout[]"] option').remove();var t=$('select[name="payout[]"]');$.each(M,function(e,a){t.append('<option value="'+e+'">'+a+"</option>")});var i=$('select[name="payout[]"] option').length;i<=10?$('select[name="payout[]"]').attr("size",i):$('select[name="payout[]"]').attr("size",10),e.find("span").removeClass().addClass("glyphicon glyphicon-plus"),e.removeAttr("disabled")}})}}),$("#if_ftp_sent").change(function(){$(this).prop("checked")?($(this).val(1),$(".cmpCfgFtp-fld").attr("required",!0),""==$("#cmpCfg-ftppt-txt input").val()&&$("#cmpCfg-ftppt-txt input").val(21),""==$("#cmpCfg-ftpto-txt input").val()&&$("#cmpCfg-ftpto-txt input").val(30)):($(this).val(0),$(".cmpCfgFtp-fld").removeAttr("required"))}),$("#if_email_sent").change(function(){$(this).prop("checked")?($(this).val(1),$(".cmpCfgSTE-fld").attr("required",!0)):($(this).val(0),$(".cmpCfgSTE-fld").removeAttr("required"))});var W=[],V=[],I=($("#jsonFormFieldsTable tbody").sortable({handle:".sortJsonFieldHandle",items:"tr:not(.sortDisabled)"}),CodeMirror.fromTextArea($("#custom_script")[0],{theme:"default",lineNumbers:!0,matchBrackets:!0,mode:"application/x-httpd-php",indentUnit:4,indentWithTabs:!0}));$(document).on("click",".campaignJsonFormBuilder",function(){var e=$(this).data("id"),a=$(this).data("type"),t=$("#campaign_json_form_builder"),i=$("#baseUrl").html()+"/get_campaign_json_content";t.find("#this_campaign").val(e),$(".this_campaign").val(e),$("#cmpJsonFormBuilderModal #cmpName").html(e+" - "+$("#cmp-"+e+"-name").html()),$("#cmpJsonFormBuilderModal #jsonFormBuilderCampaignType").val(a),5==a||6==a?($(".jsonFormBuilderCoregElement").hide(),$(".jsonFormBuilderCoregElement").find('[name="send_lead_to"]').removeAttr("required"),$(".jsonFormBuilderLinkoutElement").show(),$(".jsonFormBuilderLinkoutElement").find('[name="redirect_link"]').attr("required",!0)):($(".jsonFormBuilderCoregElement").show(),$(".jsonFormBuilderCoregElement").find('[name="send_lead_to"]').attr("required",!0),$(".jsonFormBuilderLinkoutElement").hide(),$(".jsonFormBuilderLinkoutElement").find('[name="redirect_link"]').removeAttr("required")),$.ajax({type:"POST",data:{id:e,type:a},url:i,success:function(e){if(console.log(e),null!=e.json){var i=e.json,l=i.form;$("#jsonFormFieldsTable tbody");5==a?t.find("#redirect_link").val(l.redirect_link):"lead_reactor"==l.url||"lead_filter"==l.url?$("#jsonFormBuilderSendLeadSelect").val(l.url):($("#jsonFormBuilderSendLeadSelect").val("custom").change(),$("#jsonFormBuilderCustomUrlInput").val(l.custom_url)),t.find("#form_id").val(l.id),t.find("#form_class").val(l["class"]),t.find("#redirect_link").val(l.linkout_url),W=[],V=[],$.each(i.fields,function(e,a){var t=a;t.has_accepts="true"==a.has_accepts,a.hasOwnProperty("validation")&&$.each(a.validation,function(e,a){var i=a;"false"==a?i=!1:"true"==a&&(i=!0),t.validation[e]=i}),W.push(t)}),$.each(i.fields,function(e,a){V.push(a.name);o(e)}),t.find("#custom_script").val(e.script),I.getDoc().setValue(e.script)}else W=[],V=[],I.getDoc().setValue("");L.ajax.reload(),$("#cmpJsonFormBuilderModal").modal("show")}})}),$(document).on("click","#addFormFieldJson",function(){$("#jsonFormFieldModal").modal("show")}),$(document).on("click","#addJsonFieldValueBtn",function(){n("","","",!1,!1),$('#jsonFieldValueTable tbody tr:last [name="field_value[]"]').focus()}),$(document).on("change","#jsonFormBuilderFieldTypeSelect",function(){var e=$(this).val();"article"==e?($(".json_input_field_group").hide(),$(".json_article_field_group").show(),$("#json_form_builder_field #name").removeAttr("required")):"dropdown"==e||"radio"==e||"checkbox"==e?($(".json_input_field_group").show(),$(".json_article_field_group").hide(),$("#json_form_builder_field #name").attr("required",!0),$(".json_value_group_two").show(),$(".json_value_group_one").hide()):($(".json_input_field_group").show(),$(".json_article_field_group").hide(),$("#json_form_builder_field #name").attr("required",!0),$(".json_value_group_two").hide(),$(".json_value_group_one").show())}),$(document).on("click",".clearJsonFieldValueTable",function(){$("#jsonFieldValueTable tbody").html("")}),$(document).on("submit","#json_form_builder_field",function(e){e.preventDefault();var a=$(this),t=$("#jsonFormFieldModal #field_id").val(),i=new Object,l=!1;if(i.name=a.find("#name").val(),i.type=$("#jsonFormBuilderFieldTypeSelect").val(),i.id=a.find("#id").val(),i["class"]=a.find("#class").val(),i.label=a.find("#label").val(),"article"==i.type)if(i.value=a.find("#article").val(),prev_val=i.value,prev_val=prev_val.replace(/<a\b[^>]*>(.*?)<\/a>/i,""),prev_val=prev_val.replace(/<\/?[^>]+(>|$)/g,""),prev_val=prev_val.substr(0,150),i.value.length>150&&(prev_val+="..."),field_value="<small><em>"+prev_val+"</em></small>",t>0||""!=t)W[t]=i,$("#jfbf-name-"+t).html(""),$("#jfbf-type-"+t).html(i.type),$("#jfbf-value-"+t).html(field_value);else{var n=W.length;W[n]=i,V[V.length]=i.name,field_content=o(n)}else{if("dropdown"==i.type||"radio"==i.type||"checkbox"==i.type){var r=new Array,d=new Array,s=new Array,c=$('#json_form_builder_field [name="field_value[]"]'),p=$('#json_form_builder_field [name="field_img_value[]"]'),m=!1,u=new Array;$('#json_form_builder_field [name="field_display[]"]').each(function(e,a){r.push($(c[e]).val()),s.push($(p[e]).val()),d.push($(a).val())}),options={values:r,displays:d,images:s},i.options=options,$('#json_form_builder_field [name="accepted[]"]').each(function(e,a){$(this).prop("checked")&&(m=!0,value=$("#jsonFieldValueTable tbody tr:nth("+e+")").find('[name="field_value[]"]').val(),u.push(value))}),i.has_accepts=m,i.accepted_options=u,i.value="",$('#json_form_builder_field [name="default_value"]:checked').length>0&&(this_index=$('#json_form_builder_field [name="default_value"]:checked').val(),i.value=$("#jsonFieldValueTable tbody tr:nth("+this_index+")").find('[name="field_value[]"]').val())}else""!=$('#json_form_builder_field [name="value_select"]').val()?(i.value=$('#json_form_builder_field [name="value_select"]').val(),l=!0):""!=$('#json_form_builder_field [name="value_input"]').val()?i.value=$('#json_form_builder_field [name="value_input"]').val():i.value="";var f={};if($('#json_form_builder_field [name="validation[]"]').each(function(e,a){var t=$(this).val();"equalTo"==t?$(this).prop("checked")&&(f[t]=$('#json_form_builder_field [name="equal_to_value"]').val()):"min"==t?$(this).prop("checked")&&(f[t]=$('#json_form_builder_field [name="min_value"]').val()):"max"==t?$(this).prop("checked")&&(f[t]=$('#json_form_builder_field [name="max_value"]').val()):"range"==t?$(this).prop("checked")&&(f[t]="["+$('#json_form_builder_field [name="range_min_value"]').val()+","+$('#json_form_builder_field [name="range_max_value"]').val()+"]"):"minWordCount"==t?$(this).prop("checked")&&(f[t]=$('#json_form_builder_field [name="min_word_count_value"]').val()):f[t]=$(this).prop("checked")}),i.validation=f,t>0||""!=t){W[t]=i,V[t]=i.name,value_display=i.value,1==l&&(value_display=$('#json_form_builder_field [name="value_select"] option[value="'+i.value+'"]').html()),""!=value_display?("dropdown"==i.type||"checkbox"==i.type||"radio"==i.type?(def_val_indx=i.options.values.indexOf(i.value),def_val=value_display,def_val!=i.options.displays[def_val_indx]&&(def_val+=" - "+i.options.displays[def_val_indx])):def_val=value_display,def_val_prev=def_val.substr(0,74),def_val.length>74&&(def_val_prev+="..."),field_value='<span class="label label-primary">'+def_val_prev+"</span>"):field_value="","dropdown"!=i.type&&"checkbox"!=i.type&&"radio"!=i.type||void 0!=typeof i.options&&(fieldCounter=0,$.each(i.options.values,function(e,a){if(""!=a){if(!(fieldCounter<=3))return field_value+=' <span class="label label-info">...</span>',!1;a!=i.value&&(a==i.options.displays[e]?opt_val=a:opt_val=a+" - "+i.options.displays[e],opt_val_prev=opt_val.substr(0,74),opt_val.length>74&&(opt_val_prev+="..."),field_value+=' <span class="label label-info">'+opt_val_prev+"</span>",fieldCounter++)}}));var v=i.name;""!=i.label&&(v+="<br><small><em>"+i.label.substr(0,74),i.label.length>74&&(v+="..."),v+="</em></small>"),$("#jfbf-name-"+t).html(v),$("#jfbf-type-"+t).html(i.type),$("#jfbf-value-"+t).html(field_value)}else{var n=W.length;W[n]=i,V[V.length]=i.name,field_content=o(n)}}$("#jsonFormFieldModal").modal("hide")}),$("#jsonFormFieldModal").on("hide.bs.modal",function(){$("#jsonFormFieldModal .modal-title").html("Add Field"),$("#jsonFormFieldModal .this_field").val(""),$("#jsonFormBuilderFieldTypeSelect").trigger("change"),$('[name="validation[]"]').prop("checked",!1),$('[name="validation[]"][value="required"]').prop("checked",!0),$("#jsonFieldValueTable tbody").html(""),$('[name="equal_to_value"]').removeAttr("required"),$('[name="range_min_value"]').removeAttr("required"),$('[name="range_max_value"]').removeAttr("required"),$('[name="min_value"]').removeAttr("required"),$('[name="max_value"]').removeAttr("required"),$('[name="min_word_count_value"]').removeAttr("required"),$("#uploadValueCollapse").collapse("hide"),$(".selectAcceptedValues").prop("checked",!1)}),$(document).on("click",".viewJsonFieldModalBtn",function(){var e=$(this).data("id"),a=W[e],t=$("#jsonFormFieldModal");console.log(a),t.find(".modal-title").html("Edit Field"),t.find("#label").val(a.label),t.find("#name").val(a.name),t.find("#id").val(a.id),t.find("#class").val(a["class"]),t.find("#field_id").val(e),t.find("#jsonFormBuilderFieldTypeSelect").val(a.type).trigger("change"),"hidden"==a.type||"text"==a.type||"textbox"==a.type?$('select[name="value_select"] option[value="'+a.value+'"]').length>0?($('select[name="value_select"]').val(a.value),$('input[name="value_input"]').val("")):($('select[name="value_select"]').val(""),$('input[name="value_input"]').val(a.value)):"article"==a.type?t.find("#article").val(a.value):$.each(a.options.values,function(e,t){var i=!1,l=!1,o=a.options.displays;a.value==t&&(i=!0),a.has_accepts&&(console.log("Has Accepts"),$key=a.accepted_options.indexOf(t),$key>=0&&(l=!0),console.log($key));var r="";void 0!==a.options.images&&(images=a.options.images,r=images[e]),""!=t&&n(t,o[e],r,i,l)}),a.standard?required=!0:(required=!1,a.hasOwnProperty("validation")&&a.validation.hasOwnProperty("required")&&(required=a.validation.required)),t.find('[name="validation[]"][value="required"]').prop("checked",required),a.hasOwnProperty("validation")&&("undefined"!=typeof a.validation.alphaNumeric&&$('[name="validation[]"][value="alphaNumeric"]').prop("checked",a.validation.alphaNumeric),"undefined"!=typeof a.validation.alphaSpace&&$('[name="validation[]"][value="alphaSpace"]').prop("checked",a.validation.alphaSpace),"undefined"!=typeof a.validation.date&&$('[name="validation[]"][value="date"]').prop("checked",a.validation.date),"undefined"!=typeof a.validation.digits&&$('[name="validation[]"][value="digits"]').prop("checked",a.validation.digits),"undefined"!=typeof a.validation.email&&$('[name="validation[]"][value="email"]').prop("checked",a.validation.email),"undefined"!=typeof a.validation.equalTo&&($('[name="validation[]"][value="equalTo"]').prop("checked",!0).trigger("change"),$('input[name="equal_to_value"]').val(a.validation.equalTo)),"undefined"!=typeof a.validation.max&&($('[name="validation[]"][value="max"]').prop("checked",!0).trigger("change"),$('input[name="max_value"]').val(a.validation.max)),"undefined"!=typeof a.validation.min&&($('[name="validation[]"][value="min"]').prop("checked",!0).trigger("change"),$('input[name="min_value"]').val(a.validation.min)),"undefined"!=typeof a.validation.number&&$('[name="validation[]"][value="number"]').prop("checked",a.validation.number),"undefined"!=typeof a.validation.phoneUS&&$('[name="validation[]"][value="phoneUS"]').prop("checked",a.validation.phoneUS),"undefined"!=typeof a.validation.range&&($('[name="validation[]"][value="range"]').prop("checked",!0).trigger("change"),range=$.parseJSON(a.validation.range),$('input[name="range_min_value"]').val(range[0]),$('input[name="range_max_value"]').val(range[1])),"undefined"!=typeof a.validation.url&&$('[name="validation[]"][value="url"]').prop("checked",a.validation.url),"undefined"!=typeof a.validation.zip&&$('[name="validation[]"][value="zip"]').prop("checked",a.validation.zip),"undefined"!=typeof a.validation.zip&&$('[name="validation[]"][value="zip"]').prop("checked",a.validation.zip),"undefined"!=typeof a.validation.minWordCount&&($('[name="validation[]"][value="minWordCount"]').prop("checked",!0).trigger("change"),$('input[name="min_word_count_value"]').val(a.validation.minWordCount))),t.modal("show")}),$(document).on("change","#jsonFormBuilderSendLeadSelect",function(){var e=$(this).val(),a=$("#jsonFormBuilderCustomUrlInput"),t=$("#campaign_json_form_builder");"custom"==e?a.show():(a.hide(),""!=e&&($.each(j,function(e,a){if(V.indexOf(e)<0){var i=$("#jsonFormFieldsTable tbody tr").length,l=a;"eiq_campaign_id"==e&&(l=t.find("#this_campaign").val()),field={"class":"",id:"",label:"",name:e,standard:!0,type:"hidden",value:l},W[W.length]=field,V[V.length]=e,field_content=o(i)}}),"lead_filter"==e&&$.each(standard_lf_fields,function(e,a){if(V.indexOf(e)<0){var i=$("#jsonFormFieldsTable tbody tr").length,l=a;"program_id"==e?l=t.find("#this_campaign").val():"program_name"==e&&(l=$("#cmp-"+t.find("#this_campaign").val()+"-name").html()),field={"class":"",id:"",label:"",name:e,standard:!1,type:"hidden",value:l},W[W.length]=field,V[V.length]=e,field_content=o(i)}})))}),$(document).on("click",".removeJsonFieldBtn",function(){if(confirmation=confirm("Are you sure you want to delete this field?"),confirmation){var e=$(this).data("id");delete W[e],delete V[e],$(this).parents("tr").remove()}}),$(document).on("shown.bs.tab",'a[data-toggle="tab"][href="#json_customs_tab"]',function(){this.refresh()}.bind(I)),$(document).on("submit","#campaign_json_form_builder",function(e){e.preventDefault();var a=$("#campaign_json_form_builder"),t=[],i=$("#jsonConfigAutomationSubmit");return $(".editCampaignCreative .glyphicon-remove").length>0?(alert("Campaign Form Builder NOT SAVED YET. Save unfinished campaign creatives first."),void $('[href="#creatives_tab"]').trigger("click")):(confirmation=confirm("Are you sure you want to update this campaign content?"),void(confirmation&&($("#jsonFormFieldsTable tbody tr").each(function(e,a){t.push(W[$(this).data("id")])}),i.attr("disabled","true"),i.html('<i class="fa fa-spin fa-spinner"></i>'),$.ajax({type:"POST",data:{id:a.find(".this_campaign").val(),type:$("#jsonFormBuilderCampaignType").val(),"form[url]":$("#jsonFormBuilderSendLeadSelect").val(),"form[custom_url]":a.find('[name="custom_url"]').val(),"form[id]":a.find('[name="form_id"]').val(),"form[class]":a.find('[name="form_class"]').val(),fields:t,script:a.find('[name="custom_script"]').val(),"form[linkout_url]":a.find('[name="redirect_link"]').val()
},url:$("#baseUrl").html()+"/campaign_json_form_builder",success:function(e){console.log(e),i.html("Save"),i.removeAttr("disabled"),alert("Campaign Form Builder Modification Saved!")}}))))}),$("#cmpJsonFormBuilderModal").on("hide.bs.modal",function(e){return $(".editCampaignCreative .glyphicon-remove").length>0?(alert("Save unfinished campaign creatives before closing the form builder."),$('#cmpFormBuilderModal [href="#creatives_tab"]').trigger("click"),e.preventDefault(),e.stopImmediatePropagation(),!1):($("#cmpJsonFormBuilderModal #cmpName").html(""),$(".form_builder_btn").removeAttr("disabled"),$("#jsonFormBuilderSendLeadSelect").val("").trigger("change"),$("#campaign_json_form_builder").find(".this_field").val(""),$("#jsonFormFieldsTable tbody").html(""),$('#cmpJsonFormBuilderModal [href="#json_form_tab"]').trigger("click"),I.getDoc().setValue(""),void setTimeout(function(){I.refresh()},100))});var U=!0,E=!0,L=$("#json-campaign-stack-creative-table").DataTable({responsive:!0,autoWidth:!1,processing:!0,serverSide:!0,order:[[0,"desc"]],columns:[null,{orderable:!1},{orderable:!1},{orderable:!1}],columnDefs:[{width:"10%",targets:0},{width:"55%",targets:1},{width:"30%",targets:2},{width:"5%",targets:3}],bFilter:!1,bLengthChange:!1,bInfo:!1,bPaginate:!1,ajax:{url:$("#baseUrl").html()+"/get_campaign_json_creative",type:"post",data:function(e){e.campaign_id=$("#campaign_json_form_builder").find(".this_campaign").val()},error:function(e){console.log(e)},dataSrc:function(e){return U=e.canEdit,E=e.canDelete,e.canAdd?$("#addCampJsonCreative").show():$("#addCampJsonCreative").hide(),e.data}},sDom:'lf<"json-campaign-stack-creative-table-add-toolbar">rtip',fnDrawCallback:function(e){C=$(".this_campaign").val(),$(".stackCreativeDesc").ckeditor({toolbarGroups:[{name:"clipboard",groups:["clipboard","undo"]},{name:"editing",groups:["find","selection","spellchecker","editing"]},{name:"forms",groups:["forms"]},{name:"basicstyles",groups:["basicstyles","cleanup"]},{name:"paragraph",groups:["list","indent","blocks","align","bidi","paragraph"]},{name:"links",groups:["links"]},{name:"insert",groups:["insert"]},{name:"styles",groups:["styles"]},{name:"colors",groups:["colors"]},{name:"document",groups:["mode","document","doctools"]},{name:"tools",groups:["tools"]},{name:"others",groups:["others"]},{name:"about",groups:["about"]}],removeButtons:"Save,NewPage,Preview,Print,Templates,Cut,Copy,Paste,PasteText,PasteFromWord,Redo,Undo,Find,Replace,SelectAll,Scayt,Form,Checkbox,Radio,TextField,Textarea,Select,Button,ImageButton,HiddenField,RemoveFormat,Language,BidiRtl,BidiLtr,Link,Unlink,Anchor,Image,Flash,Table,HorizontalRule,Smiley,SpecialChar,PageBreak,Iframe,ShowBlocks,About"}),$(".spinner").spinner({step:.01,numberFormat:"n",min:0,max:1,change:function(e,a){$("#"+e.currentTarget.id).parent("span.ui-spinner").removeClass("error_element"),$(this).spinner("isValid")||$("#"+e.currentTarget.id).parent("span.ui-spinner").addClass("error_element")}}),$(".spinner").spinner("disable"),0==U&&$(".editCampaignCreative").hide(),0==E&&$(".deleteCampaignCreative").hide()}});$("div.json-campaign-stack-creative-table-add-toolbar").html('<button id="addCampJsonCreative" class="btn btn-default pull-right" type="button"><span class="glyphicon glyphicon-plus"></span></button>'),$(document).on("click","#addCampJsonCreative",function(){var e=$("#campaign_json_form_builder").find(".this_campaign").val();$.ajax({type:"POST",url:$("#baseUrl").val()+"/add_campaign_creative",data:{id:e},success:function(e){L.order([]),L.ajax.reload()}})}),$(document).on("change",'[name="field_img_value[]"]',function(){var e=$(this),a=!1,t=$(this).closest(".row"),i=t.find("img");e.removeClass("error_field error"),$(i).on("load",function(){console.log("image loaded correctly")}).on("error",function(){""!=e.val()&&(console.log(e.val()),e.addClass("error_field error").val(""),console.log("error loading image"),a=!0)}).attr("src",$(this).val())}),$(document).on("click","#jsonAddRangeValuesBtn",function(){var e=($("#jsonFieldValueTable tbody"),$("#json_min_range_value").val()),a=$("#json_max_range_value").val();if(e>a)for(var t=e;t>=a;t--)n(t,t,"",!1,!1);else for(var t=e;t<=a;t++)n(t,t,"",!1,!1);$("#jsonRangeValueCollapse").collapse("hide")}),$(document).on("click","#jsonUploadFileValuesBtn",function(){var e=$("#json_upload_file_value").val(),a=$('[for="json_upload_file_value"]');if(a.removeClass("error_label"),""!=e){var t=$("#json_upload_file_value").prop("files")[0],i=new FormData;i.append("file",t),$.ajax({url:$("#baseUrl").html()+"/campaign_upload_field_options",dataType:"text",cache:!1,contentType:!1,processData:!1,data:i,type:"post",success:function(e){options=$.parseJSON(e),displays=options.displays,$.each(options.values,function(e,a){n(a,displays[e],"",!1,!1)}),$("#jsonUploadValueCollapse").collapse("hide")}})}else a.addClass("error_label")}),$(document).on("click",".prvJsonCmpCnt",function(e){e.preventDefault();var a=$("#this_campaign").val(),t=$(this).attr("href")+a+"&type="+$("#jsonFormBuilderCampaignType").val(),i=window.open(t,"_blank");i.focus()}),$(document).on("click","#loa-btn",function(){var e=$(".formBuilderLinkoutElement #redirect_link").val();r(e),$("#loa-modal #parse_linkout_url").val(e),$("#loa-modal").modal("show")}),$(document).on("click","#loa-split",function(){r($("#loa-modal #parse_linkout_url").val())}),$(document).on("click","#loa-addRow",function(){d("","")}),$(document).on("click","#loa-deleteMe",function(){$(this).closest("tr").remove()}),$(document).on("click","#loa-submit",function(){var e=$("#loa-modal #linkout_url").val().trim()+"?";$('[name="loa_key[]"]').each(function(a,t){console.log($(this).val()+" = "+$('[name="loa_value[]"]').eq(a).val()),key=$(this).val(),value=$('[name="loa_value[]"]').eq(a).val(),e+=key+"="+value+"&"}),e=e.substring(0,e.length-1),console.log(e),$(".formBuilderLinkoutElement #redirect_link").val(e),$("#loa-modal").modal("hide")}),$("#loa-modal").on("hide.bs.modal",function(e){$(".loa-rows").remove(),$("#loa-modal #linkout_url").val(""),$("#loa-modal #parse_linkout_url").val("")})});
//# sourceMappingURL=campaigns.min.js.map
