{"version":3,"sources":["affiliates.js"],"names":["getAvailableUsers","id","callback","the_url","$","val","ajax","type","data","url","success","document","ready","select2","theme","dropdownParent","change","inputURL","this","hasHTTP","indexOf","hasHTTPs","dataAffiliatesURL","html","DataTable","processing","serverSide","columns","orderable","order","columnDefs","width","targets","error","lengthMenu","click","this_modal","hide","find","attr","show","trigger","remove","append","each","key","value","modal","on","this_aff","currentCity","currentZip","console","log","prop","this_affiliate","confirmation","confirm","table","row","parents","draw","event","form","removeClass","collapse","fadeIn","e","getCitiesByState","fadeOut"],"mappings":"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","file":"affiliates.min.js","sourcesContent":["/***\r\n * Get all unassigned or available users\r\n *\r\n * @param id\r\n * @param callback\r\n */\r\nfunction getAvailableUsers(id,callback)\r\n{\r\n\tvar the_url = $('#baseUrl').val() + '/get_available_users';\r\n\t$.ajax({\r\n\t\ttype: 'POST',\r\n\t\tdata: {\r\n\t\t\t'id':id\r\n\t\t},\r\n\t\turl: the_url,\r\n\t\tsuccess: function(data){\r\n\t\t\tcallback(data);\r\n\t\t}\r\n\t});\r\n}\r\n\r\n$(document).ready(function()\r\n{\r\n\t$('.search-select').select2({\r\n\t\ttheme: 'bootstrap',\r\n\t\tdropdownParent: $(\"#AffFormModal\")\r\n\t});\r\n\r\n\t$('#website').change(function()\r\n\t{\r\n\t\t//get the text value\r\n\t\tvar inputURL = $(this).val();\r\n\r\n\t\t//check if text has http:// or https://\r\n\t\tvar hasHTTP = inputURL.indexOf('http://') > -1;\r\n\t\tvar hasHTTPs = inputURL.indexOf('https://') > -1;\r\n\r\n\t\tif(!hasHTTP && !hasHTTPs)\r\n\t\t{\r\n\t\t\tinputURL = 'http://'+inputURL;\r\n\t\t}\r\n\r\n\t\t$(this).val(inputURL);\r\n\r\n\t});\r\n\r\n\tvar dataAffiliatesURL = $('#baseUrl').html() + '/affiliates';\r\n\t$('#affiliate-table').DataTable({\r\n\t\t'processing': true,\r\n\t\t'serverSide': true,\r\n\t\t\"columns\": [\r\n\t\t\tnull,\r\n\t\t\tnull,\r\n\t\t\tnull,\r\n\t\t\tnull,\r\n\t\t\t{ \"orderable\": false },\r\n\t\t\tnull,\r\n\t\t\t{ \"orderable\": false }\r\n\t\t],\r\n\t\t\"order\": [[ 0, \"desc\" ]],\r\n\t\tcolumnDefs: [\r\n            { width: '3%', targets: 0 },\r\n            // { width: '10%', targets: 2 },\r\n            { width: '15%', targets: [1,3] },\r\n            { width: '20%', targets: 4 },\r\n            { width: '7%', targets: 5 },\r\n            { width: '10%', targets: 6 },\r\n        ],\r\n\t\t'ajax':{\r\n\t\t\turl:dataAffiliatesURL, // json datasource\r\n\t\t\ttype: 'post',  // method  , by default get\r\n\t\t\terror: function(){  // error handling\r\n\r\n\t\t\t}\r\n\t\t},\r\n\t\tlengthMenu: [[25,50,100,1000,2000,3000],[25,50,100,1000,2000,3000]]\r\n\t});\r\n\r\n\t$('#addAffBtn').click(function()\r\n\t{\r\n\t\tvar this_modal = $('#AffFormModal');\r\n\t\tvar url = $('#baseUrl').html() + '/add_affiliate';\r\n\r\n\t\t$('#tab-with-history').hide();\r\n\r\n\t\tthis_modal.find('.this_form').attr('action',url);\r\n\t\tthis_modal.find('.this_form').data('process','add_affiliate');\r\n\t\tthis_modal.find('.this_form').attr('data-process', 'add_affiliate');\r\n\t\tthis_modal.find('.this_form').data('confirmation','');\r\n\t\tthis_modal.find('.this_form').attr('data-confirmation', '');\r\n\t\tthis_modal.find('.modal-title').html('Add Affiliate');\r\n\t\tthis_modal.find('#this_id').val('');\r\n\r\n\t\t$('#user').attr('required','required');\r\n\t\t$('#userForAffiliate').show();\r\n\t\t$('#website').val('http://');\r\n\t\t$('#state').val('').trigger('change');\r\n\r\n\t\tgetAvailableUsers(null,function(data) {\r\n\t\t\t$('#user option').remove();\r\n\t\t\t$('#user').append('<option></option>');\r\n\t\t\t$.each(data,function(key, value)\r\n\t\t\t{\r\n\t\t\t    $('#user').append('<option value=\"' + key + '\">' + value + '</option>');\r\n\t\t\t});\r\n\t\t})\r\n\r\n\t\tthis_modal.modal('show');\r\n\t});\r\n\r\n\t/***\r\n\t * onclick listener for editing affiliate\r\n\t */\r\n\t$(document).on('click','.editAffiliate',function()\r\n\t{\r\n\t\tvar this_modal = $('#AffFormModal');\r\n\t\tvar id = $(this).data('id');\r\n\t\tvar url = $('#baseUrl').html() + '/edit_affiliate';\r\n\r\n\t\t$('#tab-with-history').show();\r\n\r\n\t\tthis_modal.find('.this_form').attr('action',url);\r\n\t\tthis_modal.find('.this_form').data('process','edit_affiliate');\r\n\t\tthis_modal.find('.this_form').attr('data-process', 'edit_affiliate');\r\n\t\tthis_modal.find('.this_form').data('confirmation','Are you sure you want to edit this attribute?');\r\n\t\tthis_modal.find('.this_form').attr('data-confirmation', 'Are you sure you want to edit this attribute?');\r\n\t\tthis_modal.find('.modal-title').html('Edit Affiliate');\r\n\t\tthis_modal.find('#this_id').val(id);\t\t\r\n\t\tthis_modal.find('.table-history #reference_id').val(id);\r\n\r\n\t\tvar this_aff = '#aff-' + id + '-';\r\n\t\t$('#company').val( $(this_aff+'comp').html());\r\n\t\t$('#type').val( $(this_aff+'type').data('type'));\r\n\t\t$('#website').val( $(this_aff+'web').html());\r\n\t\t$('#phone').val( $(this_aff+'phn').html());\r\n\t\t$('#address').val( $(this_aff+'add').html());\r\n\t\t$('.state_zip_wrapper').show();\r\n\r\n        var currentCity = $(this_aff+'cty').html();\r\n        var currentZip = $(this_aff+'zip').html();\r\n\r\n        //load the current city as data so that when trigger is executed append and select the current city after filling up of city\r\n        $('#city').data('current_city',currentCity);\r\n        $('#state').val($(this_aff+'ste').html()).trigger('change');\r\n        $('#zip').val(currentZip);\r\n\r\n        //clear the city\r\n        //$('#city option').remove();\r\n        console.log(currentCity);\r\n        console.log(currentZip);\r\n\r\n        /*\r\n\t\tgetCitiesByState(\r\n\r\n\t\t\t$('#state :selected').html(), function(data) {\r\n\r\n\t\t\t\t$('#city').attr('required','true');\r\n\t\t\t\t$('#zip').attr('required','true');\r\n\r\n\t\t\t\t//$('#city').append('<option value=></option>');\r\n                //append the current city immediately\r\n                //$('#city').append('<option value=\"'+currentCity+'\" selected=\"selected\">'+currentCity+'</option>');\r\n\r\n\t\t\t\t$.each(data,function(key, value)\r\n\t\t\t\t{\r\n\t\t\t\t\t$('#city').append('<option value=\"' + value + '\">' + value + '</option>');\r\n\t\t\t\t});\r\n\r\n\t\t\t\t$('.state_zip_wrapper').show();\r\n\t\t\t\t$('#address').attr('rows',2);\r\n\r\n                //$('#city').val(currentCity).trigger('change');\r\n\t\t\t\t//$('#zip').val(currentZip).trigger('change');\r\n\t\t\t}\r\n\t\t);\r\n        */\r\n\r\n\t\t$('#description').val($(this_aff+'desc').val());\r\n\t\t$('input[name=\"status\"][value=\"'+$(this_aff+'stat').data('status')+'\"]').prop('checked', true);\r\n\t\tthis_modal.modal('show');\r\n\r\n\t});\r\n\r\n\t/***\r\n\t * onclick listener for deleting affiliate\r\n\t */\r\n\t$(document).on('click','.deleteAffiliate',function()\r\n\t{\r\n\t\tvar this_affiliate = $(this);\r\n\t\tvar id = $(this).data('id');\r\n\t\tvar the_url = $('#baseUrl').val() + '/delete_affiliate';\r\n\t\tvar confirmation = true;\r\n\r\n\t\tconfirmation = confirm('Are you sure you want to delete '+ $('#aff-'+id+'-comp').html() + '?');\r\n\r\n\t\tif(confirmation === true)\r\n\t\t{\r\n\t\t\t$.ajax({\r\n\t\t\t\ttype: 'POST',\r\n\t\t\t\tdata: {\r\n\t\t\t\t\t'id':id\r\n\t\t\t\t},\r\n\t\t\t\turl: the_url,\r\n\t\t\t\tsuccess: function(){\r\n\t\t\t\t\t//$('#aff-'+id+'-comp').parent().remove();\r\n\t\t\t\t\tvar table = $('#affiliate-table').DataTable();\r\n\t\t\t\t\ttable.row(this_affiliate.parents('tr')).remove().draw();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n\r\n\t$('#AffFormModal').on('hide.bs.modal', function (event)\r\n\t{\r\n\t    var form = $(this).find('.this_form');\r\n\r\n        form.find('.this_field').each(function()\r\n\t    {\r\n            if($(this).attr('name') == 'status')\r\n            {\r\n\t  \t\t    $('input[name=\"status\"][value=\"1\"]').prop('checked', true);\r\n\t  \t    }\r\n            else\r\n            {\r\n\t  \t\t    $(this).val('');\r\n\t  \t    }\r\n\t    });\r\n\r\n\t    form.find('.error').each(function()\r\n        {\r\n            $(this).removeClass('error');\r\n\t\t\t$(this).removeClass('error_field');\r\n\t\t\t$(this).removeClass('error_label');\r\n\t\t});\r\n\r\n\t    $('.state_zip_wrapper').hide();\r\n\t    $('.this_error_wrapper').hide();\r\n\t});\r\n\r\n\t$('#close-AddAffCol').click(function()\r\n\t{\r\n\t\t$('#AffFormCol').collapse('hide');\r\n\t\t$('.this_field').val('');\r\n\t\t$('#addAffColBtn').fadeIn( \"slow\");\r\n\t});\r\n\r\n    /***\r\n     * select listener for editing affiliate\r\n     */\r\n    $(document).on('change','.state_select',function(e)\r\n    {\r\n        //$('#city').val('').trigger('change');\r\n        //$('#zip').val('').trigger('change');\r\n\r\n        if($(this).val() != '')\r\n        {\r\n            //placeholder while ajax is processing cities to be added\r\n            $('#city option').remove();\r\n            $('#city').append('<option value=>Processing cities for the state...</option>');\r\n\r\n            getCitiesByState($('#state option:selected').html(), function(data)\r\n            {\r\n                $('#city option').remove();\r\n\r\n                $('#city').attr('required','true');\r\n                $('#zip').attr('required','true');\r\n\r\n                $('#city').append('<option value=></option>');\r\n\r\n                $.each(data,function(key, value)\r\n                {\r\n                    $('#city').append('<option value=\"' + value + '\">' + value + '</option>');\r\n                });\r\n\r\n                $('.state_zip_wrapper').fadeIn('slow');\r\n                $('#address').attr('rows',2);\r\n\r\n                //set if there is pre defined city\r\n                var currentCity = $('#city').data('current_city');\r\n                $('#city').val(currentCity).trigger('change');\r\n            });\r\n        }\r\n        else\r\n        {\r\n            $('#city').attr('required','false');\r\n            $('#zip').attr('required','false');\r\n            $('.state_zip_wrapper').fadeOut('fast');\r\n            $('#address').attr('rows',1);\r\n        }\r\n    });\r\n\r\n});\r\n"]}