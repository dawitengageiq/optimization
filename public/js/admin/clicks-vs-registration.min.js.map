{"version":3,"sources":["clicks-vs-registration.js"],"names":["$","document","ready","clicksRegsReport","the_url","baseURL","html","table","body","footer","groupBy","val","find","DataTable","destroy","empty","ajax","type","url","data","date_from","date_to","affiliate_id","group_by","date_range","s1","s2","s3","s4","s5","sib_s1","prop","sib_s2","sib_s3","sib_s4","success","console","log","records","length","total_regs","total_clicks","affiliates","downloadReportButton","arrayURLStr","i","downloadURL","attr","removeClass","addClass","each","x","row","affiliate","regs","Number","registration_count","clicks","percentage","toFixed","createdAt","created_at","revenue_tracker_id","append","total_percentage","order","language","searchPlaceholder","lengthMenu","draw","datepicker","format","clearBtn","autoclose","todayHighlight","select2","placeholder","minimumInputLength","maximumSelectionLength","theme","inputTooShort","searching","dataType","params","queryParameters","term","processResults","results","map","items","item","text","name","id","click","trigger","dataTable","on","e","preventDefault","change","this","affiliateID","removeAttr"],"mappings":"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","file":"clicks-vs-registration.min.js","sourcesContent":["$(document).ready(function(){\r\n\r\n    var baseURL = $('#baseUrl');\r\n\r\n    $('.input-group.date').datepicker({\r\n        format: \"yyyy-mm-dd\",\r\n        clearBtn: true,\r\n        autoclose: true,\r\n        todayHighlight: true\r\n    });\r\n\r\n    $('#affiliate_id').select2({\r\n        placeholder: 'Select the id or name of the affiliate.',\r\n        minimumInputLength: 1,\r\n        maximumSelectionLength: 0,\r\n        theme: 'bootstrap',\r\n        language: {\r\n            inputTooShort: function() {\r\n                return \"Please enter the id or name of the affiliate. (Enter 1 or more characters)\";\r\n            },\r\n            searching: function() {\r\n                return \"Searching...\";\r\n            }\r\n        },\r\n        ajax: {\r\n            url: baseURL.html()+'/search/select/activeAffiliatesIDName',\r\n            dataType: \"json\",\r\n            type: \"POST\",\r\n            data: function (params) {\r\n\r\n                var queryParameters = {\r\n                    term: params.term\r\n                };\r\n\r\n                return queryParameters;\r\n            },\r\n            processResults: function (data) {\r\n                console.log(data);\r\n                return {\r\n                    results: $.map(data.items, function (item) {\r\n                        return {\r\n                            text: item.name,\r\n                            id: item.id\r\n                        }\r\n                    })\r\n                };\r\n            }\r\n        }\r\n    });\r\n\r\n    $('#remove_affiliate_id_selections').click(function(){\r\n        // Clear the ID selections\r\n        $('#affiliate_id').val(null).trigger('change');\r\n    });\r\n\r\n    // var the_url = baseURL.html() + '/admin/getClicksVsRegsStats';\r\n    // var clicksVsRegistrationTable = $('#clicks-vs-registration-table').DataTable({\r\n    //     'processing': true,\r\n    //     'serverSide': true,\r\n    //     language: {\r\n    //         searchPlaceholder: \"Affiliate / Revenue Tracker\"\r\n    //     },\r\n    //     \"order\": [],\r\n    //     'ajax':{\r\n    //         url: the_url, // json datasource\r\n    //         type: 'post',\r\n    //         // 'data': $('#search-leads').serialize(),\r\n    //         'data': function(d)\r\n    //         {\r\n    //             d.date_from = $('#date_from').val();\r\n    //             d.date_to = $('#date_to').val();\r\n    //             d.affiliate_id = $('#affiliate_id').val();\r\n    //             d.group_by = $('#group_by').val();\r\n    //             d.date_range = $('#date_range').val();\r\n    //             d.s1 = $('#s1').val();\r\n    //             d.s2 = $('#s2').val();\r\n    //             d.s3 = $('#s3').val();\r\n    //             d.s4 = $('#s4').val();\r\n    //             d.s5 = $('#s5').val();\r\n    //         },\r\n    //         \"dataSrc\": function (json) {\r\n    //             var downloadReportButton = $('#download-clicks-vs-registration-report');\r\n\r\n    //             if(json.data.length > 0)\r\n    //             {\r\n    //                 downloadReportButton.removeClass('disabled');\r\n    //                 /*\r\n    //                 var affiliatesArray = encodeURI(JSON.stringify(json.affiliate_id));\r\n    //                 console.log(json.affiliate_id);\r\n    //                 console.log(affiliatesArray);\r\n    //                 */\r\n    //                 var arrayURLStr = '';\r\n    //                 for (var i=0; i<json.affiliate_id.length; i++){\r\n    //                     arrayURLStr += '&affiliate_id['+i+']='+json.affiliate_id[i];\r\n    //                 }\r\n    //                 // console.log(json.order_column + ' ' + json.order_dir);\r\n\r\n    //                 var orderColumnStr = '';\r\n    //                 if(json.order_column !== undefined)\r\n    //                 {\r\n    //                     orderColumnStr = '&order_column='+json.order_column;\r\n    //                 }\r\n\r\n    //                 var s1 = $('#s1').val(),\r\n    //                     s2 = $('#s2').val(),\r\n    //                     s3 = $('#s3').val(),\r\n    //                     s4 = $('#s4').val(),\r\n    //                     s5 = $('#s5').val();\r\n\r\n    //                 // var downloadURL = baseURL.html()+'/admin/downLoadClicksVsRegistrationReport?affiliate_id='+affiliatesArray+'&date_from='+json.date_from+'&date_to='+json.date_to+'&group_by='+json.group_by;\r\n    //                 var downloadURL = baseURL.html()+'/admin/downLoadClicksVsRegistrationReport?'+arrayURLStr+'&date_from='+json.date_from+'&date_to='+json.date_to+'&group_by='+json.group_by+orderColumnStr+'&order_dir='+json.order_dir+'&is_download=true&date_range='+json.date_range;\r\n    //                     downloadURL += '&s1=' + s1 + '&s2=' + s2 + '&s3=' + s3 + '&s4=' + s4 + '&s5=' + s5;\r\n    //                 console.log(downloadURL);\r\n    //                 downloadReportButton.attr('href', downloadURL);\r\n    //             }\r\n    //             else\r\n    //             {\r\n    //                 downloadReportButton.addClass('disabled');\r\n    //             }\r\n\r\n    //             $(clicksVsRegistrationTable.column(9).footer()).html(json.totalRegistrationCount);\r\n    //             $(clicksVsRegistrationTable.column(10).footer()).html(json.totalClicks);\r\n    //             $(clicksVsRegistrationTable.column(11).footer()).html(json.totalPercentage);\r\n\r\n    //             return json.data;\r\n    //         },\r\n    //         error: function(data){  // error handling\r\n    //             console.log(data);\r\n    //         }\r\n    //     },\r\n    //     'columns':[\r\n    //         {'data':'date'},\r\n    //         {'data':'affiliate_name'},\r\n    //         {'data':'affiliate_id'},\r\n    //         {'data':'revenue_tracker_id'},\r\n    //         {'data':'s1'},\r\n    //         {'data':'s2'},\r\n    //         {'data':'s3'},\r\n    //         {'data':'s4'},\r\n    //         {'data':'s5'},\r\n    //         {'data':'registration_count'},\r\n    //         {'data':'clicks'},\r\n    //         {'data':'percentage'}\r\n    //     ],\r\n    //     lengthMenu: [[25, 50, 100, -1],[25, 50, 100, 'All']]\r\n    // });\r\n\r\n    function clicksRegsReport() {\r\n        the_url = baseURL.html() + '/admin/getClicksVsRegsStats';\r\n\r\n        var table = $('#clicks-vs-registration-table'),\r\n            body = $('#clicks-vs-registration-table tbody'),\r\n            footer = $('#clicks-vs-registration-table tfoot tr');\r\n\r\n        var downloadReportButton = $('#download-clicks-vs-registration-report');\r\n        var groupBy = $('#group_by').val();\r\n\r\n        footer.find(':nth-child(10)').html('')\r\n        footer.find(':nth-child(11)').html('')\r\n        footer.find(':nth-child(12)').html('')\r\n        table.DataTable().destroy();\r\n        body.empty();\r\n        $.ajax({\r\n            type: 'POST',\r\n            url: the_url,\r\n            data: {\r\n                date_from : $('#date_from').val(),\r\n                date_to : $('#date_to').val(),\r\n                affiliate_id : $('#affiliate_id').val(),\r\n                group_by : groupBy,\r\n                date_range : $('#date_range').val(),\r\n                s1 : $('#s1').val(),\r\n                s2 : $('#s2').val(),\r\n                s3 : $('#s3').val(),\r\n                s4 : $('#s4').val(),\r\n                s5 : $('#s5').val(),\r\n                sib_s1 : $('#sib_s1').prop('checked'),\r\n                sib_s2 : $('#sib_s2').prop('checked'),\r\n                sib_s3 : $('#sib_s3').prop('checked'),\r\n                sib_s4 : $('#sib_s4').prop('checked')\r\n            },\r\n            success: function(data){\r\n                console.log(data);\r\n                console.log(data.records.length)\r\n\r\n                var total_regs = 0, total_clicks = 0;\r\n                var affiliates = data.affiliates;\r\n\r\n                var downloadReportButton = $('#download-clicks-vs-registration-report');\r\n                if(data.records.length > 0)\r\n                {\r\n                    var arrayURLStr = '';\r\n                    for (var i=0; i<data.affiliate_id.length; i++){\r\n                        arrayURLStr += '&affiliate_id['+i+']='+data.affiliate_id[i];\r\n                    }\r\n\r\n                    var s1 = $('#s1').val(),\r\n                        s2 = $('#s2').val(),\r\n                        s3 = $('#s3').val(),\r\n                        s4 = $('#s4').val(),\r\n                        s5 = $('#s5').val();\r\n\r\n                    // var downloadURL = baseURL.html()+'/admin/downLoadClicksVsRegistrationReport?affiliate_id='+affiliatesArray+'&date_from='+json.date_from+'&date_to='+json.date_to+'&group_by='+json.group_by;\r\n                    var downloadURL = baseURL.html()+'/admin/downLoadClicksVsRegistrationReport?'+arrayURLStr+'&date_from='+$('#date_from').val()+'&date_to='+$('#date_to').val()+'&group_by='+groupBy+'&is_download=true&date_range='+$('#date_range').val();\r\n                        downloadURL += '&s1=' + s1 + '&s2=' + s2 + '&s3=' + s3 + '&s4=' + s4 + '&s5=' + s5 + '&sib_s1=' + $('#sib_s1').prop('checked') + '&sib_s2=' + $('#sib_s2').prop('checked') + '&sib_s3=' + $('#sib_s3').prop('checked') + '&sib_s4=' + $('#sib_s4').prop('checked');\r\n                    downloadReportButton.attr('href', downloadURL);\r\n                    downloadReportButton.removeClass('disabled');\r\n                }else downloadReportButton.addClass('disabled');\r\n\r\n                $.each(data.records, function(x, row){\r\n\r\n                    var affiliate = affiliates[row.affiliate_id],\r\n                        regs = Number(row.registration_count),\r\n                        clicks = Number(row.clicks),\r\n                        percentage = (regs > 0 && clicks > 0) ? Number((regs / clicks) * 100.0).toFixed(2) : 0\r\n\r\n                        var createdAt = '', s1 = '', s2 = '', s3 = '', s4 = '', s5 = '';\r\n                        if(groupBy == 'created_at'){\r\n                            createdAt = row.created_at;\r\n                            s1 = $('#sib_s1').prop('checked') ? row.s1 : '';\r\n                            s2 = $('#sib_s2').prop('checked') ? row.s2 : '';\r\n                            s3 = $('#sib_s3').prop('checked') ? row.s3 : '';\r\n                            s4 = $('#sib_s4').prop('checked') ? row.s4 : '';\r\n                            s5 = row.s5;\r\n                        }else if(groupBy == 'custom') {\r\n                            createdAt = row.created_at;\r\n                        }else if(groupBy == 'per_sub_id') {\r\n                            s1 = row.s1;s2 = row.s2;s3 = row.s3;s4 = row.s4;s5 = row.s5;\r\n                        }\r\n\r\n                    var row = '<tr><td>'+createdAt+'</td><td>'+affiliate+'</td><td>'+row.affiliate_id+'</td><td>'+row.revenue_tracker_id+'</td><td>'+s1+'</td><td>'+s2+'</td><td>'+s3+'</td><td>'+s4+'</td><td>'+s5+'</td><td>'+regs+'</td><td>'+clicks+'</td><td>'+percentage+'%</td></tr>';\r\n                    body.append(row);\r\n\r\n                    total_regs += Number(regs);\r\n                    total_clicks += Number(clicks);\r\n                });\r\n\r\n                total_percentage = (total_regs > 0 && total_clicks > 0) ? Number((total_regs / total_clicks) * 100.0).toFixed(2) : 0;\r\n\r\n                footer.find(':nth-child(10)').html(total_regs)\r\n                footer.find(':nth-child(11)').html(total_clicks)\r\n                footer.find(':nth-child(12)').html(total_percentage + '%')\r\n\r\n                table.DataTable({\r\n                    \"order\": [[ 1, \"asc\" ]],\r\n                    language: {\r\n                        searchPlaceholder: \"Affiliate / Revenue Tracker\"\r\n                    },\r\n                    lengthMenu: [[25, 50, 100, -1],[25, 50, 100, 'All']]\r\n                }).draw();\r\n            }\r\n        });\r\n    }\r\n\r\n    $('#clicks-vs-registration-table').dataTable();\r\n    clicksRegsReport()\r\n\r\n    $(document).on('submit', function(e){\r\n\r\n        e.preventDefault();\r\n\r\n        // clicksVsRegistrationTable.order([[ 0, \"asc\" ]]);\r\n        // clicksVsRegistrationTable.ajax.reload();\r\n        clicksRegsReport()\r\n\r\n    });\r\n\r\n    $('#clear').click(function(){\r\n\r\n        $('.date-field').val('');\r\n        $('#affiliate_id').val('').trigger('change');\r\n    });\r\n\r\n    $('#date_range').change(function()\r\n    {\r\n        if($(this).val() != '')\r\n        {\r\n            $('#date_from').val('');\r\n            $('#date_to').val('');\r\n        }\r\n    });\r\n\r\n    $('.date-field').change(function()\r\n    {\r\n        if($(this).val() != '')\r\n        {\r\n            $('#date_range').val('');\r\n        }\r\n    });\r\n\r\n    $('#addAffiliateID').click(function(){\r\n        // Get the selected affiliate and add it on the list.\r\n        var affiliateID = $('#affiliate_id').val();\r\n        console.log(affiliateID);\r\n    });\r\n\r\n    $('#group_by').change(function()\r\n    {\r\n        if($(this).val() != 'created_at') {\r\n            $('.sibs').prop('checked', true).attr('disabled', true);\r\n        }else {\r\n            $('.sibs').removeAttr('disabled');\r\n        }\r\n    });\r\n\r\n});\r\n"]}