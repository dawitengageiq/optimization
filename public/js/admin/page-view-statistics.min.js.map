{"version":3,"sources":["page-view-statistics.js"],"names":["$","document","ready","baseURL","datepicker","format","clearBtn","autoclose","todayHighlight","select2","placeholder","minimumInputLength","maximumSelectionLength","theme","language","inputTooShort","args","ajax","url","html","dataType","type","data","params","queryParameters","term","processResults","console","log","results","map","items","item","text","name","id","pvsAvg","the_url","pageViewStatisticsTable","DataTable","processing","serverSide","searchPlaceholder","order","d","date_from","val","date_to","affiliate_id","group_by","date_range","s1","s2","s3","s4","s5","sib_s1","prop","sib_s2","sib_s3","sib_s4","dataSrc","json","downloadReportButton","length","removeClass","arrayURLStr","i","orderColumnStr","undefined","order_column","downloadURL","order_dir","attr","addClass","column","footer","total_lp","total_rp","total_to1","total_to2","total_mo1","total_mo2","total_mo3","total_mo4","total_lfc1","total_lfc2","total_tbr1","total_pd","total_tbr2","total_iff","total_rex","total_ads","total_cpawall","total_exitpage","thirty_day_average","error","createdRow","row","dataIndex","average","Number","ceiling","percentage","find","columns","lengthMenu","click","trigger","on","e","preventDefault","reload","change","this","removeAttr"],"mappings":"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","file":"page-view-statistics.min.js","sourcesContent":["$(document).ready(function(){\r\n\r\n    var baseURL = $('#baseUrl');\r\n\r\n    $('.input-group.date').datepicker({\r\n        format: \"yyyy-mm-dd\",\r\n        clearBtn: true,\r\n        autoclose: true,\r\n        todayHighlight: true\r\n    });\r\n\r\n    $('#affiliate_id').select2({\r\n        //tags: true,\r\n        placeholder: 'Select the id or name of the affiliate.',\r\n        minimumInputLength: 1,\r\n        maximumSelectionLength: 0,\r\n        theme: 'bootstrap',\r\n        language: {\r\n            inputTooShort: function(args) {\r\n                return \"Please enter the id or name of the affiliate. (Enter 1 or more characters)\";\r\n            }\r\n        },\r\n        ajax: {\r\n            url: baseURL.html()+'/search/select/activeAffiliatesIDName',\r\n            dataType: \"json\",\r\n            type: \"POST\",\r\n            data: function (params) {\r\n\r\n                var queryParameters = {\r\n                    term: params.term\r\n                };\r\n\r\n                return queryParameters;\r\n            },\r\n            processResults: function (data) {\r\n                console.log(data);\r\n                return {\r\n                    results: $.map(data.items, function (item) {\r\n                        return {\r\n                            text: item.name,\r\n                            id: item.id\r\n                        }\r\n                    })\r\n                };\r\n            }\r\n        }\r\n    });\r\n\r\n    var the_url = baseURL.html() + '/admin/getPageViewStats';\r\n    var pvsAvg;\r\n    var pageViewStatisticsTable = $('#page-view-statistics-table').DataTable({\r\n        'processing': true,\r\n        'serverSide': true,\r\n        language: {\r\n            searchPlaceholder: \"Affiliate / Revenue Tracker\"\r\n        },\r\n        \"order\": [],\r\n        'ajax':{\r\n            url:the_url, // json datasource\r\n            type: 'post',\r\n            // 'data': $('#search-leads').serialize(),\r\n            'data': function(d)\r\n            {\r\n                d.date_from = $('#date_from').val();\r\n                d.date_to = $('#date_to').val();\r\n                d.affiliate_id = $('#affiliate_id').val();\r\n                d.group_by = $('#group_by').val();\r\n                d.date_range = $('#date_range').val();\r\n                d.s1 = $('#s1').val();\r\n                d.s2 = $('#s2').val();\r\n                d.s3 = $('#s3').val();\r\n                d.s4 = $('#s4').val();\r\n                d.s5 = $('#s5').val();\r\n                d.sib_s1 = $('#sib_s1').prop('checked');\r\n                d.sib_s2 = $('#sib_s2').prop('checked');\r\n                d.sib_s3 = $('#sib_s3').prop('checked');\r\n                d.sib_s4 = $('#sib_s4').prop('checked');\r\n            },\r\n            \"dataSrc\": function (json) {\r\n\r\n                var downloadReportButton = $('#download-page-view-statistics-report');\r\n\r\n                if(json.data.length > 0)\r\n                {\r\n                    downloadReportButton.removeClass('disabled');\r\n\r\n                    var arrayURLStr = '';\r\n                    for (var i=0; i<json.affiliate_id.length; i++){\r\n                        arrayURLStr += '&affiliate_id['+i+']='+json.affiliate_id[i];\r\n                    }\r\n\r\n                    var orderColumnStr = '';\r\n                    if(json.order_column !== undefined)\r\n                    {\r\n                        orderColumnStr = '&order_column='+json.order_column;\r\n                    }\r\n\r\n                    var s1 = $('#s1').val(),\r\n                        s2 = $('#s2').val(),\r\n                        s3 = $('#s3').val(),\r\n                        s4 = $('#s4').val(),\r\n                        s5 = $('#s5').val();\r\n\r\n                    // var downloadURL = baseURL.html()+'/admin/downLoadPageViewStatisticsReport?affiliate_id='+json.affiliate_id+'&date_from='+json.date_from+'&date_to='+json.date_to+'&group_by='+json.group_by;\r\n                    var downloadURL = baseURL.html()+'/admin/downLoadPageViewStatisticsReport?'+arrayURLStr+'&date_from='+json.date_from+'&date_to='+json.date_to+'&group_by='+json.group_by+orderColumnStr+'&order_dir='+json.order_dir+'&is_download=true&date_range='+json.date_range;\r\n                        downloadURL += '&s1=' + s1 + '&s2=' + s2 + '&s3=' + s3 + '&s4=' + s4 + '&s5=' + s5 + '&sib_s1=' + $('#sib_s1').prop('checked') + '&sib_s2=' + $('#sib_s2').prop('checked') + '&sib_s3=' + $('#sib_s3').prop('checked') + '&sib_s4=' + $('#sib_s4').prop('checked');\r\n                    console.log(downloadURL);\r\n                    downloadReportButton.attr('href', downloadURL);\r\n                }\r\n                else\r\n                {\r\n                    downloadReportButton.addClass('disabled');\r\n                }\r\n\r\n                $(pageViewStatisticsTable.column(9).footer()).html(json.total_lp);\r\n                $(pageViewStatisticsTable.column(10).footer()).html(json.total_rp);\r\n                $(pageViewStatisticsTable.column(11).footer()).html(json.total_to1);\r\n                $(pageViewStatisticsTable.column(12).footer()).html(json.total_to2);\r\n                $(pageViewStatisticsTable.column(13).footer()).html(json.total_mo1);\r\n                $(pageViewStatisticsTable.column(14).footer()).html(json.total_mo2);\r\n                $(pageViewStatisticsTable.column(15).footer()).html(json.total_mo3);\r\n                $(pageViewStatisticsTable.column(16).footer()).html(json.total_mo4);\r\n                $(pageViewStatisticsTable.column(17).footer()).html(json.total_lfc1);\r\n                $(pageViewStatisticsTable.column(18).footer()).html(json.total_lfc2);\r\n                $(pageViewStatisticsTable.column(19).footer()).html(json.total_tbr1);\r\n                $(pageViewStatisticsTable.column(20).footer()).html(json.total_pd);\r\n                $(pageViewStatisticsTable.column(21).footer()).html(json.total_tbr2);\r\n                $(pageViewStatisticsTable.column(22).footer()).html(json.total_iff);\r\n                $(pageViewStatisticsTable.column(23).footer()).html(json.total_rex);\r\n                $(pageViewStatisticsTable.column(24).footer()).html(json.total_ads);\r\n                $(pageViewStatisticsTable.column(25).footer()).html(json.total_cpawall);\r\n                $(pageViewStatisticsTable.column(26).footer()).html(json.total_exitpage);\r\n                $(pageViewStatisticsTable.column(27).footer()).html(json.thirty_day_average);\r\n\r\n\r\n                pvsAvg = json.thirty_day_average;\r\n                return json.data;\r\n            },\r\n            error: function(data){  // error handling\r\n                console.log(data);\r\n            }\r\n        },\r\n        \"createdRow\": function( row, data, dataIndex ) {\r\n\r\n            var average = Number(pvsAvg);\r\n                ceiling = average * .95;\r\n\r\n            if(data.percentage >= ceiling && data.percentage < average) {\r\n                $(row).find('td:last-child').addClass( 'warning' );\r\n            }\r\n            else if(data.percentage < ceiling && data.percentage < average){\r\n                $(row).find('td:last-child').addClass( 'danger' );\r\n            }\r\n\r\n            // console.log('Created Row');\r\n            // console.log(row);\r\n            // console.log(data);\r\n            // console.log(dataIndex);\r\n            // console.log(pvsAvg)\r\n        },\r\n        'columns':[\r\n            {'data':'date'},\r\n            {'data':'affiliate_name'},\r\n            {'data':'affiliate_id'},\r\n            {'data':'revenue_tracker_id'},\r\n            {'data':'s1'},\r\n            {'data':'s2'},\r\n            {'data':'s3'},\r\n            {'data':'s4'},\r\n            {'data':'s5'},\r\n            {'data':'lp'},\r\n            {'data':'rp'},\r\n            {'data':'to1'},\r\n            {'data':'to2'},\r\n            {'data':'mo1'},\r\n            {'data':'mo2'},\r\n            {'data':'mo3'},\r\n            {'data':'mo4'},\r\n            {'data':'lfc1'},\r\n            {'data':'lfc2'},\r\n            {'data':'tbr1'},\r\n            {'data':'pd'},\r\n            {'data':'tbr2'},\r\n            {'data':'iff'},\r\n            {'data':'rex'},\r\n            {'data':'ads'},\r\n            {'data':'cpawall'},\r\n            {'data':'exitpage'},\r\n            {'data':'percentage'}\r\n        ],\r\n        lengthMenu: [[25, 50, 100, -1],[25, 50, 100, 'All']]\r\n    });\r\n\r\n    $('#remove_affiliate_id_selections').click(function(){\r\n        // Clear the ID selections\r\n        $('#affiliate_id').val(null).trigger('change');\r\n    });\r\n\r\n    $(document).on('submit', function(e){\r\n\r\n        e.preventDefault();\r\n\r\n        // pageViewStatisticsTable.order([[ 0, \"asc\" ]]);\r\n        pageViewStatisticsTable.ajax.reload();\r\n\r\n    });\r\n\r\n    $('#clear').click(function(){\r\n\r\n        $('.date-field').val('');\r\n        $('#affiliate_id').val('').trigger('change');\r\n    });\r\n\r\n    $('#date_range').change(function()\r\n    {\r\n        if($(this).val() != '')\r\n        {\r\n            $('#date_from').val('');\r\n            $('#date_to').val('');\r\n        }\r\n    });\r\n\r\n    $('.date-field').change(function()\r\n    {\r\n        if($(this).val() != '')\r\n        {\r\n            $('#date_range').val('');\r\n        }\r\n    });\r\n\r\n    $('#group_by').change(function()\r\n    {\r\n        if($(this).val() != 'created_at') {\r\n            $('.sibs').prop('checked', true).attr('disabled', true);\r\n        }else {\r\n            $('.sibs').removeAttr('disabled');\r\n        }\r\n    });\r\n});\r\n"]}