$(document).ready(function(){function e(){console.log("internal affiliate report"),the_url=n+"/getAffiliateReports";var e=$("#internal-table"),a=$("#internal-table tbody"),t=$("#internal-table tfoot tr");t.find(":nth-child(2)").html(""),t.find(":nth-child(3)").html(""),t.find(":nth-child(4)").html(""),t.find(":nth-child(5)").html(""),t.find(":nth-child(6)").html(""),t.find(":nth-child(7)").html(""),e.DataTable().destroy(),a.empty(),$.ajax({type:"POST",url:the_url,data:{period:$("#snapshot_period").val(),affiliate_type:1,start_date:$("#start_date").val(),end_date:$("#end_date").val()},success:function(l){var r=0,d=0,i=0,n=0,o=0,s=0,h=l.affiliates;$.each(l.records,function(e,t){var l=null!=t.revenue?t.revenue.toFixed(2):0,s=null!=t.leads?t.leads:0,c=null!=t.payout?t.payout.toFixed(3):0,f=(l-c).toFixed(2),p=0==f||0==l?0:(f/l*100).toFixed(2),_=h[t.affiliate_id],u=null!=t.clicks?t.clicks:0,$='<span class="ar_aff_id" data-id="'+t.affiliate_id+'" data-type="1">'+_+"</span>",t="<tr><td>"+$+"</td><td>"+u+"</td><td>$ "+c+"</td><td>"+s+"</td><td> $"+l+"</td><td> $"+f+"</td><td>"+p+"%</td></tr>";a.append(t),r+=Number(u),d+=Number(c),i+=Number(s),n+=Number(l),o+=Number(f)}),s=0==n?"N/A":((n-d)/n*100).toFixed(2)+"%",t.find(":nth-child(2)").html(r),t.find(":nth-child(3)").html("$"+d.toLocaleString()),t.find(":nth-child(4)").html(i),t.find(":nth-child(5)").html("$"+n.toLocaleString()),t.find(":nth-child(6)").html("$"+o.toLocaleString()),t.find(":nth-child(7)").html(s),e.DataTable({language:{searchPlaceholder:"Affiliate"}}).draw()}})}function a(){console.log("host and post affiliate report");var e=n+"/getHandPAffiliateReports",a=$("#handp-table"),t=$("#handp-table tbody"),l=$("#handp-table tfoot tr");l.find(":nth-child(2)").html(""),l.find(":nth-child(3)").html(""),l.find(":nth-child(4)").html(""),l.find(":nth-child(5)").html(""),l.find(":nth-child(6)").html(""),a.DataTable().destroy(),t.empty(),$.ajax({type:"POST",url:e,data:{period:$("#snapshot_period").val(),affiliate_type:1,start_date:$("#start_date").val(),end_date:$("#end_date").val()},success:function(e){var r=0,d=0,i=0,n=0,o=0,s=0,h=e.affiliates;$.each(e.records,function(e,a){var l=null!=a.revenue?a.revenue.toFixed(2):0,s=null!=a.leads?a.leads:0,c=null!=a.payout?a.payout.toFixed(2):0,f=(l-c).toFixed(2),p=0==f||0==l?0:(f/l*100).toFixed(2),_=h[a.affiliate_id],u=null!=a.clicks?a.clicks:0,$='<span class="ar_aff_id" data-id="'+a.affiliate_id+'" data-type="1">'+_+"</span>",a="<tr><td>"+$+"</td><td>"+s+"</td><td>$ "+c+"</td><td> $"+l+"</td><td> $"+f+"</td><td>"+p+"%</td></tr>";t.append(a),r+=Number(u),d+=Number(c),i+=Number(s),n+=Number(l),o+=Number(f)}),s=0==n?"N/A":((n-d)/n*100).toFixed(2)+"%",l.find(":nth-child(2)").html(i),l.find(":nth-child(3)").html("$"+d.toLocaleString()),l.find(":nth-child(4)").html("$"+n.toLocaleString()),l.find(":nth-child(5)").html("$"+o.toLocaleString()),l.find(":nth-child(6)").html(s),a.DataTable({language:{searchPlaceholder:"Affiliate"}}).draw()}})}function t(){var e=w.data("id"),a=w.data("rtid"),t=w.data("webname");console.log("affiliate_id: "+e),console.log("revenue_tracker_id: "+a),console.log("webname: "+t),$("#downloadSubReportBtn").addClass("disabled"),$("#AffRevTitle").html(t),the_url=n+"/getRevTrackerSubIDReports";var l=$("#subIDBreakdownTable"),r=$("#subIDBreakdownTable tbody"),d=$("#subIDBreakdownTable tfoot tr");d.find(":nth-child(6)").html(""),d.find(":nth-child(7)").html(""),d.find(":nth-child(8)").html(""),d.find(":nth-child(9)").html(""),d.find(":nth-child(10)").html(""),d.find(":nth-child(11)").html(""),l.DataTable().destroy(),r.empty(),$.ajax({type:"POST",url:the_url,data:{affiliate_id:e,revenue_tracker_id:a,period:$("#snapshot_period").val(),start_date:$("#start_date").val(),end_date:$("#end_date").val(),sib_s1:$("#filter-subid-form #sib_s1").prop("checked"),sib_s2:$("#filter-subid-form #sib_s2").prop("checked"),sib_s3:$("#filter-subid-form #sib_s3").prop("checked"),sib_s4:$("#filter-subid-form #sib_s4").prop("checked")},success:function(t){var i=0,o=0,s=0,h=0,c=0,f=0;$.each(t.records,function(e,a){var t=null!=a.revenue?a.revenue.toFixed(2):0,l=null!=a.leads?a.leads:0,d=null!=a.payout?a.payout.toFixed(3):0,n=(t-d).toFixed(2),f=0==n||0==t?0:(n/t*100).toFixed(2),p=null!=a.clicks?a.clicks:0,_=$("#filter-subid-form #sib_s1").prop("checked")?a.s1:"",u=$("#filter-subid-form #sib_s2").prop("checked")?a.s2:"",b=$("#filter-subid-form #sib_s3").prop("checked")?a.s3:"",m=$("#filter-subid-form #sib_s4").prop("checked")?a.s4:"",v=a.s5,g=_+'<textarea class="subid-details hidden">'+JSON.stringify(a)+"</textarea>",a="<tr><td>"+g+"</td><td>"+u+"</td><td>"+b+"</td><td>"+m+"</td><td>"+v+"</td><td>"+p+"</td><td>$ "+d+"</td><td>"+l+"</td><td> $"+t+"</td><td> $"+n+"</td><td>"+f+"%</td></tr>";r.append(a),i+=Number(p),o+=Number(d),s+=Number(l),h+=Number(t),c+=Number(n)}),f=0==h?"N/A":((h-o)/h*100).toFixed(2)+"%",d.find(":nth-child(6)").html(i),d.find(":nth-child(7)").html("$"+o.toLocaleString()),d.find(":nth-child(8)").html(s),d.find(":nth-child(9)").html("$"+h.toLocaleString()),d.find(":nth-child(10)").html("$"+c.toLocaleString()),d.find(":nth-child(11)").html(f),l.DataTable({responsive:!0,lengthMenu:[[10,15,25,50,100,-1],[10,15,25,50,100,"All"]]}).draw();var p=n+"/downloadRevTrackerSubIDReports?affiliate_id="+e+"&revenue_tracker_id="+a+"&period="+$("#snapshot_period").val()+"&start_date="+$("#start_date").val()+"&end_date="+$("#end_date").val()+"&sib_s1="+$("#filter-subid-form #sib_s1").prop("checked")+"&sib_s2="+$("#filter-subid-form #sib_s2").prop("checked")+"&sib_s3="+$("#filter-subid-form #sib_s3").prop("checked")+"&sib_s4="+$("#filter-subid-form #sib_s4").prop("checked");console.log(p),$("#downloadSubReportBtn").removeClass("disabled").attr("href",p)}})}$(document).on("show.bs.modal",".modal",function(){var e=1040+10*$(".modal:visible").length;$(this).css("z-index",e),setTimeout(function(){$(".modal-backdrop").not(".modal-stack").css("z-index",e-1).addClass("modal-stack")},0)});var l=$(".alert");l.on("click",".close-internal-report-error",function(){$(this).closest(".alert").fadeOut(),$(this).closest(".internal-error-wrapper").hide()}),l.on("click",".close-handp-report-error",function(){$(this).closest(".alert").fadeOut(),$(this).closest(".handp-error-wrapper").hide()}),l.on("click",".close-internal-iframe-report-error",function(){$(this).closest(".alert").fadeOut(),$(this).closest(".internal-iframe-error-wrapper").hide()}),$(".draggable-drilldown-modal").draggable({handle:".modal-header"});var r=$(".date-range-picker");r.prop("readonly",!0),$(".input-group.date").datepicker({format:"yyyy-mm-dd",clearBtn:!0,autoclose:!0,todayHighlight:!0,orientation:"top auto"});var d="";r.on("propertychange change paste input",function(){$(this).val()!=d&&(d=$(this).val(),$("#snapshot_period").val("none"))}),r.change(function(){var e=$("#end_date");e.removeClass("error_field"),Date.parse($("#start_date").val())>Date.parse(e.val())&&$("#end_date").addClass("error_field")});var i=$("#snapshot_period");i.change(function(){$("#start_date").val(""),$("#end_date").val("")}),$(".download-report-btn").hide();var n=$("#baseUrl").html(),o=$("#reportsUrl").html(),s=i,h=s.val(),c="?start_date="+$("#start_date").val()+"&end_date="+$("#end_date").val();$("a#downloadXLSInternal").attr("href",n+"/downloadAffiliateReportXLS/1/"+h+c),$("a#downloadXLSHandP").attr("href",n+"/downloadAffiliateReportXLS/2/"+h+c),s.change(function(){var e=$(this).val();console.log(e);var a="?start_date="+$("#start_date").val()+"&end_date="+$("#end_date").val();$("a#downloadXLSInternal").attr("href",n+"/downloadAffiliateReportXLS/1/"+e+a),$("a#downloadXLSHandP").attr("href",n+"/downloadAffiliateReportXLS/2/"+e+a)});var f=n+"/getAffiliateReports",p=n+"/getIframeAffiliateReports",_=n+"/getIframeWebsiteReports",u=n+"/getIframeRevenueTrackerReports";$("#internal-table").dataTable(),$("#affiliate_website-table").dataTable(),$("#subIDBreakdownTable").dataTable(),e(),$("#handp-table").DataTable(),a();var b,m=$("#internal-iframe-table").DataTable({responsive:!0,processing:!0,serverSide:!0,language:{searchPlaceholder:"Affiliate"},lengthMenu:[[25,50,100,-1],[25,50,100,"All"]],order:[[0,"asc"]],ajax:{url:p,type:"post",data:function(e){e.period=$("#snapshot_period").val(),e.affiliate_type=1,e.start_date=$("#start_date").val(),e.end_date=$("#end_date").val()},dataSrc:function(e){return console.log(e),$(m.column(1).footer()).html(e.totalPassovers),$(m.column(2).footer()).html(e.totalPayout),$(m.column(3).footer()).html(e.totalLeads),$(m.column(4).footer()).html(e.totalRevenue),$(m.column(5).footer()).html(e.totalWeGet),$(m.column(6).footer()).html(e.totalMargin),e.data}},columns:[{data:"affiliate"},{data:"passovers"},{data:"payout"},{data:"leads"},{data:"revenue"},{data:"we_get"},{data:"margin"}]}),v=0,g=0;$("#revenueTrackersDetailsTable").DataTable({responsive:!0,lengthMenu:[[10,15,25,50,100,-1],[10,15,25,50,100,"All"]]}),$("#handp-subid-table").DataTable({responsive:!0,lengthMenu:[[10,15,25,50,100,-1],[10,15,25,50,100,"All"]]}),$("#subIDCampaignDetailsTable").DataTable({responsive:!0,lengthMenu:[[10,15,25,50,100,-1],[10,15,25,50,100,"All"]]}),$(document).on("click","#handp-subid-table tbody tr td:first-child",function(e){if($(this).parent("tr").children().length>1){var a=$.parseJSON($(this).find(".affiliate-details").html()),t=a.affiliate_id,l=a.s1,r=a.s2,d=a.s3,i=a.s4,o=a.s5,s=t+"/"+l+" - "+r+" - "+d+" - "+i+" - "+o,h=$("#subIDCampaignDetailsModal");$("#subID").html(s);var c=$("#subIDCampaignDetailsTable"),f=$("#subIDCampaignDetailsTable tbody"),p=$("#subIDCampaignDetailsTable tfoot tr");p.find(":nth-child(2)").html(""),p.find(":nth-child(3)").html(""),c.DataTable().destroy(),f.empty(),$.ajax({type:"POST",url:n+"/getHandPSubIDReports",data:{affiliate_id:t,s1:l,s2:r,s3:d,s4:i,s5:o,period:$("#snapshot_period").val(),start_date:$("#start_date").val(),end_date:$("#end_date").val()},success:function(e){var a=0,t=0,l=e.campaigns;$.each(e.records,function(e,r){var d=null!=r.revenue?r.revenue.toFixed(2):0,i=null!=r.leads?r.leads:0,r="<tr><td>"+l[r.campaign_id]+"</td><td>"+i+"</td><td>$ "+d+"</td></tr>";f.append(r),a+=Number(i),t+=Number(d)}),p.find(":nth-child(2)").html(a),p.find(":nth-child(3)").html("$"+t.toLocaleString()),c.DataTable({responsive:!0,lengthMenu:[[10,15,25,50,100,-1],[10,15,25,50,100,"All"]],language:{searchPlaceholder:"Campaign"}}).draw()}}),h.hasClass("in")||h.modal("show")}});var w;$(document).on("click","#affiliate_website-table tbody tr td:first-child",function(e){$(this).parent("tr").children().length>1&&(w=$(this).find(".revenue-tracker"),t(),$("#subIDDetailsModal").modal("show"))}),$(document).on("submit","#filter-subid-form",function(e){e.preventDefault(),t()}),$("#subIDDetailsModal").on("hidden.bs.modal",function(e){$("#filter-subid-form #sib_s1").prop("checked",!1),$("#filter-subid-form #sib_s2").prop("checked",!1),$("#filter-subid-form #sib_s3").prop("checked",!1),$("#filter-subid-form #sib_s4").prop("checked",!1)}),$(document).on("click","#subIDBreakdownTable tbody tr td:nth-child(1)",function(e){if($(this).parent("tr").children().length>1){var a=$.parseJSON($(this).find(".subid-details").html()),t=a.affiliate_id,l=a.revenue_tracker_id,r=$("#filter-subid-form #sib_s1").prop("checked")?a.s1:"",d=$("#filter-subid-form #sib_s2").prop("checked")?a.s2:"",i=$("#filter-subid-form #sib_s3").prop("checked")?a.s3:"",o=$("#filter-subid-form #sib_s4").prop("checked")?a.s4:"",s=a.s5,h=r+" - "+d+" - "+i+" - "+o+" - "+s;console.log("affiliate_id: "+t),console.log("revenue_tracker_id: "+l),console.log("webname: "+h);var c=$("#revenueTrackerDetailsModal");$("#revenueTrackerWebsite").html(h),the_url=n+"/getRevenueTrackerReports";var f=$("#revenueTrackersDetailsTable"),p=$("#revenueTrackersDetailsTable tbody"),_=$("#revenueTrackersDetailsTable tfoot tr");_.find(":nth-child(2)").html(""),_.find(":nth-child(3)").html(""),f.DataTable().destroy(),p.empty(),$.ajax({type:"POST",url:the_url,data:{affiliate_id:t,revenue_tracker_id:l,s1:r,s2:d,s3:i,s4:o,s5:s,period:$("#snapshot_period").val(),start_date:$("#start_date").val(),end_date:$("#end_date").val(),sib_s1:$("#filter-subid-form #sib_s1").prop("checked"),sib_s2:$("#filter-subid-form #sib_s2").prop("checked"),sib_s3:$("#filter-subid-form #sib_s3").prop("checked"),sib_s4:$("#filter-subid-form #sib_s4").prop("checked")},success:function(e){var a=0,t=0,l=e.campaigns;$.each(e.records,function(e,r){1==r.campaign_id&&console.log(r);var d=null!=r.revenue?r.revenue.toFixed(2):0,i=null!=r.lead_count?r.lead_count:0,r=(r.s1+'<textarea class="subid-details hidden">'+JSON.stringify(r)+"</textarea>","<tr><td>"+l[r.campaign_id]+"</td><td>"+i+"</td><td>$ "+d+"</td></tr>");p.append(r),a+=Number(i),t+=Number(d)}),_.find(":nth-child(2)").html(a),_.find(":nth-child(3)").html("$"+t.toLocaleString()),f.DataTable({responsive:!0,lengthMenu:[[10,15,25,50,100,-1],[10,15,25,50,100,"All"]],language:{searchPlaceholder:"Campaign"}}).draw()}}),c.hasClass("in")||c.modal("show")}}),$(document).on("click","#iframe_affiliate_website-table tbody tr td:first-child",function(e){if($(this).parent("tr").children().length>1){var a=$(this).find(".revenue-tracker"),t=a.data("id"),l=a.data("rtid"),r=a.data("webname"),d=$("#iframeRevenueTrackerDetailsModal");console.log("affiliate_id: "+t),console.log("revenue_tracker_id: "+l),console.log("webname: "+r),$("#iframeRevenueTrackerWebsite").html(r);var i=$("#iframeRevenueTrackersDetailsTable");i.DataTable().clear(),i.DataTable().destroy();var n=i.DataTable({responsive:!0,processing:!0,serverSide:!0,language:{searchPlaceholder:"Campaign"},lengthMenu:[[10,15,25,50,100,-1],[10,15,25,50,100,"All"]],order:[[0,"asc"]],ajax:{url:u,type:"post",data:function(e){e.period=$("#snapshot_period").val(),e.affiliate_id=t,e.revenue_tracker_id=l,e.start_date=$("#start_date").val(),e.end_date=$("#end_date").val()},dataSrc:function(e){return console.log(e),$(n.column(1).footer()).html(e.totalLeads),$(n.column(2).footer()).html(e.totalRevenue),e.data}},columns:[{data:"campaign"},{data:"leads"},{data:"revenue"}],drawCallback:function(e){},initComplete:function(){}});d.hasClass("in")||d.modal("show")}}),$(document).on("click","#internal-iframe-table tbody tr td:first-child",function(e){if($(this).parent("tr").children().length>1){var a=$(this).find(".ar_aff_id"),t=a.data("id");$("#pr_aff_cmp").html($(this).find(".ar_aff_id").html()),v=t;var l=$("#iframe_affiliate_website-table");l.DataTable().clear(),l.DataTable().destroy();var r=l.DataTable({responsive:!0,processing:!0,serverSide:!0,language:{searchPlaceholder:"Website"},lengthMenu:[[10,15,25,50,100,-1],[10,15,25,50,100,"All"]],order:[[0,"asc"]],ajax:{url:_,type:"post",data:function(e){e.period=$("#snapshot_period").val(),e.affiliate_id=v,e.start_date=$("#start_date").val(),e.end_date=$("#end_date").val()},dataSrc:function(e){return console.log(e),$(r.column(1).footer()).html(e.totalPassovers),$(r.column(2).footer()).html(e.totalPayout),$(r.column(3).footer()).html(e.totalLeads),$(r.column(4).footer()).html(e.totalRevenue),$(r.column(5).footer()).html(e.totalWeGet),$(r.column(6).footer()).html(e.totalMargin),e.data}},columns:[{data:"website_name"},{data:"passovers"},{data:"payout"},{data:"leads"},{data:"revenue"},{data:"we_get"},{data:"margin"}]});$("#prIframeAffiliateWebsiteModal").modal("show")}}),$(document).on("click","#internal-table tbody tr td:first-child",function(e){if($(this).parent("tr").children().length>1){var a=$(this).find(".ar_aff_id"),t=a.data("id"),l=a.data("type");$("#pr_aff_cmp").html($(this).find(".ar_aff_id").html()),v=t,g=l,the_url=n+"/getWebsiteReports";var r=$("#affiliate_website-table"),d=$("#affiliate_website-table tbody"),i=$("#affiliate_website-table tfoot tr");i.find(":nth-child(2)").html(""),i.find(":nth-child(3)").html(""),i.find(":nth-child(4)").html(""),i.find(":nth-child(5)").html(""),i.find(":nth-child(6)").html(""),i.find(":nth-child(7)").html(""),r.DataTable().destroy(),d.empty(),$.ajax({type:"POST",url:the_url,data:{affiliate_id:v,period:$("#snapshot_period").val(),affiliate_type:l,start_date:$("#start_date").val(),end_date:$("#end_date").val()},success:function(e){var a=0,t=0,l=0,n=0,o=0,s=0,h=e.websites;$.each(e.records,function(e,r){var i=null!=r.revenue?r.revenue.toFixed(2):0,s=null!=r.leads?r.leads:0,c=null!=r.payout?r.payout.toFixed(3):0,f=(i-c).toFixed(2),p=0==f||0==i?0:(f/i*100).toFixed(2),_=h[r.revenue_tracker_id],u=null!=r.clicks?r.clicks:0,$='<span class="revenue-tracker" data-id="'+r.affiliate_id+'" data-rtid="'+r.revenue_tracker_id+'" data-webname="'+_+'">'+_+"</span>",r="<tr><td>"+$+"</td><td>"+u+"</td><td>$ "+c+"</td><td>"+s+"</td><td> $"+i+"</td><td> $"+f+"</td><td>"+p+"%</td></tr>";d.append(r),a+=Number(u),t+=Number(c),l+=Number(s),n+=Number(i),o+=Number(f)}),s=0==n?"N/A":((n-t)/n*100).toFixed(2)+"%",i.find(":nth-child(2)").html(a),i.find(":nth-child(3)").html("$"+t.toLocaleString()),i.find(":nth-child(4)").html(l),i.find(":nth-child(5)").html("$"+n.toLocaleString()),i.find(":nth-child(6)").html("$"+o.toLocaleString()),i.find(":nth-child(7)").html(s),r.DataTable({responsive:!0,lengthMenu:[[10,15,25,50,100,-1],[10,15,25,50,100,"All"]],language:{searchPlaceholder:"Website"}}).draw()}}),$("#prAffiliateWebsiteModal").modal("show")}}),$(document).on("click","#handp-table tbody tr td:first-child",function(e){if($(this).parent("tr").children().length>1){var a=$(this).find(".ar_aff_id"),t=a.data("id"),l=a.data("type");$("#handp_aff_cmp").html($(this).find(".ar_aff_id").html()),v=t,g=l;var r=$("#handp-subid-table"),d=$("#handp-subid-table tbody"),i=$("#handp-subid-table tfoot tr");i.find(":nth-child(7)").html(""),i.find(":nth-child(8)").html(""),i.find(":nth-child(9)").html(""),i.find(":nth-child(10)").html(""),i.find(":nth-child(11)").html(""),r.DataTable().destroy(),d.empty(),$.ajax({type:"POST",url:n+"/getHandPAffiliateSubIDReports",data:{affiliate_id:v,period:$("#snapshot_period").val(),affiliate_type:g,affiliate_id:v,start_date:$("#start_date").val(),end_date:$("#end_date").val()},success:function(e){var a=0,t=0,l=0,n=0,o=0;e.websites;$.each(e.records,function(e,r){var i=null!=r.revenue?r.revenue.toFixed(2):0,o=null!=r.leads?r.leads:0,s=null!=r.payout?r.payout.toFixed(2):0,h=(i-s).toFixed(2),c=0==h||0==i?0:(h/i*100).toFixed(2),f=r.affiliate_id+'<textarea class="affiliate-details hidden">'+JSON.stringify(r)+"</textarea>",r="<tr><td>"+f+"</td><td>"+r.s1+"</td><td>"+r.s2+"</td><td>"+r.s3+"</td><td>"+r.s4+"</td><td>"+r.s5+"</td><td>"+o+"</td><td>$ "+s+"</td><td> $"+i+"</td><td> $"+h+"</td><td>"+c+"%</td></tr>";d.append(r),a+=Number(s),t+=Number(o),l+=Number(i),n+=Number(h)}),o=0==l?"N/A":((l-a)/l*100).toFixed(2)+"%",i.find(":nth-child(7)").html(t),i.find(":nth-child(8)").html("$"+a.toLocaleString()),i.find(":nth-child(9)").html("$"+l.toLocaleString()),i.find(":nth-child(10)").html("$"+n.toLocaleString()),i.find(":nth-child(11)").html(o),r.DataTable({responsive:!0,lengthMenu:[[10,15,25,50,100,-1],[10,15,25,50,100,"All"]],language:{searchPlaceholder:"Sub ID"}}).draw()}}),$("#handpSubIDModal").modal("show")}}),$('[href="#internal_tab"]').click(function(){$(".alert-danger-wrapper").hide(),$(".alert-warning-wrapper").hide(),$(".alert-success-wrapper").hide(),$(".internal-error-wrapper").hide()}),$('[href="#handp_tab"]').click(function(){$(".alert-danger-wrapper").hide(),$(".alert-warning-wrapper").hide(),$(".alert-success-wrapper").hide(),$(".handp-error-wrapper").hide()}),$('[href="#internal_iframe_tab"]').click(function(){$(".alert-danger-wrapper").hide(),$(".alert-warning-wrapper").hide(),$(".alert-success-wrapper").hide(),$(".internal-iframe-error-wrapper").hide()}),$('[href="#both_tab"]').click(function(){$.fn.DataTable.isDataTable("#both-table")||(b=$("#both-table").DataTable({responsive:!0,processing:!0,serverSide:!0,language:{searchPlaceholder:"Affiliate"},lengthMenu:[[25,50,100,-1],[25,50,100,"All"]],order:[[0,"asc"]],ajax:{url:f,type:"post",data:function(e){e.period=$("#snapshot_period").val(),e.affiliate_type=0,e.start_date=$("#start_date").val(),e.end_date=$("#end_date").val()},dataSrc:function(e){return console.log(e),$(b.column(1).footer()).html(e.totalClicks),$(b.column(2).footer()).html(e.totalPayout),$(b.column(3).footer()).html(e.totalLeads),$(b.column(4).footer()).html(e.totalRevenue),$(b.column(5).footer()).html(e.totalWeGet),$(b.column(6).footer()).html(e.totalMargin),e.data}},columns:[{data:"affiliate"},{data:"clicks"},{data:"payout"},{data:"leads"},{data:"revenue"},{data:"we_get"},{data:"margin"}]}))}),$(".generate-handp-excel-report").click(function(){var e=$(this),a=e.data("download_link_id"),t=s.val(),l=e.html(),r=n+"/generateHandPAffiliateReportsXLS/"+t;e.attr("disabled","true"),e.html('<i class="fa fa-spin fa-spinner"></i>');var d=$("#start_date").val(),i=$("#end_date").val(),o={start_date:d,end_date:i};$.ajax({type:"GET",url:r,data:o,error:function(a){var t=a.responseJSON;console.log(a);var r=$(".this_errors");$(".this_error_wrapper").show(),r.html(""),r.show();var d="<ul>";$.each(t,function(e,a){d+='<li> <span class="glyphicon glyphicon-remove-sign" aria-hidden="true"></span> '+a[0]+"</li>",form.find('label[for="'+e+'"]').addClass("error_label error"),form.find("#"+e).addClass("error_field error")}),d+="</ul>",r.append(d),e.html(l),e.removeAttr("disabled")},success:function(r){$(".this_error_wrapper").show(),console.log(r.status),console.log(r.message),console.log(r.key),console.log(r.file);var d=$(".alert-danger-wrapper"),i=$(".alert-success-wrapper");switch(d.hide(),$(".alert-warning-wrapper").hide(),i.hide(),r.status){case"generate_failed":d.show();var o=$(".alert-danger-content");o.html(""),o.append(r.message);break;default:i.show();var s=$(".alert-success-content");s.html(""),s.append(r.message),console.log(a),console.log(t);var h=n+"/downloadAffiliateReportXLS?file_name_dl="+encodeURI(r.file);$(a).attr("href",h),$(a).show()}e.html(l),e.removeAttr("disabled")}})}),$(".generate-iframe-excel-report").click(function(){var e=$(this),a=e.data("download_link_id"),t=s.val(),l=e.html(),r=n+"/generateIframeAffiliateReportXLS/"+t;e.attr("disabled","true"),e.html('<i class="fa fa-spin fa-spinner"></i>');var d=$("#start_date").val(),i=$("#end_date").val(),o={start_date:d,end_date:i};$.ajax({type:"GET",url:r,data:o,error:function(a){var t=a.responseJSON;console.log(a);var r=$(".this_errors");$(".this_error_wrapper").show(),r.html(""),r.show();var d="<ul>";$.each(t,function(e,a){d+='<li> <span class="glyphicon glyphicon-remove-sign" aria-hidden="true"></span> '+a[0]+"</li>",form.find('label[for="'+e+'"]').addClass("error_label error"),form.find("#"+e).addClass("error_field error")}),d+="</ul>",r.append(d),e.html(l),e.removeAttr("disabled")},success:function(r){$(".this_error_wrapper").show(),console.log(r.status),console.log(r.message),console.log(r.key),console.log(r.file);var d=$(".alert-danger-wrapper");d.hide(),$(".alert-warning-wrapper").hide();var i=$(".alert-success-wrapper");switch(i.hide(),r.status){case"generate_failed":d.show();var o=$(".alert-danger-content");o.html(""),o.append(r.message);break;default:i.show();var s=$(".alert-success-content");s.html(""),s.append(r.message),console.log(a),console.log(t);var h=n+"/downloadAffiliateReportXLS?file_name_dl="+encodeURI(r.file);$(a).attr("href",h),$(a).show()}e.html(l),e.removeAttr("disabled")}})}),$(".generate-excel-report").click(function(){var e=$(this),a=e.data("affiliate_type"),t=e.data("download_link_id"),l=$("#downloadXLSInternalNSB"),r=s.val(),d=e.html();$(t).hide(),$(l).hide();var i=n+"/generateAffiliateReportXLS/"+a+"/"+r;e.attr("disabled","true"),e.html('<i class="fa fa-spin fa-spinner"></i>');var h=$("#start_date").val(),c=$("#end_date").val(),f={start_date:h,end_date:c};$.ajax({type:"GET",url:i,data:f,error:function(a){var t=a.responseJSON;console.log(a);var l=$(".this_errors");$(".this_error_wrapper").show(),l.html(""),l.show();var r="<ul>";$.each(t,function(e,a){r+='<li> <span class="glyphicon glyphicon-remove-sign" aria-hidden="true"></span> '+a[0]+"</li>",form.find('label[for="'+e+'"]').addClass("error_label error"),form.find("#"+e).addClass("error_field error")}),r+="</ul>",l.append(r),e.html(d),e.removeAttr("disabled")},success:function(a){$(".this_error_wrapper").show(),console.log(a);var r=$(".alert-danger-wrapper");r.hide(),$(".alert-warning-wrapper").hide();var i=$(".alert-success-wrapper");switch(i.hide(),a.status){case"generate_failed":r.show();var n=$(".alert-danger-content");n.html(""),n.append(a.message);break;default:i.show();var s=$(".alert-success-content");if(s.html(""),s.append(a.message),"generate_successful"==a.status){var h=o+"/downloadAffiliateReportXLS?file_name_dl="+encodeURI(a.file);if($(t).attr("href",h),$(t).show(),a.hasSubidBreakdown){var h=o+"/downloadAffiliateReportXLS?file_name_dl="+encodeURI(a.nsb_file);$(l).attr("href",h),$(l).show()}}}e.html(d),e.removeAttr("disabled")}})});var k="#internal_tab";$(document).on("submit","#updatePublisherReportsTable",function(t){t.preventDefault(),$(".pr_sp_periord").html($("#snapshot_period option:selected").html()),console.log(k);var l=$("#snapshot_period").val(),r=$("#start_date").val(),d=$("#end_date").val();$.fn.DataTable.isDataTable("#internal-table")&&"#internal_tab"==k&&($("#internal_tab_snap_shot").val(l),$("#internal_tab_start_date").val(r),$("#internal_tab_end_date").val(d),e()),$.fn.DataTable.isDataTable("#handp-table")&&"#handp_tab"==k&&($("#handp_tab_snap_shot").val(l),$("#hand_tab_start_date").val(r),$("#handp_tab_end_date").val(d),a()),$.fn.DataTable.isDataTable("#internal-iframe-table")&&"#internal_iframe_tab"==k&&($("#internal_iframe_tab_snap_shot").val(l),$("#internal_iframe_tab_start_date").val(r),$("#internal_iframe_end_date").val(d),console.log("awts"),m.order([[0,"asc"]]),m.ajax.reload()),$.fn.DataTable.isDataTable("#both-table")&&"#both"==k&&(b.order([[0,"asc"]]),b.ajax.reload())}),$('a[data-toggle="tab"]').on("shown.bs.tab",function(e){var a,t,l,r=$(e.target).attr("href"),d=$("#snapshot_period"),i=$("#start_date"),n=$("#end_date");switch(r){case"#handp_tab":a=$("#handp_tab_snap_shot").val(),t=$("#hand_tab_start_date").val(),l=$("#handp_tab_end_date").val();break;case"#internal_tab":a=$("#internal_tab_snap_shot").val(),t=$("#internal_tab_start_date").val(),l=$("#internal_tab_end_date").val();break;case"#internal_iframe_tab":a=$("#internal_iframe_tab_snap_shot").val(),t=$("#internal_iframe_tab_start_date").val(),l=$("#internal_iframe_tab_end_date").val()}d.val(a),i.val(t),n.val(l),k=r}),$('a[data-toggle="tab"]').on("hide.bs.tab",function(e){var a=$(e.target).attr("href");console.log(a);var t,l,r,d=$("#snapshot_period"),i=$("#start_date"),n=$("#end_date");switch(t=d.val(),l=i.val(),r=n.val(),a){case"#handp_tab":$("#handp_tab_snap_shot").val(t),$("#hand_tab_start_date").val(l),$("#handp_tab_end_date").val(r);break;case"#internal_tab":$("#internal_tab_snap_shot").val(t),$("#internal_tab_start_date").val(l),$("#internal_tab_end_date").val(r);break;case"#internal_iframe_tab":$("#internal_iframe_tab_snap_shot").val(t),$("#internal_iframe_tab_start_date").val(l),$("#internal_iframe_tab_end_date").val(r)}})});
//# sourceMappingURL=affiliate_reports.min.js.map
