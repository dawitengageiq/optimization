{"version":3,"sources":["pageoptinratestats.js"],"names":["$","campaign_types_count","parseInt","val","campaign_type_columns","campaign_type_columns_string","current_campaign_type_count","x","push","campaign_type","campaign","linkout_ids","parseJSON","displayed_benchmarks","tooltip","optin_table","DataTable","processing","serverSide","autoWidth","searching","columnDefs","orderable","targets","deferLoading","ajax","url","html","type","data","d","affiliate_id","date_from","date_to","group_by","date_range","sib_s1","prop","sib_s2","sib_s3","sib_s4","benchmark","Array","offer_ids","each","i","obj","cmp","trim","length","cmpx","v","inArray","map","this","get","benchmarks","dataSrc","json","columns","visible","hiddenCols","index","column","removeAttr","date","label","append","j","cmp_name","cmp_name_prev","substr","trigger","error","console","log","lengthMenu","sDom","select2","document","on","clear","reload","submit","e","preventDefault","attr","order","click","from_date","to_date","form","removeClass","addClass","placeholder","minimumInputLength","theme","language","inputTooShort","args","dataType","params","queryParameters","term","processResults","results","items","item","text","name","id","datepicker","format","clearBtn","autoclose","todayHighlight","change","modal","event","element"],"mappings":"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","file":"pageoptinratestats.min.js","sourcesContent":["$(function()\r\n{\r\n\tvar campaign_types_count = parseInt($(\"#totalCampaignTypeCountCol\").val()),\r\n\t\tcampaign_type_columns = [],\r\n\t\tcampaign_type_columns_string = '',\r\n\t\tcurrent_campaign_type_count = campaign_types_count;\r\n\r\n\tfor(x = 7; x <= campaign_types_count + 2; x++) {\r\n\t\tcampaign_type_columns.push(x);\r\n\t\tcampaign_type_columns_string += x + ',';\r\n\t}\r\n   \r\n\tvar campaign_type = null, campaign = null,\r\n        linkout_ids = $.parseJSON($('#campaignLinkoutIds').val()),\r\n        displayed_benchmarks = $.parseJSON($('#current_benchmarks').val());\r\n    $('[data-toggle=\"tooltip\"]').tooltip();\r\n\r\n    var optin_table = $('#pageOptInRateStats-table').DataTable({\r\n\t\t'processing': true,\r\n\t\t'serverSide': true,\r\n\t\t\"autoWidth\": false,\r\n        \"searching\": false,\r\n\t\t\"columnDefs\": [\r\n\t\t    { \"orderable\": false, \"targets\": [8,9,10,11,12,13,14,15,16,17,18,19,20] }\r\n\t\t],\r\n        \"deferLoading\": 0,\r\n\t\t'ajax':{\r\n\t\t\turl: $('#baseUrl').html() + '/admin/pageOptIn',\r\n\t\t\ttype: 'post',\r\n\t\t\t'data': function(d)\r\n            {\r\n                // d.id = $('#id').val();\r\n                // d.benchmarks = $('.campaign_type_benchmark').serialize();\r\n                d.campaign_type = campaign_type;\r\n                d.campaign = campaign;\r\n                d.affiliate_id = $('#affiliate_id').val();\r\n                d.date_from = $('#date_from').val();\r\n                d.date_to = $('#date_to').val();\r\n                d.group_by = $('#group_by').val();\r\n                d.date_range = $('#date_range').val();\r\n                d.sib_s1 = $('#sib_s1').prop('checked');\r\n                d.sib_s2 = $('#sib_s2').prop('checked');\r\n                d.sib_s3 = $('#sib_s3').prop('checked');\r\n                d.sib_s4 = $('#sib_s4').prop('checked');\r\n\r\n                var benchmark = new Array();\r\n                var offer_ids = new Array();\r\n                $('.campaign_type_benchmark').each(function(i,obj) {\r\n                    // console.log($(obj).data('type') + ' - ' + $(obj).val())\r\n                    var type = $(obj).data('type'),\r\n                        cmp = $(obj).val();\r\n                    if(cmp !== '' || cmp.trim().length > 0) {\r\n                        if(type == 5 || type == 6) {\r\n                            var cmpx = new Array();\r\n                            $.each(cmp, function(i, v) {\r\n                                // offer_ids[type].push(linkout_ids[cmp]);\r\n                                cmpx.push(linkout_ids[v]);\r\n                            });\r\n                            offer_ids[type] = cmpx;\r\n                            // offer_ids[type] = linkout_ids[cmp];\r\n                        }\r\n                        if($.inArray('all', cmp) >= 0) {\r\n                            // benchmark[11][]\r\n                            cmp = $('[name=\"benchmark['+type+'][]\"] option').map(function() {return $(this).val();}).get();\r\n                        }\r\n\r\n                        benchmark[type] = cmp;\r\n                    }\r\n                });\r\n\r\n                // console.log(benchmark);\r\n                // console.log(offer_ids);\r\n\r\n                d.benchmarks = benchmark;\r\n                d.offer_ids = offer_ids;\r\n            },\r\n            \"dataSrc\": function ( json ) {\r\n            \toptin_table.columns().visible(true);\r\n                //Hide \r\n                $.each(json.hiddenCols, function(index, type) {\r\n\t\t\t        var column = optin_table.column( $('th.col-ct-'+type) );\r\n\t\t\t        column.visible(false);\r\n                });\r\n                current_campaign_type_count = campaign_types_count - json.hiddenCols.length;\r\n                // console.log(current_campaign_type_count);\r\n\r\n                //Benchmarks\r\n                var benchmarks = json.benchmarks;\r\n                $.each(benchmarks, function(campaign_type, campaign) {\r\n                    $('[name=\"benchmark['+campaign_type+']\"]').val(campaign);\r\n                });\r\n                \r\n                $('#downloadPageOptInRateReport').removeAttr('disabled');\r\n                $('#poisDateLabel').html(json.date);\r\n\r\n                $('.campaign_type_column').html('');\r\n\r\n                //Benchmark Types\r\n                $.each(json.benchmarks, function(type, benchmarks) {\r\n                    if($.inArray('all', benchmarks) >= 0) {\r\n                        benchmarks = ['all'];\r\n\r\n                        label = '<span class=\"label label-default bch-label benchmark-label\" data-toggle=\"tooltip\" data-placement=\"bottom\" title=\"All\">All</span><br>';\r\n                        $('.col-ct-'+type).append(label);\r\n                    }else {\r\n                        $.each(benchmarks, function(j, campaign){\r\n                            var cmp_name = $('[name=\"benchmark['+type+'][]\"] option[value=\"'+campaign+'\"]').html();\r\n                            cmp_name_prev = cmp_name.substr(0,10);\r\n                            if(cmp_name.length > 10) cmp_name_prev += '...';\r\n\r\n                            label = '<span class=\"label label-default bch-label benchmark-label\" data-toggle=\"tooltip\" data-placement=\"bottom\" title=\"'+cmp_name+'\">'+cmp_name_prev+'</span><br>';\r\n                            $('.col-ct-'+type).append(label);\r\n                        });\r\n                    } \r\n\r\n                    $('[name=\"benchmark['+type+'][]\"]').val(benchmarks).trigger('change');\r\n                });\r\n                $('[data-toggle=\"tooltip\"]').tooltip();\r\n                displayed_benchmarks = json.benchmarks;\r\n                return json.data;\r\n            },\r\n\t\t\terror: function(data) //error handling\r\n\t\t\t{\r\n\t\t\t\tconsole.log(data);\r\n\t\t\t}\r\n\t\t},\r\n\t\tlengthMenu: [[25,50,100,1000,2000,3000],[25,50,100,1000,2000,3000]],\r\n        \"sDom\": '<\"pageOptInStats_displayDate\">l<\"pageOptInStats_Toolbar\">frtip'\r\n\t});\r\n\r\n    $('.campaign_type_benchmark').select2();\r\n\r\n    $(\"div.pageOptInStats_Toolbar\").html('<button type=\"button\" class=\"openBenchmarkBtn btn btn-default btn-xs\" data-toggle=\"modal\" data-target=\"#benchmarkModal\"><span class=\"glyphicon glyphicon-pencil\" aria-hidden=\"true\"></span></button><button id=\"refreshPageOptInRateStatsBtn\" type=\"button\" class=\"btn btn-default btn-xs\"><span class=\"glyphicon glyphicon-refresh\" aria-hidden=\"true\"></span></button>');\r\n    $(\"div.pageOptInStats_displayDate\").html('<label>Displaying <span id=\"poisDateLabel\"></span></label>');\r\n\r\n\t// $('.campaign_type_column select').change(function()\r\n //    {\r\n //        setTimeout(function () {\r\n //         $('#refreshPageOptInRateStatsBtn').focus();\r\n //        }, 100);\r\n //    });\r\n\r\n    $(document).on('click', '#refreshPageOptInRateStatsBtn', function(){\r\n        console.log('Refresh');\r\n        optin_table.clear();\r\n        optin_table.ajax.reload();\r\n    });\r\n\r\n    $('#pageOptInRate-form').submit(function(e)\r\n    {\r\n        e.preventDefault();\r\n        $('#downloadPageOptInRateReport').attr('disabled', true);\r\n\r\n        optin_table.order([]);\r\n        optin_table.ajax.reload();\r\n    });\r\n\r\n    $('#generateReportBtn').click(function(e) {\r\n        e.preventDefault();\r\n        var from_date = $('#date_from').val(),\r\n            to_date = $('#date_to').val(),\r\n            form = $('#pageOptInRate-form');\r\n\r\n        $('label[for=\"date_from\"]').removeClass('error_label error');\r\n        $('#date_from').removeClass('error_field error');\r\n        $('label[for=\"date_to\"]').removeClass('error_label error');\r\n        $('#date_to').removeClass('error_field error');\r\n\r\n        if(from_date == '' || to_date == '') {\r\n            form.submit();\r\n        }\r\n        else if(from_date != '' && to_date != '' && to_date >= from_date) {\r\n            $('label[for=\"date_from\"]').removeClass('error_label error');\r\n            $('#date_from').removeClass('error_field error');\r\n            $('label[for=\"date_to\"]').removeClass('error_label error');\r\n            $('#date_to').removeClass('error_field error');\r\n            form.submit();\r\n        }else {\r\n            $('label[for=\"date_from\"]').addClass('error_label error');\r\n            $('#date_from').addClass('error_field error');\r\n            $('label[for=\"date_to\"]').addClass('error_label error');\r\n            $('#date_to').addClass('error_field error');\r\n        }\r\n    });\r\n\r\n    $('#affiliate_id').select2({\r\n        //tags: true,\r\n        placeholder: 'Select the id or name of the affiliate.',\r\n        minimumInputLength: 1,\r\n        theme: 'bootstrap',\r\n        language: {\r\n            inputTooShort: function(args) {\r\n                return \"Please enter the id or name of the affiliate. (Enter 1 or more characters)\";\r\n            }\r\n        },\r\n        ajax: {\r\n            url: $('#baseUrl').html()+'/search/select/activeAffiliatesIDName',\r\n            dataType: \"json\",\r\n            type: \"POST\",\r\n            data: function (params) {\r\n\r\n                var queryParameters = {\r\n                    term: params.term\r\n                };\r\n\r\n                return queryParameters;\r\n            },\r\n            processResults: function (data) {\r\n                // console.log(data);\r\n                return {\r\n                    results: $.map(data.items, function (item) {\r\n                        return {\r\n                            text: item.name,\r\n                            id: item.id\r\n                        }\r\n                    })\r\n                };\r\n            }\r\n        }\r\n    });\r\n\r\n    $('.input-group.date').datepicker({\r\n        format: \"yyyy-mm-dd\",\r\n        clearBtn: true,\r\n        autoclose: true,\r\n        todayHighlight: true\r\n    });\r\n\r\n    $('#clear').click(function()\r\n    {\r\n        $('.input-group.date input').val('');\r\n        $('#affiliate_id').val('').trigger('change');\r\n        $('#group_by').val('day');\r\n    });\r\n\r\n    $('#remove_affiliate_id_selections').click(function(){\r\n        // Clear the ID selections\r\n        $('#affiliate_id').val(null).trigger('change');\r\n    });\r\n\r\n    $('#date_range').change(function() {\r\n        if($(this).val() != '') {\r\n            $('#date_from').val('');\r\n            $('#date_to').val('');\r\n        }\r\n    });\r\n\r\n    $('.lead_date').change(function() {\r\n        if($(this).val() != '') {\r\n            $('#date_range').val('');\r\n        }\r\n    });\r\n\r\n    $(document).on('click', '#updateBenchmarkBtn', function(){\r\n        optin_table.clear();\r\n        optin_table.ajax.reload();\r\n        $('#benchmarkModal').modal('hide');\r\n    });\r\n\r\n    $('#benchmarkModal').on('hide.bs.modal', function (event) \r\n    {\r\n        $.each(displayed_benchmarks, function(type, benchmarks) {\r\n            if($.inArray('all', benchmarks) >= 0) {\r\n                benchmarks = ['all'];\r\n            }\r\n            $('[name=\"benchmark['+type+'][]\"]').val(benchmarks).trigger('change');\r\n        });\r\n    });\r\n\r\n    $(document).on('click', '#selectAllBenchmarkBtn', function(e){\r\n        e.preventDefault();\r\n        $('.campaign_type_benchmark').each(function(index, element) {\r\n            $(this).val('all').trigger('change');\r\n        });\r\n    });\r\n\r\n    $('#group_by').change(function()\r\n    {\r\n        if($(this).val() != 'day') {\r\n            $('.sibs').prop('checked', true).attr('disabled', true);\r\n        }else {\r\n            $('.sibs').removeAttr('disabled');\r\n        }\r\n    });\r\n});"]}