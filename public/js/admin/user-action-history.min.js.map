{"version":3,"sources":["user-action-history.js"],"names":["diffUsingJS","viewType","byId","id","document","getElementById","base","difflib","stringAsLines","value","newtxt","sm","SequenceMatcher","opcodes","get_opcodes","diffoutputdiv","innerHTML","appendChild","diffview","buildView","baseTextLines","newTextLines","baseTextName","newTextName","convertHTMLEntity","text","span","createElement","toString","replace","entity","position","innerText","$","ready","select2","theme","datepicker","format","clearBtn","autoclose","todayHighlight","baseURL","userActionHistoryReportURL","html","historyDataTable","DataTable","processing","serverSide","searching","language","searchPlaceholder","order","ajax","url","type","data","d","user_id","val","section","console","log","sectionID","subSectionID","sectionIDs","split","length","section_id","sub_section_id","change_severity","date_from","date_to","error","dataSrc","json","columns","width","orderable","lengthMenu","click","reload","trigger","on","details","this","logID","subSection","referenceID","userFullName","severity","summary","logDate","oldV","JSON","stringify","newV","oldValue","newValue","modal"],"mappings":"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","file":"user-action-history.min.js","sourcesContent":["$(document).ready(function()\r\n{\r\n    $('#user_id').select2({\r\n        theme: 'bootstrap'\r\n    });\r\n\r\n    $('#section').select2({\r\n        theme: 'bootstrap'\r\n    });\r\n\r\n    $('#sub_section_id').select2({\r\n        theme: 'bootstrap'\r\n    });\r\n\r\n    $('#severity_id').select2({\r\n        theme: 'bootstrap'\r\n    });\r\n\r\n    $('.input-group.date').datepicker({\r\n        format: \"yyyy-mm-dd\",\r\n        clearBtn: true,\r\n        autoclose: true,\r\n        todayHighlight: true\r\n    });\r\n\r\n    var baseURL = $('#baseUrl');\r\n\r\n    var userActionHistoryReportURL = baseURL.html()+'/admin/userActionHistoryReport';\r\n\r\n    var historyDataTable = $('#history-table').DataTable({\r\n        'processing': true,\r\n        'serverSide': true,\r\n        'searching': true,\r\n        language: {\r\n            searchPlaceholder: 'ID, User, Reference ID or Summary'\r\n        },\r\n        'order': [[ 0, \"asc\" ]], //disable the initial ordering\r\n        'ajax':{\r\n            url: userActionHistoryReportURL,\r\n            type: 'POST',  // method  , by default get\r\n            'data': function(d)\r\n            {\r\n                d.user_id = $('#user_id').val();\r\n                // Extract the section and sub section id\r\n                var section = $('#section').val();\r\n                console.log(section);\r\n\r\n                var sectionID = null;\r\n                var subSectionID = null;\r\n\r\n                if(section !== '')\r\n                {\r\n                    var sectionIDs = section.split(' ');\r\n\r\n                    if(sectionIDs.length > 1)\r\n                    {\r\n                        sectionID = sectionIDs[0];\r\n                        subSectionID = sectionIDs[1];\r\n                    }\r\n                    else if(sectionIDs.length === 1)\r\n                    {\r\n                        sectionID = sectionIDs[0];\r\n                    }\r\n                }\r\n\r\n                d.section_id = sectionID;\r\n                d.sub_section_id = subSectionID;\r\n\r\n                d.change_severity = $('#change_severity').val();\r\n                d.date_from = $('#date_from').val();\r\n                d.date_to = $('#date_to').val();\r\n            },\r\n            error: function()\r\n            {\r\n                // error handling\r\n            },\r\n            'dataSrc': function(json)\r\n            {\r\n                return json.data;\r\n            }\r\n        },\r\n        'columns':[\r\n            {\r\n                'data':'id',\r\n                'width': '5%'\r\n            },\r\n            {'data':'user'},\r\n            {\r\n                'data':'section',\r\n                'orderable': false\r\n            },\r\n            {\r\n                'data':'sub_section',\r\n                'orderable': false\r\n            },\r\n            {\r\n                'data': 'reference_id',\r\n                'width': '10%'\r\n            },\r\n            {'data':'summary'},\r\n            {'data':'severity'},\r\n            {'data':'datetime'},\r\n            {\r\n                'data': 'details',\r\n                'width': '5%',\r\n                'orderable': false\r\n            }\r\n        ],\r\n        //'initComplete': rowInitComplete,\r\n        lengthMenu: [[25,50,100,-1],[25,50,100,'ALL']]\r\n    });\r\n\r\n    $('#view_logs').click(function()\r\n    {\r\n        historyDataTable.ajax.reload();\r\n    });\r\n\r\n    $('#clear').click(function()\r\n    {\r\n        $('#date_from').val('');\r\n        $('#date_to').val('');\r\n        $('#user_id').val('').trigger('change');\r\n        $('#section').val('').trigger('change');\r\n        $('#severity_id').val('').trigger('change');\r\n\r\n        //clear the results as well\r\n        historyDataTable.ajax.reload();\r\n    });\r\n\r\n    $(document).on('click', '.show-details', function()\r\n    {\r\n        var details = $(this);\r\n\r\n        var logID = details.data('id');\r\n        var section = details.data('section');\r\n        var subSection = details.data('subsection');\r\n        var referenceID = details.data('refid');\r\n        var userFullName = details.data('fullname');\r\n        var severity = details.data('severity');\r\n        var summary = convertHTMLEntity(details.data('summary'));\r\n        var logDate = convertHTMLEntity(details.data('date'));\r\n\r\n        if(typeof(details.data('oldvalue')) == 'object') {\r\n            oldV = JSON.stringify(details.data('oldvalue'));\r\n        }else oldV = details.data('oldvalue');\r\n\r\n        if(typeof(details.data('newvalue')) == 'object') {\r\n            newV = JSON.stringify(details.data('newvalue'));\r\n        }else newV = details.data('newvalue');\r\n\r\n        var oldValue = convertHTMLEntity(oldV);\r\n        var newValue = convertHTMLEntity(newV);\r\n\r\n        // Fill in the needed modal data fields\r\n        $('.modal-title').html(userFullName + ' | ' + logDate);\r\n        $('#id-value').html(logID);\r\n        $('#section-value').html(section);\r\n        $('#sub-section-value').html(subSection);\r\n        $('#reference-id-value').html(referenceID);\r\n        $('#user-value').html(userFullName);\r\n        $('#severity-value').html(severity);\r\n        $('#summary-value').html(summary);\r\n\r\n        $('#old-value-textarea').val(oldValue);\r\n        $('#new-value-textarea').val(newValue);\r\n\r\n        console.log(oldValue);\r\n        console.log(newValue);\r\n        // if(oldValue !== '' && newValue !== '')\r\n        // {\r\n             diffUsingJS(0);\r\n        // }\r\n        // else\r\n        // {\r\n        //     // remove the table diff\r\n        //     $('#diffoutput > table.diff:first').remove();\r\n        // }\r\n\r\n        // show the modal\r\n        $('#details-modal').modal('show');\r\n    });\r\n\r\n});\r\n\r\nfunction diffUsingJS(viewType) {\r\n    'use strict';\r\n\r\n    var byId = function (id) { return document.getElementById(id); },\r\n        // base = difflib.stringAsLines(byId(\"baseText\").value),\r\n        // newtxt = difflib.stringAsLines(byId(\"newText\").value),\r\n        base = difflib.stringAsLines(byId('old-value-textarea').value),\r\n        newtxt = difflib.stringAsLines(byId('new-value-textarea').value),\r\n\r\n        sm = new difflib.SequenceMatcher(base, newtxt),\r\n\r\n        opcodes = sm.get_opcodes(),\r\n        diffoutputdiv = byId('diffoutput');\r\n        // contextSize = byId('contextSize').value;\r\n\r\n    diffoutputdiv.innerHTML = \"\";\r\n    // contextSize = contextSize || null;\r\n\r\n    diffoutputdiv.appendChild(diffview.buildView({\r\n        baseTextLines: base,\r\n        newTextLines: newtxt,\r\n        opcodes: opcodes,\r\n        baseTextName: 'Old Value',\r\n        newTextName: 'New Value',\r\n        // contextSize: '100',\r\n        viewType: viewType\r\n    }));\r\n}\r\n\r\nfunction convertHTMLEntity(text)\r\n{\r\n    var span = document.createElement('span');\r\n\r\n    return text.toString()\r\n        .replace(/&[#A-Za-z0-9]+;/gi, function(entity,position,text) {\r\n        span.innerHTML = entity;\r\n        return span.innerText;\r\n    });\r\n}"]}