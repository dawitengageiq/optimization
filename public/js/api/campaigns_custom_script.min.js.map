{"version":3,"sources":["campaigns_custom_script.js"],"names":["$","complete","submitID","validator","messages","required","each","index","mask","on","last","this","val","substr","indexOf","length","move","lastfour","first","click","fadeOut","fadeIn","animate","scrollTop","offset","top","document","e","closest","form","find","css","address","hasClass","attr","next","hide","text","phone","setNextStackSet","preventDefault","html","prop","total_answered","validation_counter","is","valid","submit","remove","insertAfter","console","log","setPhoneAndAddress","ajaxProcess","returnProcess","serialize","callback","url","callbackName","Math","round","random","window","data","body","removeChild","script","createElement","src","appendChild","onerror","status","redUrl","location","href","replace","setDefaults","focusInvalid","invalidHandler","numberOfInvalids","parseInt","errorList","element","focus","addMethod","value","optional","test","jQuery"],"mappings":"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","file":"campaigns_custom_script.min.js","sourcesContent":["/**!\r\n * NLR Campaign API Custom Script\r\n * Campaign Custom Script v1 (http://leadreactor.engageiq.com)\r\n * All action, event related to UI of campaigns/offers.\r\n *\r\n * @uses Validator - form submission and input validation\r\n * @uses maskedinput - Phone format\r\n */\r\n\r\n(function($) {\r\n    /**\r\n     * Global variable\r\n     *\r\n     * @var bolean complete - Determine if the sumission looping is completed\r\n     * @var array submitID - container for form entity that was submiited to NLR, later it will be remove when response is sent back\r\n     */\r\n    var complete = false;\r\n    var submitID = [];\r\n\r\n    /**\r\n     * Required text\r\n     *\r\n     */\r\n\t$.validator.messages.required = \"*\";\r\n\r\n    /**\r\n     * On document ready\r\n     *\r\n     */\r\n    $(function() {\r\n\r\n    \t/**\r\n    \t * Phone number format\r\n    \t *\r\n    \t */\r\n    \t// $(\"input[name=phone]\").mask(\"(999) 999-9999\");\r\n        $(\"form\").each(function(index) {\r\n            $(\"input[name=phone], input[name=phone1]\").mask(\"9999999999\");\r\n            $(\"input[name=phone], input[name=phone1]\").on(\"blur\", function() {\r\n                var last = $(this).val().substr( $(this).val().indexOf(\"-\") + 1 );\r\n\r\n                if( last.length == 5 ) {\r\n                    var move = $(this).val().substr( $(this).val().indexOf(\"-\") + 1, 1 );\r\n                    var lastfour = last.substr(1,4);\r\n                    var first = $(this).val().substr( 0, 9 );\r\n                    $(this).val( first + move + '-' + lastfour );\r\n                }\r\n            });\r\n        });\r\n\r\n    \t/**\r\n    \t * Script to display additional input fields in Mobile\r\n    \t *\r\n    \t */\r\n    \t$(\".yes-no-mobile .class-yes\").click(function(){\r\n    \t    $('.yes-no-mobile').fadeOut(500);\r\n    \t    $('#formtable').fadeIn(500);\r\n    \t    $('html, body').animate({\r\n    \t        scrollTop: $(\"#formtable\").offset().top\r\n    \t    }, 500);\r\n    \t});\r\n\r\n    \t$(document)\r\n    \t/**\r\n    \t * Event after the yes button were clicked\r\n    \t *\r\n    \t *  @var form - will be used after\r\n    \t */\r\n    \t.on('click','.submit_stack_campaign', function(e)\r\n        {\r\n    \t\tvar form = $(this).closest(\"form\");\r\n    \t})\r\n    \t/**\r\n    \t * Event after the yes button were clicked\r\n    \t * Show the questionere in campaign content\r\n    \t *\r\n    \t *  @var form - will be used after\r\n    \t */\r\n    \t.on('click','.show_custom_questions', function(e)\r\n    \t{\r\n    \t\tvar form = $(this).closest('form');\r\n    \t\tform.find('#custom_questions').css(\"display\", \"block\" );\r\n    \t})\r\n    \t/**\r\n    \t * Event after the no button were clicked\r\n    \t * Hide the questionere in campaign content\r\n    \t *\r\n    \t *  @var form - will be used after\r\n    \t */\r\n    \t.on('click','.hide_custom_questions', function(e)\r\n    \t{\r\n    \t\tvar form = $(this).closest('form');\r\n    \t\tform.find('#custom_questions').css(\"display\", \"none\" );\r\n    \t})\r\n    \t/**\r\n    \t * Event after focus out on address field\r\n    \t * Update all address fields\r\n    \t *\r\n    \t *  @var address - will be used after\r\n    \t */\r\n    \t.on('change','input[name=\"address\"]', function()\r\n        {\r\n        \tvar address = $(this).val();\r\n        \t$('input[name=\"address\"]').val(address);\r\n            if($(this).hasClass('valid')) {\r\n                $('input[name=\"address\"]').attr('class', 'valid').attr('aria-required', 'false').next().hide().text('');\r\n            }\r\n    \t})\r\n    \t/**\r\n    \t * Event after focus out on phone field\r\n    \t * Update all phone fields\r\n    \t *\r\n    \t *  @var phone\r\n    \t */\r\n    \t.on('change','input[name=\"phone\"]', function()\r\n        {\r\n        \tvar phone = $(this).val();\r\n        \t$('input[name=\"phone\"]').val(phone);\r\n            if($(this).hasClass('valid')) {\r\n                $('input[name=\"phone\"]').attr('class', 'valid').attr('aria-required', 'false').next().hide().text('');\r\n            }\r\n    \t})\r\n    \t/**\r\n    \t * Skip button clicked\r\n    \t *\r\n    \t */\r\n       .on('click', '#skip_btn', function()\r\n       {\r\n           \tsetNextStackSet();\r\n       })\r\n    \t/**\r\n    \t * Event when submit button is clicked\r\n    \t * Go through all form with yes button highlighted then submit it.\r\n    \t *\r\n    \t */\r\n    \t.on('click','#submit_stack_button', function(e)\r\n        {\r\n        \te.preventDefault();\r\n    \t\t// disble the submit button\r\n    \t\t$(this).html('Sending').attr('disabled',true).prop('disabled', true);\r\n\r\n    \t\tvar total_answered = $('.submit_stack_campaign:checked').length;\r\n            //if($(this).find('.new-yesno-button input#NetspendCMG-no').is(':checked')) total_answered++;\r\n    \t\tvar validation_counter = 0;\r\n\r\n    \t\t// Reset value of #error_validation_counter input in every submission\r\n    \t\t$('#error_validation_counter').val( 0 );\r\n\r\n            // Redirect to next page if no yes button was click\r\n    \t\tif(total_answered === 0) {\r\n    \t    \tsetNextStackSet();\r\n                return;\r\n    \t    }\r\n            // Process form submission to NLR\r\n            // Go through for validation and submission\r\n\t\t\t$(\"form\").each(function () {\r\n                if($(this).attr('data-sent') !== 'true') {\r\n                    if($(this).find('.submit_stack_campaign').is(':checked') && $(this).valid()) {\r\n\t\t\t\t\t\t$(this).submit();\r\n\t\t\t    \t\tvalidation_counter++;\r\n    \t\t\t    }\r\n                }else {\r\n                    validation_counter++;\r\n                }\r\n\t\t\t});\r\n\r\n            // console.log('total_answered: ', total_answered);\r\n            // console.log('validation_counter: ', validation_counter);\r\n\r\n            // If the count is equal means all validation was passed\r\n            // Need to submit data now to NLR\r\n\t\t\tif(total_answered == validation_counter) {\r\n                //console.log('Next');\r\n                complete = true;\r\n                $('#skip_btn').remove();\r\n                $('<a id=\"skip_btn\" style=\"text-decoration: none; cursor: pointer; display: block; color: #4285f4;\">Skip</a>').insertAfter('#submit_stack_button');\r\n                setNextStackSet();\r\n                return;\r\n\t\t\t}\r\n\r\n\t\t\tconsole.log('Not Submit');\r\n\t\t\t$(this).attr('disabled', false);\r\n    \t})\r\n    \t/**\r\n    \t * Processor of form submit.\r\n    \t * Prevent default action of form to process custom functions\r\n    \t *\r\n    \t */\r\n    \t.on('submit','.stack_survey_form', function(e)\r\n        {\r\n        \te.preventDefault();\r\n    \t\tvar form = $(this);\r\n            // Update other form with this phone number\r\n    \t\tsetPhoneAndAddress(form);\r\n\r\n            // Process the form action\r\n    \t\tif(form.attr('action') != '') {\r\n                // Process now the submission\r\n    \t\t\tajaxProcess(form, returnProcess, submitID);\r\n    \t\t\tconsole.log('SENT');\r\n    \t\t\tconsole.log(form.attr('action') + '?' + form.serialize());\r\n                return;\r\n    \t\t}\r\n            // Means the form has empty action so skip it.\r\n            console.log('SKIP');\r\n    \t});\r\n    });\r\n\r\n    /**\r\n     * Determine if browser is IE\r\n     *\r\n     */\r\n    var checkIfBrowserIE = function () {\r\n    \tvar ua = window.navigator.userAgent;\r\n        var msie = ua.indexOf(\"MSIE \");\r\n        if (msie > 0 || !!navigator.userAgent.match(/Trident.*rv\\:11\\./))\r\n        \treturn true;\r\n        else\r\n        \treturn false;\r\n    }\r\n\r\n    // Remove the form elements to sbmitID array\r\n    var removeInArray = function (form, submitID) {\r\n    \tif ($.inArray(form, submitID)) submitID.splice($.inArray(form, submitID), 1);\r\n    }\r\n\r\n    /**\r\n     * JSONP call.\r\n     *\r\n     */\r\n    var ajaxProcess = function (form, callback, submitID) {\r\n        console.log('ajaxProcess');\r\n    \tvar url = form.attr('action') + '?' + form.serialize();\r\n    \tvar callbackName = 'eq_callback_' + Math.round(100000 * Math.random());\r\n\r\n        // Create callback for jsonp response\r\n    \twindow[callbackName] = function(data) {\r\n    \t\tdelete window[callbackName];\r\n    \t\tdocument.body.removeChild(script);\r\n    \t\treturnProcess(form, data, 'sucess', submitID);\r\n    \t};\r\n\r\n        // Create temporary script\r\n    \tvar script = document.createElement('script');\r\n    \tscript.src = url + (url.indexOf('?') >= 0 ? '&' : '?') + 'callback=' + callbackName;\r\n    \tdocument.body.appendChild(script);\r\n\r\n        // Callback when error\r\n    \tscript.onerror = function(data) {\r\n    \t\treturnProcess('', data, 'error', submitID);\r\n    \t};\r\n    }\r\n\r\n    /**\r\n     * Processafter send leads.\r\n     *\r\n     */\r\n    var returnProcess = function (form, data, status, submitID) {\r\n    \tif(form) form.attr('data-sent','true').data('sent','true');\r\n    \tconsole.log(status + ': ', data);\r\n    }\r\n\r\n    /**\r\n     * Redirect to next page if redirect url is available\r\n     *\r\n     */\r\n    var setNextStackSet = function () {\r\n        console.log('Next Stack');\r\n    \tvar redUrl = $('#redirect_url').val();\r\n    \tif(redUrl) {\r\n            if($('#reload_parent_frame').val() !== 'false') {\r\n                console.log('parent_not_top');\r\n                window.location.href = redUrl;\r\n            } else {\r\n                console.log('top');\r\n                window.top.location.href = redUrl;\r\n            }\r\n        }\r\n        $('#submit_stack_button').html('Submit').attr('disabled', false).prop('disabled', false);\r\n    }\r\n\r\n    /**\r\n     * Process phone and address data\r\n     *\r\n     */\r\n    var setPhoneAndAddress = function (form) {\r\n    \tif($('#user_phone').val() != '' && $('#user_address').val() != '') return;\r\n\r\n    \tif(form.find('input[name=\"phone\"]').length == 1 && $('#user_phone').val() == '') {\r\n    \t\tvar phone = form.find('input[name=\"phone\"]').val();\r\n    \t\t\tphone = phone.replace(/\\D/g,'');\r\n    \t\t\t$('#user_phone').val(phone);\r\n    \t}\r\n\r\n    \t//Checks if form has address input\r\n    \tif((form.find('input[name=\"address\"]').length == 1 || form.find('input[name=\"address1\"]').length == 1)&& $('#user_address').val() == '') {\r\n    \t\tif(form.find('input[name=\"address1\"]').length == 1) var address = form.find('input[name=\"address1\"]').val();\r\n    \t\telse var address = form.find('input[name=\"address\"]').val();\r\n    \t\t$('#user_address').val(address);\r\n    \t}\r\n    }\r\n\r\n    /**\r\n     * Error callback handler.\r\n     *\r\n     */\r\n    $.validator.setDefaults({\r\n    \tfocusInvalid: false,\r\n        invalidHandler: function(form, validator) {\r\n            if (!validator.numberOfInvalids())return;\r\n    \t\telse $('#submit_stack_button').html('Submit').attr('disabled',false).prop('disabled', false);\r\n\r\n          \tif($('input[name=\"eiq_campaign_id\"]').length > 1) {\r\n          \t\tif(parseInt($('#error_validation_counter').val()) == 0) {\r\n                    $(validator.errorList[0].element).focus();\r\n    \t  \t\t}\r\n    \t        $('#error_validation_counter').val( parseInt($('#error_validation_counter').val()) + 1);\r\n          \t}else {\r\n                $(validator.errorList[0].element).focus();\r\n          \t}\r\n\r\n        }\r\n    });\r\n\r\n    /**\r\n     * Add method on validation.\r\n     *\r\n     */\r\n    $.validator.addMethod(\"letterswithspace\", function(value, element) {\r\n    \treturn this.optional(element) || /^[a-z\\s]+$/i.test(value);\r\n    }, \"letters only\");\r\n\r\n})(jQuery);\r\n"]}