{"version":3,"sources":["affiliate_reports.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"affiliate_reports.min.js","sourcesContent":["$(document).ready(function()\r\n{\r\n    $('.alert').on('click','.close',function(){\r\n        $(this).closest('.alert').fadeOut();\r\n    });\r\n\r\n    //draggable drilldown modal\r\n    $('.draggable-drilldown-modal').draggable({\r\n        handle: \".modal-header\"\r\n    });\r\n\r\n    $('.date-range-picker').prop(\"readonly\", true);\r\n\r\n    $('.input-group.date').datepicker({\r\n        format: \"yyyy-mm-dd\",\r\n        clearBtn: true,\r\n        autoclose: true,\r\n        todayHighlight: true,\r\n        orientation: \"top auto\",\r\n        endDate: '-0d',\r\n        startDate: '-30d'\r\n    });\r\n\r\n    var lastValue1 = '';\r\n    $('.date-range-picker').on('propertychange change paste input',function()\r\n    {\r\n        if ($(this).val() != lastValue1) {\r\n            lastValue1 = $(this).val();\r\n            $('#snapshot_period').val('none');\r\n        }\r\n    });\r\n\r\n    $('.date-range-picker').change(function() {\r\n        //Return to default\r\n        $('#end_date').removeClass('error_field');\r\n\r\n        //Check if dates are valid\r\n        if(Date.parse($('#start_date').val()) > Date.parse($('#end_date').val())) {\r\n            $('#end_date').addClass('error_field');\r\n        }\r\n    });\r\n\r\n    $('#snapshot_period').change(function()\r\n    {\r\n        //clear the date range\r\n        $('#start_date').val('');\r\n        $('#end_date').val('');\r\n    });\r\n\r\n    /*\r\n     $('.modal-content').resizable({\r\n     //alsoResize: \".modal-dialog\",\r\n     minHeight: 300,\r\n     minWidth: 300\r\n     });\r\n     */\r\n\r\n    //hide first the download buttons\r\n    $('.download-report-btn').hide();\r\n\r\n    //change the link of download csv when snapshot is changed\r\n    var baseURL = $('#baseUrl').html();\r\n    var snapShotSelect = $('#snapshot_period');\r\n    var snapshotPeriod = snapShotSelect.val();\r\n\r\n    var dateRangePayload = '?start_date='+$('#start_date').val()+'&end_date='+$('#end_date').val();\r\n\r\n    $('a#downloadXLSInternal').attr('href', baseURL+'/downloadAffiliateReportXLS/1/'+snapshotPeriod+dateRangePayload);\r\n    $('a#downloadXLSHandP').attr('href', baseURL+'/downloadAffiliateReportXLS/2/'+snapshotPeriod+dateRangePayload);\r\n\r\n    snapShotSelect.change(function()\r\n    {\r\n        var snapshotPeriod = $(this).val();\r\n        console.log(snapshotPeriod);\r\n\r\n        var dateRangePayload = '?start_date='+$('#start_date').val()+'&end_date='+$('#end_date').val();\r\n\r\n        $('a#downloadXLSInternal').attr('href', baseURL+'/downloadAffiliateReportXLS/1/'+snapshotPeriod+dateRangePayload);\r\n        $('a#downloadXLSHandP').attr('href', baseURL+'/downloadAffiliateReportXLS/2/'+snapshotPeriod+dateRangePayload);\r\n    });\r\n\r\n    var the_affiliate_url = baseURL + '/getAffiliateReports';\r\n    var the_website_url = baseURL + '/getWebsiteReports';\r\n    var the_revenueTracker_url = baseURL + '/getRevenueTrackerReports';\r\n\r\n    var internal_table = $('#internal-table').DataTable({\r\n        responsive: true,\r\n        'processing': true,\r\n        'serverSide': true,\r\n        language: {\r\n            searchPlaceholder: \"Affiliate\"\r\n            // \"sSearch\": \"<span>Affiliate:</span> _INPUT_\" //search\r\n        },\r\n        lengthMenu: [[25,50,100,-1],[25,50,100,\"All\"]],\r\n        'order': [[ 0, \"asc\" ]],\r\n        'ajax':{\r\n            url:the_affiliate_url, // json datasource\r\n            type: 'post',\r\n            'data': function(d)\r\n            {\r\n                d.period = $('#snapshot_period').val();\r\n                d.affiliate_type = 1;\r\n                d.start_date = $('#start_date').val();\r\n                d.end_date = $('#end_date').val();\r\n            },\r\n            'dataSrc': function (json)\r\n            {\r\n                console.log(json);\r\n\r\n                $(internal_table.column(1).footer()).html(json.totalClicks);\r\n                $(internal_table.column(2).footer()).html(json.totalPayout);\r\n                $(internal_table.column(3).footer()).html(json.totalLeads);\r\n                $(internal_table.column(4).footer()).html(json.totalRevenue);\r\n                $(internal_table.column(5).footer()).html(json.totalWeGet);\r\n                $(internal_table.column(6).footer()).html(json.totalMargin);\r\n\r\n                return json.data;\r\n            }\r\n        },\r\n        'columns':[\r\n            {'data':'affiliate'},\r\n            {'data':'clicks'},\r\n            {'data':'payout'},\r\n            {'data':'leads'},\r\n            {'data':'revenue'},\r\n            {'data':'we_get'},\r\n            {'data':'margin'}\r\n        ]\r\n    });\r\n\r\n    var current_affiliate_id = 0;\r\n    var current_affiliate_type = 0;\r\n    var handp_table, both_table;\r\n\r\n    $('#affiliate_website-table').DataTable({\r\n        responsive: true,\r\n        lengthMenu: [[10,15,25,50,100,-1],[10,15,25,50,100,\"All\"]]\r\n    });\r\n\r\n    $('#revenueTrackersDetailsTable').DataTable({\r\n        responsive: true,\r\n        lengthMenu: [[10,15,25,50,100,-1],[10,15,25,50,100,\"All\"]]\r\n    });\r\n\r\n    /*\r\n     $('#revenueTrackerDetailsModal').on('show.bs.modal', function () {\r\n     $(this).find('.modal-body').css({\r\n     'max-height':'100%'\r\n     });\r\n     });\r\n     */\r\n\r\n    $(document).on('click','#affiliate_website-table tbody tr td:first-child', function(e){\r\n\r\n        if($(this).parent('tr').children().length > 1)\r\n        {\r\n            var revenueTracker = $(this).find('.revenue-tracker');\r\n            var affiliateID = revenueTracker.data('id');\r\n            var revenueTrackerID = revenueTracker.data('rtid');\r\n            var websiteName = revenueTracker.data('webname');\r\n\r\n            var revenueTrackerDetailsModal = $('#revenueTrackerDetailsModal');\r\n\r\n            //alert($('#revenueTrackerDetailsModal').hasClass('in'));\r\n\r\n            console.log('affiliate_id: '+affiliateID);\r\n            console.log('revenue_tracker_id: '+revenueTrackerID);\r\n            console.log('webname: '+websiteName);\r\n\r\n            //$('#snapshot_period option:selected').html()\r\n            $('#revenueTrackerWebsite').html(websiteName);\r\n\r\n            var revenueTrackersDetailsTable = $('#revenueTrackersDetailsTable');\r\n            revenueTrackersDetailsTable.DataTable().clear();\r\n            revenueTrackersDetailsTable.DataTable().destroy();\r\n\r\n            var revenueTrackersTable = revenueTrackersDetailsTable.DataTable({\r\n                responsive: true,\r\n                'processing': true,\r\n                'serverSide': true,\r\n                language: {\r\n                    searchPlaceholder: \"Campaign\"\r\n                },\r\n                lengthMenu: [[10,15,25,50,100,-1],[10,15,25,50,100,\"All\"]],\r\n                'order': [[ 0, \"asc\" ]],\r\n                'ajax':{\r\n                    url:the_revenueTracker_url, // json datasource\r\n                    type: 'post',\r\n                    'data': function(d)\r\n                    {\r\n                        d.period = $('#snapshot_period').val();\r\n                        d.affiliate_id = affiliateID;\r\n                        d.revenue_tracker_id = revenueTrackerID;\r\n                        d.start_date = $('#start_date').val();\r\n                        d.end_date = $('#end_date').val();\r\n                    },\r\n                    'dataSrc': function (json)\r\n                    {\r\n                        console.log(json);\r\n\r\n                        $(revenueTrackersTable.column(1).footer()).html(json.totalLeads);\r\n                        $(revenueTrackersTable.column(2).footer()).html(json.totalRevenue);\r\n\r\n                        return json.data;\r\n                    }\r\n                },\r\n                'columns':[\r\n                    {'data':'campaign'},\r\n                    {'data':'leads'},\r\n                    {'data':'revenue'}\r\n                ],\r\n                //'scrollY':        $(window).height()/2,\r\n                //'scrollCollapse': true,\r\n                //'paging':         false,\r\n                'drawCallback': function(settings)\r\n                {\r\n                    //$('.dataTables_scrollBody thead tr').addClass('hidden');\r\n                    //$('.dataTables_scrollBody tfoot tr').addClass('hidden');\r\n                    //$('.dataTables_scrollBody thead tr th').removeClass('sorting_asc sorting_desc sorting');\r\n                    //$('.dataTables_scrollBody thead').css('display','none');\r\n                    //$('.dataTables_scrollBody tfoot').css('display','none');\r\n                },\r\n                'initComplete': function()\r\n                {\r\n                    //$('.dataTables_scrollBody thead tr').addClass('hidden');\r\n                    //$('.dataTables_scrollBody tfoot tr').addClass('hidden');\r\n                    //$('.dataTables_scrollBody thead tr th').removeClass('sorting_asc sorting_desc sorting');\r\n                    //$('.dataTables_scrollBody thead').css('display','none');\r\n                    //$('.dataTables_scrollBody tfoot').css('display','none');\r\n                }\r\n            });\r\n\r\n            if(!revenueTrackerDetailsModal.hasClass('in'))\r\n            {\r\n                revenueTrackerDetailsModal.modal('show');\r\n            }\r\n        }\r\n    });\r\n\r\n    //Website Statistics breakdown\r\n    $(document).on('click','.publisher_reports_table tbody tr td:first-child',function(e)\r\n    {\r\n        if($(this).parent('tr').children().length > 1) {\r\n            var affiliate = $(this).find('.ar_aff_id');\r\n            var aff_id = affiliate.data('id');\r\n            var affiliate_type = affiliate.data('type');\r\n\r\n            $('#pr_aff_cmp').html($(this).find('.ar_aff_id').html());\r\n            current_affiliate_id = aff_id;\r\n            current_affiliate_type = affiliate_type;\r\n\r\n            var affiliateWebSiteTable = $('#affiliate_website-table');\r\n            affiliateWebSiteTable.DataTable().clear();\r\n            affiliateWebSiteTable.DataTable().destroy();\r\n\r\n            var website_table = affiliateWebSiteTable.DataTable({\r\n                responsive: true,\r\n                'processing': true,\r\n                'serverSide': true,\r\n                language: {\r\n                    searchPlaceholder: \"Website\"\r\n                },\r\n                lengthMenu: [[10,15,25,50,100,-1],[10,15,25,50,100,\"All\"]],\r\n                'order': [[ 0, \"asc\" ]],\r\n                'ajax':{\r\n                    url:the_website_url, // json datasource\r\n                    type: 'post',\r\n                    'data': function(d)\r\n                    {\r\n                        d.period = $('#snapshot_period').val();\r\n                        d.affiliate_type = current_affiliate_type;\r\n                        d.affiliate_id = current_affiliate_id;\r\n                        d.start_date = $('#start_date').val();\r\n                        d.end_date = $('#end_date').val();\r\n                    },\r\n                    'dataSrc': function (json)\r\n                    {\r\n                        console.log(json);\r\n\r\n                        $(website_table.column(1).footer()).html(json.totalClicks);\r\n                        $(website_table.column(2).footer()).html(json.totalPayout);\r\n                        $(website_table.column(3).footer()).html(json.totalLeads);\r\n                        $(website_table.column(4).footer()).html(json.totalRevenue);\r\n                        $(website_table.column(5).footer()).html(json.totalWeGet);\r\n                        $(website_table.column(6).footer()).html(json.totalMargin);\r\n\r\n                        return json.data;\r\n                    }\r\n                },\r\n                'columns':[\r\n                    {'data':'website_name'},\r\n                    {'data':'clicks'},\r\n                    {'data':'payout'},\r\n                    {'data':'leads'},\r\n                    {'data':'revenue'},\r\n                    {'data':'we_get'},\r\n                    {'data':'margin'}\r\n                ]\r\n            });\r\n            // website_table.order([]);\r\n            // website_table.ajax.reload();\r\n            $('#prAffiliateWebsiteModal').modal('show');\r\n        }\r\n    });\r\n\r\n    $('[href=\"#internal_tab\"]').click(function()\r\n    {\r\n        $('.alert-danger-wrapper').hide();\r\n        $('.alert-warning-wrapper').hide();\r\n        $('.alert-success-wrapper').hide();\r\n        $('.internal-error-wrapper').hide();\r\n    });\r\n\r\n    $('[href=\"#handp_tab\"]').click(function()\r\n    {\r\n        $('.alert-danger-wrapper').hide();\r\n        $('.alert-warning-wrapper').hide();\r\n        $('.alert-success-wrapper').hide();\r\n        $('.handp-error-wrapper').hide();\r\n\r\n        if(!$.fn.DataTable.isDataTable('#handp-table'))\r\n        {\r\n            handp_table = $('#handp-table').DataTable({\r\n                responsive: true,\r\n                'processing': true,\r\n                'serverSide': true,\r\n                language: {\r\n                    searchPlaceholder: \"Affiliate\"\r\n                    // \"sSearch\": \"<span>Affiliate:</span> _INPUT_\" //search\r\n                },\r\n                lengthMenu: [[25,50,100,-1],[25,50,100,\"All\"]],\r\n                'order': [[ 0, \"asc\" ]],\r\n                'ajax':{\r\n                    url:the_affiliate_url, // json datasource\r\n                    type: 'post',\r\n                    'data': function(d)\r\n                    {\r\n                        d.period = $('#snapshot_period').val();\r\n                        d.affiliate_type = 2;\r\n                        d.start_date = $('#start_date').val();\r\n                        d.end_date = $('#end_date').val();\r\n                    },\r\n                    'dataSrc': function (json)\r\n                    {\r\n                        console.log(json);\r\n\r\n                        $(handp_table.column(1).footer()).html(json.totalClicks);\r\n                        $(handp_table.column(2).footer()).html(json.totalPayout);\r\n                        $(handp_table.column(3).footer()).html(json.totalLeads);\r\n                        $(handp_table.column(4).footer()).html(json.totalRevenue);\r\n                        $(handp_table.column(5).footer()).html(json.totalWeGet);\r\n                        $(handp_table.column(6).footer()).html(json.totalMargin);\r\n\r\n                        return json.data;\r\n                    }\r\n                },\r\n                'columns':[\r\n                    {'data':'affiliate'},\r\n                    {'data':'clicks'},\r\n                    {'data':'payout'},\r\n                    {'data':'leads'},\r\n                    {'data':'revenue'},\r\n                    {'data':'we_get'},\r\n                    {'data':'margin'}\r\n                ]\r\n            });\r\n\r\n            /*\r\n             handp_table = $('#handp-table').DataTable({\r\n             responsive: true,\r\n             'processing': true,\r\n             'serverSide': true,\r\n             language: {\r\n             searchPlaceholder: \"Affiliate\",\r\n             // \"sSearch\": \"<span>Affiliate:</span> _INPUT_\" //search\r\n             },\r\n             lengthMenu: [[25,50,100,-1],[25,50,100,\"All\"]],\r\n             'ajax':{\r\n             url:the_affiliate_url, // json datasource\r\n             type: 'post',\r\n             'data': function(d)\r\n             {\r\n             d.period = $('#snapshot_period').val();\r\n             d.affiliate_type = 2;\r\n             },\r\n             \"dataSrc\": function ( json ) {\r\n             console.log(json);\r\n             $(handp_table.column(1).footer()).html(json.totalClicks);\r\n             $(handp_table.column(2).footer()).html(json.totalPayout);\r\n             $(handp_table.column(3).footer()).html(json.totalLeads);\r\n             $(handp_table.column(4).footer()).html(json.totalRevenue);\r\n             $(handp_table.column(5).footer()).html(json.totalWeGet);\r\n             $(handp_table.column(6).footer()).html(json.totalMargin);\r\n             return json.data;\r\n             }\r\n             }\r\n             });\r\n             */\r\n        }\r\n    });\r\n\r\n    $('[href=\"#both_tab\"]').click(function()\r\n    {\r\n        if(!$.fn.DataTable.isDataTable('#both-table'))\r\n        {\r\n            both_table = $('#both-table').DataTable({\r\n                responsive: true,\r\n                'processing': true,\r\n                'serverSide': true,\r\n                language: {\r\n                    searchPlaceholder: \"Affiliate\"\r\n                    // \"sSearch\": \"<span>Affiliate:</span> _INPUT_\" //search\r\n                },\r\n                lengthMenu: [[25,50,100,-1],[25,50,100,\"All\"]],\r\n                'order': [[ 0, \"asc\" ]],\r\n                'ajax':{\r\n                    url:the_affiliate_url, // json datasource\r\n                    type: 'post',\r\n                    'data': function(d)\r\n                    {\r\n                        d.period = $('#snapshot_period').val();\r\n                        d.affiliate_type = 0;\r\n                        d.start_date = $('#start_date').val();\r\n                        d.end_date = $('#end_date').val();\r\n                    },\r\n                    'dataSrc': function (json)\r\n                    {\r\n                        console.log(json);\r\n\r\n                        $(both_table.column(1).footer()).html(json.totalClicks);\r\n                        $(both_table.column(2).footer()).html(json.totalPayout);\r\n                        $(both_table.column(3).footer()).html(json.totalLeads);\r\n                        $(both_table.column(4).footer()).html(json.totalRevenue);\r\n                        $(both_table.column(5).footer()).html(json.totalWeGet);\r\n                        $(both_table.column(6).footer()).html(json.totalMargin);\r\n\r\n                        return json.data;\r\n                    }\r\n                },\r\n                'columns':[\r\n                    {'data':'affiliate'},\r\n                    {'data':'clicks'},\r\n                    {'data':'payout'},\r\n                    {'data':'leads'},\r\n                    {'data':'revenue'},\r\n                    {'data':'we_get'},\r\n                    {'data':'margin'}\r\n                ]\r\n            });\r\n\r\n            /*\r\n             both_table = $('#both-table').DataTable({\r\n             responsive: true,\r\n             'processing': true,\r\n             'serverSide': true,\r\n             language: {\r\n             searchPlaceholder: \"Affiliate\",\r\n             },\r\n             lengthMenu: [[25,50,100,-1],[25,50,100,\"All\"]],\r\n             'ajax':{\r\n             url:the_affiliate_url, // json datasource\r\n             type: 'post',\r\n             'data': function(d)\r\n             {\r\n             d.period = $('#snapshot_period').val();\r\n             d.affiliate_type = 0;\r\n             },\r\n             \"dataSrc\": function ( json ) {\r\n             console.log(json);\r\n             $(both_table.column(1).footer()).html(json.totalClicks);\r\n             $(both_table.column(2).footer()).html(json.totalPayout);\r\n             $(both_table.column(3).footer()).html(json.totalLeads);\r\n             $(both_table.column(4).footer()).html(json.totalRevenue);\r\n             $(both_table.column(5).footer()).html(json.totalWeGet);\r\n             $(both_table.column(6).footer()).html(json.totalMargin);\r\n             return json.data;\r\n             }\r\n             }\r\n             });\r\n             */\r\n        }\r\n    });\r\n\r\n    $('.generate-excel-report').click(function()\r\n    {\r\n        var generateButton = $(this);\r\n        var affiliateType = generateButton.data('affiliate_type');\r\n        var downloadLinkID = generateButton.data('download_link_id');\r\n        var snapShot = snapShotSelect.val();\r\n\r\n        var originalGenerateText = generateButton.html();\r\n\r\n        //$('a#downloadXLSInternal').attr('href', baseURL+'/downloadAffiliateReportXLS/1/'+snapshotPeriod);\r\n        var generateURL = baseURL+'/generateAffiliateReportXLS/'+affiliateType+'/'+snapShot\r\n\r\n        generateButton.attr('disabled','true');\r\n        generateButton.html('<i class=\"fa fa-spin fa-spinner\"></i>');\r\n\r\n        var startDate = $('#start_date').val();\r\n        var endDate = $('#end_date').val();\r\n\r\n        var payloadData = {\r\n            start_date: startDate,\r\n            end_date: endDate\r\n        };\r\n\r\n        $.ajax({\r\n            type: 'GET',\r\n            url: generateURL,\r\n            data: payloadData,\r\n            error: function(data)\r\n            {\r\n                var errors = data.responseJSON;\r\n                console.log(data);\r\n\r\n                $('.this_error_wrapper').show();\r\n                $('.this_errors').html('');\r\n                $('.this_errors').show();\r\n                var errorsHtml = '<ul>';\r\n                $.each( errors, function( key, value ) {\r\n                    errorsHtml += '<li> <span class=\"glyphicon glyphicon-remove-sign\" aria-hidden=\"true\"></span> ' + value[0] + '</li>'; //showing only the first error.\r\n                    form.find('label[for=\"'+key+'\"]').addClass('error_label error');\r\n                    form.find('#'+key).addClass('error_field error');\r\n                });\r\n\r\n                errorsHtml += '</ul>';\r\n                $('.this_errors').append(errorsHtml);\r\n\r\n                generateButton.html(originalGenerateText);\r\n                generateButton.removeAttr('disabled');\r\n\r\n            },\r\n            success: function(data)\r\n            {\r\n                $('.this_error_wrapper').show();\r\n                console.log(data.status);\r\n                console.log(data.message);\r\n                console.log(data.key);\r\n\r\n                $('.alert-danger-wrapper').hide();\r\n                $('.alert-warning-wrapper').hide();\r\n                $('.alert-success-wrapper').hide();\r\n\r\n                switch(data.status)\r\n                {\r\n                    case 'generate_failed':\r\n\r\n                        $('.alert-danger-wrapper').show();\r\n                        $('.alert-danger-content').html('');\r\n                        $('.alert-danger-content').append(data.message);\r\n                        break;\r\n\r\n                    default:\r\n\r\n                        $('.alert-success-wrapper').show();\r\n                        $('.alert-success-content').html('');\r\n                        $('.alert-success-content').append(data.message);\r\n\r\n                        console.log(affiliateType);\r\n                        console.log(downloadLinkID);\r\n                        console.log(snapShot);\r\n\r\n                        var dateRangePayload = '?start_date='+$('#start_date').val()+'&end_date='+$('#end_date').val();\r\n\r\n                        //update the download button\r\n                        $(downloadLinkID).attr('href', baseURL+'/downloadAffiliateReportXLS/'+affiliateType+'/'+snapShot+dateRangePayload);\r\n\r\n                        //show the DL link\r\n                        $(downloadLinkID).show();\r\n\r\n                        break;\r\n                }\r\n\r\n                generateButton.html(originalGenerateText);\r\n                generateButton.removeAttr('disabled');\r\n            }\r\n        });\r\n\r\n    });\r\n\r\n    $(document).on('submit','#updatePublisherReportsTable',function(e)\r\n    {\r\n        e.preventDefault();\r\n\r\n        $('.pr_sp_periord').html($('#snapshot_period option:selected').html());\r\n\r\n        if($.fn.DataTable.isDataTable('#internal-table' ))\r\n        {\r\n            internal_table.order([[ 0, \"asc\" ]]);\r\n            internal_table.ajax.reload();\r\n        }\r\n\r\n        if ($.fn.DataTable.isDataTable('#handp-table'))\r\n        {\r\n            handp_table.order([[ 0, \"asc\" ]]);\r\n            handp_table.ajax.reload();\r\n        }\r\n\r\n        if($.fn.DataTable.isDataTable('#both-table'))\r\n        {\r\n            both_table.order([[ 0, \"asc\" ]]);\r\n            both_table.ajax.reload();\r\n        }\r\n    });\r\n});"]}